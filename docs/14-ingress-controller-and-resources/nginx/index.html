
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Preparation notes for CKA">
      
      
        <meta name="author" content="Vikash Kumar">
      
      
        <link rel="canonical" href="https://github.com/OpsAlchemy/kubequest.git/docs/14-ingress-controller-and-resources/nginx/">
      
      
        <link rel="prev" href="../nginx-vs-ingress-compare/">
      
      
        <link rel="next" href="../north-south-traffic-management/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>NGINX Location Block Master Guide - KillerCoda Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nginx-location-block-master-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KillerCoda Notes" class="md-header__button md-logo" aria-label="KillerCoda Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KillerCoda Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NGINX Location Block Master Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KillerCoda Notes" class="md-nav__button md-logo" aria-label="KillerCoda Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    KillerCoda Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    KillerCoda Notes ‚Äì CKA
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    14 ingress controller and resources
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    14 ingress controller and resources
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nginx-ingress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NGINX Configs that Mimic Kubernetes Ingress Behavior
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nginx-regex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Mystery of (/|$): NGINX Ingress Controller's Secret Sauce
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nginx-vs-ingress-compare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx vs ingress compare
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    NGINX Location Block Master Guide
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    NGINX Location Block Master Guide
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nginx-location-blocks-the-complete-pattern-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ NGINX LOCATION BLOCKS: The Complete Pattern Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ NGINX LOCATION BLOCKS: The Complete Pattern Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-location-block-syntax-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Location Block Syntax Fundamentals
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifier-types-their-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìö MODIFIER TYPES &amp; THEIR BEHAVIOR
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìö MODIFIER TYPES &amp; THEIR BEHAVIOR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-modifier-prefix-match" class="md-nav__link">
    <span class="md-ellipsis">
      
        No Modifier = Prefix Match
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exact-match-modifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        = Exact Match Modifier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-sensitive-regex" class="md-nav__link">
    <span class="md-ellipsis">
      
        ~ Case-Sensitive Regex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-insensitive-regex" class="md-nav__link">
    <span class="md-ellipsis">
      
        ~* Case-Insensitive Regex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-regex-prefix-priority-prefix" class="md-nav__link">
    <span class="md-ellipsis">
      
        ^~ Non-Regex Prefix (Priority Prefix)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#priority-evaluation-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîÑ PRIORITY &amp; EVALUATION ORDER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîÑ PRIORITY &amp; EVALUATION ORDER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-location-selection-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        NGINX Location Selection Algorithm:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-patterns-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        üöÄ PRODUCTION PATTERNS &amp; EXAMPLES
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üöÄ PRODUCTION PATTERNS &amp; EXAMPLES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-static-file-serving-with-cache-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Static File Serving with Cache Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-api-gateway-with-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: API Gateway with Versioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-single-page-application-spa-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Single Page Application (SPA) Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-file-upload-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: File Upload Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-authentication-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Authentication Proxy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-6-rate-limiting-by-path" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 6: Rate Limiting by Path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-7-websocket-proxying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 7: Websocket Proxying
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-8-health-checks-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 8: Health Checks &amp; Monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-9-url-rewriting-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 9: URL Rewriting Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-10-security-hardening-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 10: Security Hardening Patterns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-location-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîß ADVANCED LOCATION TECHNIQUES
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîß ADVANCED LOCATION TECHNIQUES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nested-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Locations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-proxy-pass-based-on-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Proxy Pass Based on Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ab-testing-with-split-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        A/B Testing with Split Clients
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-logic-in-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conditional Logic in Locations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚ö†Ô∏è COMMON PITFALLS &amp; SOLUTIONS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="‚ö†Ô∏è COMMON PITFALLS &amp; SOLUTIONS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-trailing-slash-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Trailing Slash Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-regex-priority-problems" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Regex Priority Problems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-try_files-misuse" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Try_files Misuse
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-location-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìä DEBUGGING LOCATION BLOCKS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä DEBUGGING LOCATION BLOCKS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-priority-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check Priority Order
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference-card" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ QUICK REFERENCE CARD
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ QUICK REFERENCE CARD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#location-modifiers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Location Modifiers:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluation Order:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pro-tips" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pro Tips:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../north-south-traffic-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes NGINX Ingress ‚Äî Complete Master Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regex From Absolute Scratch - You WILL Understand This üéØ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Cluster architecture, installation & configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cluster architecture, installation & configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/apiserver-misconfigured-approach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kube-apiserver Crash (Static Pod)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/apiserver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Control Plane (kubeadm)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/cka-kubernetes-upgrade-complete-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complete Kubernetes Cluster Upgrade Guide for CKA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/etcd-backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    etcd Snapshot Backup and Restore (kubeadm)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/kubeadm-certificate-commands-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complete kubeadm Certificate Management Command Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/kubeadm-cluster-init-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Cluster Initialization and Node Join Process Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/kubelet-misconfigured/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubelet Misconfigured
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/probing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Probes &amp; Health Endpoints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/rbac-namespace-scope-with-clusterrole/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Namespacing ClusterRoles Using RoleBindings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/rbac-pipeline-serviceaccount-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes RBAC: Pipeline ServiceAccount with Cluster-Wide Read and Namespaced Deployment Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster%20architecture%2C%20installation%20%26%20configuration/vimsetpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Minimal Vim Configuration for CKA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Gateway api
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gateway api
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway-api/gateway-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Gateway API: Complete Master Guide üöÄ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway-api/gateway-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gateway API vs Ingress Controller: Deep Dive into Complex Logic üß†
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway-api/load-of-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Gateway API Complete Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Services & networking
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services & networking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services-%26-networking/ingress-cli-pathType-and-class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating Ingress via kubectl CLI with Prefix Paths and IngressClass
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services-%26-networking/networkpolicy-cross-namespace-egress-ingress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Restricting Cross-Namespace Traffic Using NetworkPolicies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services-%26-networking/networkpolicy-egress-cross-namespace-label-based/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Egress NetworkPolicy for Label-Based Cross-Namespace Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Storage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/affinity-with-hostPath-and-selector-on-pvc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    affinity with hostPath and selector on pvc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/cheatshett/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cheatshett
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/consumption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consumption
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/keys/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Keys
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/minimal-pv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Minimal pv
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/standard-sc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Standard sc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/usage-of-manual-sc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manual StorageClass
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Workload & scheduling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workload & scheduling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/all-possible-way-to-create-secret/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Secrets - Complete Reference Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/configmap-env-and-volume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using ConfigMaps as Environment Variables and Volumes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/configmap-selective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configmap selective
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/daemonset-troubleshooting-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DaemonSet YAML Troubleshooting Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/deployment-nodeName-scheduling-issue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Scheduling Failure Due to Hard-Coded nodeName
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/deployment.strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment.strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/multi-container-port-conflict/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CrashLoopBackOff Due to Port Conflict in Multi-Container Pod
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/pod-affinity-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Pod Affinity: Advanced Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workload-%26-scheduling/pod-priority-and-priorityclass-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pod Priority Using PriorityClass
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nginx-location-blocks-the-complete-pattern-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ NGINX LOCATION BLOCKS: The Complete Pattern Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ NGINX LOCATION BLOCKS: The Complete Pattern Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-location-block-syntax-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Location Block Syntax Fundamentals
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifier-types-their-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìö MODIFIER TYPES &amp; THEIR BEHAVIOR
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìö MODIFIER TYPES &amp; THEIR BEHAVIOR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-modifier-prefix-match" class="md-nav__link">
    <span class="md-ellipsis">
      
        No Modifier = Prefix Match
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exact-match-modifier" class="md-nav__link">
    <span class="md-ellipsis">
      
        = Exact Match Modifier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-sensitive-regex" class="md-nav__link">
    <span class="md-ellipsis">
      
        ~ Case-Sensitive Regex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-insensitive-regex" class="md-nav__link">
    <span class="md-ellipsis">
      
        ~* Case-Insensitive Regex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-regex-prefix-priority-prefix" class="md-nav__link">
    <span class="md-ellipsis">
      
        ^~ Non-Regex Prefix (Priority Prefix)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#priority-evaluation-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîÑ PRIORITY &amp; EVALUATION ORDER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîÑ PRIORITY &amp; EVALUATION ORDER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx-location-selection-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        NGINX Location Selection Algorithm:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-patterns-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        üöÄ PRODUCTION PATTERNS &amp; EXAMPLES
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üöÄ PRODUCTION PATTERNS &amp; EXAMPLES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-static-file-serving-with-cache-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Static File Serving with Cache Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-api-gateway-with-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: API Gateway with Versioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-single-page-application-spa-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Single Page Application (SPA) Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-file-upload-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: File Upload Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-authentication-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Authentication Proxy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-6-rate-limiting-by-path" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 6: Rate Limiting by Path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-7-websocket-proxying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 7: Websocket Proxying
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-8-health-checks-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 8: Health Checks &amp; Monitoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-9-url-rewriting-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 9: URL Rewriting Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-10-security-hardening-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 10: Security Hardening Patterns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-location-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      
        üîß ADVANCED LOCATION TECHNIQUES
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîß ADVANCED LOCATION TECHNIQUES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nested-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Locations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-proxy-pass-based-on-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Proxy Pass Based on Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ab-testing-with-split-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        A/B Testing with Split Clients
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-logic-in-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conditional Logic in Locations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        ‚ö†Ô∏è COMMON PITFALLS &amp; SOLUTIONS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="‚ö†Ô∏è COMMON PITFALLS &amp; SOLUTIONS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-trailing-slash-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Trailing Slash Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-regex-priority-problems" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Regex Priority Problems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-try_files-misuse" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Try_files Misuse
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-location-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        üìä DEBUGGING LOCATION BLOCKS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä DEBUGGING LOCATION BLOCKS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-priority-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check Priority Order
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference-card" class="md-nav__link">
    <span class="md-ellipsis">
      
        üéØ QUICK REFERENCE CARD
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ QUICK REFERENCE CARD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#location-modifiers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Location Modifiers:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluation Order:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pro-tips" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pro Tips:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="nginx-location-block-master-guide">NGINX Location Block Master Guide</h1>
<h2 id="nginx-location-blocks-the-complete-pattern-reference">üéØ <strong>NGINX LOCATION BLOCKS: The Complete Pattern Reference</strong></h2>
<h3 id="1-location-block-syntax-fundamentals"><strong>1. Location Block Syntax Fundamentals</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">[modifier]</span><span class="w"> </span><span class="s">[uri_pattern]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Configuration directives</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="modifier-types-their-behavior">üìö <strong>MODIFIER TYPES &amp; THEIR BEHAVIOR</strong></h2>
<h3 id="no-modifier-prefix-match"><strong>No Modifier = Prefix Match</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Matches: /api, /api/, /api/users, /api/v1/test</span>
<span class="w">    </span><span class="c1"># Does NOT match: /apix, /api-test</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Key Points:</strong>
- <strong>Longest prefix wins</strong>: <code>/api/users</code> will match over <code>/api</code> if both exist
- <strong>Case-sensitive by default</strong>
- <strong>Most commonly used</strong></p>
<hr />
<h3 id="exact-match-modifier"><strong><code>=</code> Exact Match Modifier</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/login</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Matches ONLY: /login</span>
<span class="w">    </span><span class="c1"># Does NOT match: /login/, /login/user, /LOGIN</span>
<span class="w">    </span><span class="c1"># Highest priority</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Use Case:</strong> Login endpoints, specific static files, health checks</p>
<hr />
<h3 id="case-sensitive-regex"><strong><code>~</code> Case-Sensitive Regex</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.(gif|jpg|png)$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Matches: /image.jpg, /data/photo.PNG</span>
<span class="w">    </span><span class="c1"># Case-sensitive: /image.JPG would NOT match</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Regex Examples:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Match numeric user IDs</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">^/users/[0-9]+$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># /users/123 ‚úì</span>
<span class="w">    </span><span class="c1"># /users/abc ‚úó</span>
<span class="p">}</span>

<span class="c1"># Complex pattern</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">^/api/v[0-9]+/(create|update|delete)$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># /api/v1/create ‚úì</span>
<span class="w">    </span><span class="c1"># /api/v2/update ‚úì</span>
<span class="w">    </span><span class="c1"># /api/v1/get ‚úó</span>
<span class="p">}</span>
</code></pre></div></p>
<hr />
<h3 id="case-insensitive-regex"><strong><code>~*</code> Case-Insensitive Regex</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(gif|jpg|jpeg|png)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Matches: /image.jpg, /IMAGE.JPG, /data/Photo.PNG</span>
<span class="w">    </span><span class="c1"># All case variations match</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h3 id="non-regex-prefix-priority-prefix"><strong><code>^~</code> Non-Regex Prefix (Priority Prefix)</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">^~</span><span class="w"> </span><span class="s">/static</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Matches: /static, /static/, /static/css/style.css</span>
<span class="w">    </span><span class="c1"># Higher priority than regex locations</span>
<span class="w">    </span><span class="c1"># But still prefix-based matching</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Special Behavior:</strong><br />
Stops regex evaluation for this path - regex locations won't be checked if this matches.</p>
<hr />
<h2 id="priority-evaluation-order">üîÑ <strong>PRIORITY &amp; EVALUATION ORDER</strong></h2>
<h3 id="nginx-location-selection-algorithm"><strong>NGINX Location Selection Algorithm:</strong></h3>
<ol>
<li><strong>Exact match (<code>=</code>) locations</strong> - Checked first</li>
<li><strong>Non-regex prefix (<code>^~</code>) locations</strong> - Checked second</li>
<li><strong>Regex locations (<code>~</code> and <code>~*</code>)</strong> - Checked in order of appearance</li>
<li><strong>Regular prefix locations</strong> - Longest prefix wins</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># 1. Checked first: Exact matches</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/api/login</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Highest priority if URL is exactly /api/login</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># 2. Checked second: Non-regex prefix</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">^~</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Will match /api/users before any regex below</span>
<span class="w">        </span><span class="c1"># Prevents regex checks for /api paths</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># 3. Checked in order: Regex matches</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Matches .php files</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(gif|jpg)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Case-insensitive image files</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># 4. Checked last: Regular prefix (longest wins)</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/api/users</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Longer than /api, so wins for /api/users/*</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Shorter prefix, lower priority than /api/users</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="production-patterns-examples">üöÄ <strong>PRODUCTION PATTERNS &amp; EXAMPLES</strong></h2>
<h3 id="pattern-1-static-file-serving-with-cache-control"><strong>Pattern 1: Static File Serving with Cache Control</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(css|js|jpg|jpeg|png|gif|ico|woff|woff2|ttf|svg)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/static</span><span class="p">;</span>
<span class="w">    </span><span class="kn">expires</span><span class="w"> </span><span class="s">1y</span><span class="p">;</span><span class="w">  </span><span class="c1"># Browser cache for 1 year</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Cache-Control</span><span class="w"> </span><span class="s">&quot;public,</span><span class="w"> </span><span class="s">immutable&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Gzip compression</span>
<span class="w">    </span><span class="kn">gzip_static</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_types</span><span class="w"> </span><span class="s">text/css</span><span class="w"> </span><span class="s">application/javascript</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Security headers</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Content-Type-Options</span><span class="w"> </span><span class="s">&quot;nosniff&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-2-api-gateway-with-versioning"><strong>Pattern 2: API Gateway with Versioning</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Exact endpoints first</span>
<span class="k">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/api/v1/auth/login</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://auth-service:3000</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/api/v1/auth/logout</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://auth-service:3000</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Version-specific routing with rewrite</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">^/api/v1/(users|products|orders)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Strip /api/v1 prefix</span>
<span class="w">    </span><span class="kn">set</span><span class="w"> </span><span class="nv">$service_name</span><span class="w"> </span><span class="nv">$1</span><span class="p">;</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^/api/v1/(users|products|orders)/(.*)</span><span class="w"> </span><span class="s">/</span><span class="nv">$2</span><span class="w"> </span><span class="s">break</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://</span><span class="nv">$service_name-service:8080</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Catch-all for v1 API</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api/v1</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api-gateway:8080/</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># New API version</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api/v2</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api-v2-gateway:9090/</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-3-single-page-application-spa-routing"><strong>Pattern 3: Single Page Application (SPA) Routing</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Static assets with cache</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(js|css|png|jpg|jpeg|gif|ico|svg)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/app</span><span class="p">;</span>
<span class="w">    </span><span class="kn">expires</span><span class="w"> </span><span class="s">1y</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Cache-Control</span><span class="w"> </span><span class="s">&quot;public,</span><span class="w"> </span><span class="s">immutable&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="p">=</span><span class="mi">404</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># HTML files - short cache</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.html</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/app</span><span class="p">;</span>
<span class="w">    </span><span class="kn">expires</span><span class="w"> </span><span class="s">1h</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Cache-Control</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># API calls</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend-api:8080</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># SPA fallback - all other requests go to index.html</span>
<span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/app</span><span class="p">;</span>
<span class="w">    </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.html</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-4-file-upload-handling"><strong>Pattern 4: File Upload Handling</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Special handling for uploads</span>
<span class="k">location</span><span class="w"> </span><span class="s">/upload</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Large file uploads</span>
<span class="w">    </span><span class="kn">client_max_body_size</span><span class="w"> </span><span class="s">100M</span><span class="p">;</span>
<span class="w">    </span><span class="kn">client_body_temp_path</span><span class="w"> </span><span class="s">/tmp/nginx_uploads</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Timeouts for large uploads</span>
<span class="w">    </span><span class="kn">proxy_connect_timeout</span><span class="w"> </span><span class="s">300s</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_send_timeout</span><span class="w"> </span><span class="s">300s</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_read_timeout</span><span class="w"> </span><span class="s">300s</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Don&#39;t buffer uploads</span>
<span class="w">    </span><span class="kn">proxy_request_buffering</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>

<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://upload-service:8080</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-5-authentication-proxy"><strong>Pattern 5: Authentication Proxy</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/admin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Internal only (like K8s internal services)</span>
<span class="w">    </span><span class="kn">internal</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Check auth cookie</span>
<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$cookie_session</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">return</span><span class="w"> </span><span class="mi">401</span><span class="w"> </span><span class="s">&quot;Unauthorized&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Validate with auth service</span>
<span class="w">    </span><span class="kn">auth_request</span><span class="w"> </span><span class="s">/validate</span><span class="p">;</span>
<span class="w">    </span><span class="kn">auth_request_set</span><span class="w"> </span><span class="nv">$auth_status</span><span class="w"> </span><span class="nv">$upstream_status</span><span class="p">;</span>

<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://admin-panel:8080</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Auth validation endpoint</span>
<span class="k">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/validate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">internal</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://auth-service:3000/validate</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass_request_body</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Content-Length</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-6-rate-limiting-by-path"><strong>Pattern 6: Rate Limiting by Path</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Define rate limit zones</span>
<span class="k">limit_req_zone</span><span class="w"> </span><span class="nv">$binary_remote_addr</span><span class="w"> </span><span class="s">zone=api_limit:10m</span><span class="w"> </span><span class="s">rate=10r/s</span><span class="p">;</span>
<span class="k">limit_req_zone</span><span class="w"> </span><span class="nv">$binary_remote_addr</span><span class="w"> </span><span class="s">zone=auth_limit:10m</span><span class="w"> </span><span class="s">rate=5r/s</span><span class="p">;</span>
<span class="k">limit_req_zone</span><span class="w"> </span><span class="nv">$binary_remote_addr</span><span class="w"> </span><span class="s">zone=static_limit:10m</span><span class="w"> </span><span class="s">rate=100r/s</span><span class="p">;</span>

<span class="k">location</span><span class="w"> </span><span class="s">/api/auth</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">limit_req</span><span class="w"> </span><span class="s">zone=auth_limit</span><span class="w"> </span><span class="s">burst=10</span><span class="w"> </span><span class="s">nodelay</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://auth-service:3000</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">limit_req</span><span class="w"> </span><span class="s">zone=api_limit</span><span class="w"> </span><span class="s">burst=20</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api-service:8080</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(css|js|png)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">limit_req</span><span class="w"> </span><span class="s">zone=static_limit</span><span class="w"> </span><span class="s">burst=50</span><span class="p">;</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/static</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-7-websocket-proxying"><strong>Pattern 7: Websocket Proxying</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/ws</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Upgrade headers for WebSocket</span>
<span class="w">    </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Upgrade</span><span class="w"> </span><span class="nv">$http_upgrade</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Connection</span><span class="w"> </span><span class="s">&quot;upgrade&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Longer timeouts for persistent connections</span>
<span class="w">    </span><span class="kn">proxy_read_timeout</span><span class="w"> </span><span class="s">3600s</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_send_timeout</span><span class="w"> </span><span class="s">3600s</span><span class="p">;</span>

<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://websocket-service:8080</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-8-health-checks-monitoring"><strong>Pattern 8: Health Checks &amp; Monitoring</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Health endpoint (no logging)</span>
<span class="k">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/health</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
<span class="w">    </span><span class="kn">default_type</span><span class="w"> </span><span class="s">application/json</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Check if backend is healthy</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend:8080/health</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Custom health logic</span>
<span class="w">    </span><span class="c1"># if ($upstream_status != 200) {</span>
<span class="w">    </span><span class="c1">#     return 503;</span>
<span class="w">    </span><span class="c1"># }</span>

<span class="w">    </span><span class="kn">return</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="s">&#39;</span><span class="p">{</span><span class="kn">&quot;status&quot;:&quot;healthy&quot;}&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Metrics endpoint (Prometheus format)</span>
<span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/metrics</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">stub_status</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
<span class="w">    </span><span class="kn">allow</span><span class="w"> </span><span class="mi">10</span><span class="s">.0.0.0/8</span><span class="p">;</span><span class="w">  </span><span class="c1"># Internal only</span>
<span class="w">    </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Debug endpoint (development only)</span>
<span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">^/debug/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Only allow from localhost</span>
<span class="w">    </span><span class="kn">allow</span><span class="w"> </span><span class="mi">127</span><span class="s">.0.0.1</span><span class="p">;</span>
<span class="w">    </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Enable detailed logging</span>
<span class="w">    </span><span class="kn">rewrite_log</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">error_log</span><span class="w"> </span><span class="s">/var/log/nginx/debug.log</span><span class="w"> </span><span class="s">debug</span><span class="p">;</span>

<span class="w">    </span><span class="kn">echo</span><span class="w"> </span><span class="s">&quot;Request</span><span class="w"> </span><span class="s">URI:</span><span class="w"> </span><span class="nv">$request_uri&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">echo</span><span class="w"> </span><span class="s">&quot;Args:</span><span class="w"> </span><span class="nv">$args&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">echo</span><span class="w"> </span><span class="s">&quot;Headers:</span><span class="w"> </span><span class="nv">$http_user_agent&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-9-url-rewriting-patterns"><strong>Pattern 9: URL Rewriting Patterns</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Simple prefix removal</span>
<span class="k">location</span><span class="w"> </span><span class="s">/old</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^/old/(.*)</span>$<span class="w"> </span><span class="s">/new/</span><span class="nv">$1</span><span class="w"> </span><span class="s">permanent</span><span class="p">;</span><span class="w">  </span><span class="c1"># 301 redirect</span>
<span class="p">}</span>

<span class="c1"># 2. Query string manipulation</span>
<span class="k">location</span><span class="w"> </span><span class="s">/search</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># /search?q=term ‚Üí /api/search?query=term</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^/search</span>$<span class="w"> </span><span class="s">/api/search?query=</span><span class="nv">$arg_q?</span><span class="w"> </span><span class="s">last</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># 3. Path segmentation</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">^/blog/([0-9]</span><span class="p">{</span><span class="kn">4})/([0-9]{2})/([^/]+)$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># /blog/2023/10/my-post ‚Üí /posts/2023/10/my-post</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^/blog/([0-9]</span><span class="p">{</span><span class="kn">4})/([0-9]{2})/([^/]+)$</span><span class="w"> </span><span class="s">/posts/</span><span class="nv">$1/$2/$3</span><span class="w"> </span><span class="s">last</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># 4. Trailing slash enforcement</span>
<span class="kn">location</span><span class="w"> </span><span class="s">/page</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Remove trailing slash</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^/(.*)/</span>$<span class="w"> </span><span class="s">/</span><span class="nv">$1</span><span class="w"> </span><span class="s">permanent</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># 5. File extension removal (pretty URLs)</span>
<span class="kn">location</span><span class="w"> </span><span class="s">/products</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># /products/item.html ‚Üí serves /products/item</span>
<span class="w">    </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri.html</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="p">=</span><span class="mi">404</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="pattern-10-security-hardening-patterns"><strong>Pattern 10: Security Hardening Patterns</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Block common exploits</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">(\.(git|svn|htaccess)|wp-config\.php)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>
<span class="w">    </span><span class="kn">return</span><span class="w"> </span><span class="mi">404</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Protect admin areas</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">^/(admin|wp-admin|dashboard)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># IP whitelisting</span>
<span class="w">    </span><span class="kn">allow</span><span class="w"> </span><span class="mi">10</span><span class="s">.0.0.0/8</span><span class="p">;</span>
<span class="w">    </span><span class="kn">allow</span><span class="w"> </span><span class="mi">192</span><span class="s">.168.1.0/24</span><span class="p">;</span>
<span class="w">    </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Add extra security headers</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Frame-Options</span><span class="w"> </span><span class="s">&quot;DENY&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Content-Type-Options</span><span class="w"> </span><span class="s">&quot;nosniff&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Referrer-Policy</span><span class="w"> </span><span class="s">&quot;no-referrer&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Rate limiting</span>
<span class="w">    </span><span class="kn">limit_req</span><span class="w"> </span><span class="s">zone=auth_limit</span><span class="w"> </span><span class="s">burst=5</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Basic auth as fallback</span>
<span class="w">    </span><span class="kn">auth_basic</span><span class="w"> </span><span class="s">&quot;Admin</span><span class="w"> </span><span class="s">Area&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">auth_basic_user_file</span><span class="w"> </span><span class="s">/etc/nginx/.htpasswd</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Prevent hotlinking</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(jpg|jpeg|png|gif)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">valid_referers</span><span class="w"> </span><span class="s">none</span><span class="w"> </span><span class="s">blocked</span><span class="w"> </span><span class="s">server_names</span><span class="w"> </span><span class="p">~</span><span class="sr">\.google\.</span><span class="w"> </span><span class="p">~</span><span class="sr">\.bing\.</span><span class="w"> </span><span class="p">~</span><span class="sr">\.yahoo\;</span>

<span class="w">    </span><span class="s">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$invalid_referer</span><span class="s">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">return</span><span class="w"> </span><span class="mi">403</span><span class="p">;</span>
<span class="w">        </span><span class="c1"># Or serve a placeholder:</span>
<span class="w">        </span><span class="c1"># rewrite ^ /images/hotlink.jpg;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Hide PHP files (if applicable)</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Only allow index.php</span>
<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$uri</span><span class="w"> </span><span class="s">!~</span><span class="w"> </span><span class="s">&quot;^/(index|wp-login|wp-admin)\.php&quot;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">return</span><span class="w"> </span><span class="mi">404</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">fastcgi_pass</span><span class="w"> </span><span class="n">php</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>
<span class="w">    </span><span class="c1"># ... rest of PHP config</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="advanced-location-techniques">üîß <strong>ADVANCED LOCATION TECHNIQUES</strong></h2>
<h3 id="nested-locations"><strong>Nested Locations</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Parent location config</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-API-Version</span><span class="w"> </span><span class="s">v1</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Nested location</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/api/admin</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1"># Inherits parent config + adds more</span>
<span class="w">        </span><span class="kn">allow</span><span class="w"> </span><span class="mi">10</span><span class="s">.0.0.0/8</span><span class="p">;</span>
<span class="w">        </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>

<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://admin-api:8080</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Another nested location</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/api/public</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://public-api:8080</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="dynamic-proxy-pass-based-on-variables"><strong>Dynamic Proxy Pass Based on Variables</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Map URI to backend service</span>
<span class="k">map</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$backend</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">~^/users</span><span class="w">   </span><span class="n">user-service</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
<span class="w">    </span><span class="kn">~^/products</span><span class="w"> </span><span class="n">product-service</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
<span class="w">    </span><span class="kn">~^/orders</span><span class="w">  </span><span class="n">order-service</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
<span class="w">    </span><span class="kn">default</span><span class="w">    </span><span class="n">default-service</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://</span><span class="nv">$backend</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="ab-testing-with-split-clients"><strong>A/B Testing with Split Clients</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Split traffic 50/50</span>
<span class="k">split_clients</span><span class="w"> </span><span class="s">&quot;</span><span class="nv">${remote_addr}${http_user_agent}&quot;</span><span class="w"> </span><span class="nv">$variant</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">50%</span><span class="w">     </span><span class="s">&quot;v2&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">*</span><span class="w">       </span><span class="s">&quot;v1&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$variant</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;v2&quot;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://app-v2:8080</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://app-v1:8080</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="conditional-logic-in-locations"><strong>Conditional Logic in Locations</strong></h3>
<div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Method-based routing</span>
<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$request_method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">POST)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://write-api:8080</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$request_method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">GET)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://read-api:8080</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Device-based routing</span>
<span class="w">    </span><span class="kn">set</span><span class="w"> </span><span class="nv">$mobile</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$http_user_agent</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">&quot;(android|iphone|mobile)&quot;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">set</span><span class="w"> </span><span class="nv">$mobile</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$mobile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;yes&quot;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/mobile</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/desktop</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="common-pitfalls-solutions">‚ö†Ô∏è <strong>COMMON PITFALLS &amp; SOLUTIONS</strong></h2>
<h3 id="1-trailing-slash-issues"><strong>1. Trailing Slash Issues</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># BAD: Inconsistent behavior</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># /api  ‚Üí backend sees /api</span>
<span class="w">    </span><span class="c1"># /api/ ‚Üí backend sees /api/</span>
<span class="w">    </span><span class="c1"># /api/users ‚Üí backend sees /api/users</span>
<span class="p">}</span>

<span class="c1"># GOOD: Consistent with trailing slash in proxy_pass</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend:8080/</span><span class="p">;</span><span class="w">  </span><span class="c1"># Note trailing slash</span>
<span class="w">    </span><span class="c1"># /api  ‚Üí backend sees /</span>
<span class="w">    </span><span class="c1"># /api/ ‚Üí backend sees /</span>
<span class="w">    </span><span class="c1"># /api/users ‚Üí backend sees /users</span>
<span class="p">}</span>

<span class="c1"># ALTERNATIVE: Explicit rewrite</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">rewrite</span><span class="w"> </span><span class="s">^/api(/.*)?</span>$<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="s">break</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend:8080</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-regex-priority-problems"><strong>2. Regex Priority Problems</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># BAD: Regex blocks static files</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># This will catch /test.php.jpg !</span>
<span class="p">}</span>

<span class="c1"># GOOD: More specific regex</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Only if .php is at end of path</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">if</span><span class="w"> </span><span class="s">(</span><span class="nv">$uri</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php\..*$)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">return</span><span class="w"> </span><span class="mi">404</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1"># ... PHP handling</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># BETTER: Use exact match for extensions when possible</span>
<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">^[^?]+\.php</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Only matches .php at end before query string</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-try_files-misuse"><strong>3. Try_files Misuse</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># BAD: Infinite loop</span>
<span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">@backend</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">@backend</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend:8080</span><span class="p">;</span>
<span class="w">    </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">@backend</span><span class="p">;</span><span class="w">  </span><span class="c1"># OOPS! Recursive</span>
<span class="p">}</span>

<span class="c1"># GOOD: Clear fallback chain</span>
<span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="p">=</span><span class="mi">404</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># No try_files for API endpoints</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend:8080</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="debugging-location-blocks">üìä <strong>DEBUGGING LOCATION BLOCKS</strong></h2>
<h3 id="debug-configuration"><strong>Debug Configuration</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Add to location for debugging</span>
<span class="k">location</span><span class="w"> </span><span class="s">/test</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># Log matching information</span>
<span class="w">    </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/debug.log</span><span class="w"> </span><span class="s">debug</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Echo variables to see what&#39;s happening</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Debug-Location</span><span class="w"> </span><span class="s">&quot;test-location&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Debug-Uri</span><span class="w"> </span><span class="nv">$uri</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Debug-Args</span><span class="w"> </span><span class="nv">$args</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Or use echo module if installed</span>
<span class="w">    </span><span class="c1"># echo &quot;Location matched: test&quot;;</span>
<span class="w">    </span><span class="c1"># echo &quot;URI: $uri&quot;;</span>

<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://backend:8080</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="check-priority-order"><strong>Check Priority Order</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Test config with this pattern</span>
<span class="k">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/exact</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Match-Type</span><span class="w"> </span><span class="s">exact</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">^~</span><span class="w"> </span><span class="s">/priority</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Match-Type</span><span class="w"> </span><span class="s">priority-prefix</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">regex</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Match-Type</span><span class="w"> </span><span class="s">regex</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span><span class="w"> </span><span class="s">/prefix</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Match-Type</span><span class="w"> </span><span class="s">prefix</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="quick-reference-card">üéØ <strong>QUICK REFERENCE CARD</strong></h2>
<h3 id="location-modifiers"><strong>Location Modifiers:</strong></h3>
<ul>
<li><code>location = /path</code> ‚Üí <strong>Exact match</strong> (highest priority)</li>
<li><code>location ^~ /path</code> ‚Üí <strong>Priority prefix</strong> (no regex check)</li>
<li><code>location ~ pattern</code> ‚Üí <strong>Case-sensitive regex</strong></li>
<li><code>location ~* pattern</code> ‚Üí <strong>Case-insensitive regex</strong></li>
<li><code>location /path</code> ‚Üí <strong>Regular prefix</strong> (longest wins)</li>
</ul>
<h3 id="evaluation-order"><strong>Evaluation Order:</strong></h3>
<ol>
<li><code>=</code> (exact)</li>
<li><code>^~</code> (priority prefix)  </li>
<li><code>~</code> and <code>~*</code> (regex, in order)</li>
<li><code>/path</code> (prefix, longest first)</li>
</ol>
<h3 id="pro-tips"><strong>Pro Tips:</strong></h3>
<ol>
<li><strong>Always test location order</strong> - use <code>curl -I</code> to check headers</li>
<li><strong>Be careful with regex</strong> - they're evaluated for EVERY request</li>
<li><strong>Use <code>^~</code> for static files</strong> to skip regex processing</li>
<li><strong>Remember trailing slashes</strong> in <code>proxy_pass</code> and <code>root</code></li>
<li><strong>Keep locations simple</strong> - complex logic belongs in backend</li>
</ol>
<p>This is pure NGINX location block mastery ‚Äî no Kubernetes concepts, just raw NGINX configuration patterns.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.expand", "navigation.sections", "navigation.top", "content.code.copy", "search.highlight"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>