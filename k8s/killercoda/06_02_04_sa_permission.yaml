# --- ServiceAccounts ---
apiVersion: v1
kind: ServiceAccount
metadata:
  namespace: ns1
  name: pipeline
---
apiVersion: v1
kind: ServiceAccount
metadata:
  namespace: ns2
  name: pipeline
---
# --- ns1: Role + RoleBinding for deployments ---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pipeline-ns1-role
  namespace: ns1
rules:
  - apiGroups: ["apps"]
    resources: ["deployments"]
    verbs: ["create", "delete"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pipeline-ns1-role-binding
  namespace: ns1
subjects:
  - kind: ServiceAccount
    name: pipeline
    namespace: ns1
    apiGroup: ""   # must be empty for ServiceAccount
roleRef:
  kind: Role
  name: pipeline-ns1-role   # must match the Role name
  apiGroup: rbac.authorization.k8s.io
---
# --- ns2: Role + RoleBinding for deployments ---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pipeline-ns2-role
  namespace: ns2
rules:
  - apiGroups: ["apps"]
    resources: ["deployments"]
    verbs: ["create", "delete"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pipeline-ns2-role-binding
  namespace: ns2   # must match Role’s namespace
subjects:
  - kind: ServiceAccount
    name: pipeline
    namespace: ns2
    apiGroup: ""
roleRef:
  kind: Role
  name: pipeline-ns2-role   # must match the Role name
  apiGroup: rbac.authorization.k8s.io
---
# --- ClusterRoleBinding for cluster-wide view (ns1 pipeline) ---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: pipeline-ns1-view
subjects:
  - kind: ServiceAccount
    name: pipeline
    namespace: ns1
    apiGroup: ""
roleRef:
  kind: ClusterRole
  name: view
  apiGroup: rbac.authorization.k8s.io
---
# --- ClusterRoleBinding for cluster-wide view (ns2 pipeline) ---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: pipeline-ns2-view
subjects:
  - kind: ServiceAccount
    name: pipeline
    namespace: ns2
    apiGroup: ""
roleRef:
  kind: ClusterRole
  name: view
  apiGroup: rbac.authorization.k8s.io


---

# # namespace ns1 deployment manager
# k auth can-i delete deployments --as system:serviceaccount:ns1:pipeline -n ns1 # YES
# k auth can-i create deployments --as system:serviceaccount:ns1:pipeline -n ns1 # YES
# k auth can-i update deployments --as system:serviceaccount:ns1:pipeline -n ns1 # NO
# k auth can-i update deployments --as system:serviceaccount:ns1:pipeline -n default # NO

# # namespace ns2 deployment manager
# k auth can-i delete deployments --as system:serviceaccount:ns2:pipeline -n ns2 # YES
# k auth can-i create deployments --as system:serviceaccount:ns2:pipeline -n ns2 # YES
# k auth can-i update deployments --as system:serviceaccount:ns2:pipeline -n ns2 # NO
# k auth can-i update deployments --as system:serviceaccount:ns2:pipeline -n default # NO

# # cluster wide view role
# k auth can-i list deployments --as system:serviceaccount:ns1:pipeline -n ns1 # YES
# k auth can-i list deployments --as system:serviceaccount:ns1:pipeline -A # YES
# k auth can-i list pods --as system:serviceaccount:ns1:pipeline -A # YES
# k auth can-i list pods --as system:serviceaccount:ns2:pipeline -A # YES
# k auth can-i list secrets --as system:serviceaccount:ns2:pipeline -A # NO (default view-role doesn't allow)

# Exam Desktop
# Editor
# Tab 1
# +





# Fixes made

# roleRef.name now correctly matches the Role name (pipeline-ns1-role, pipeline-ns2-role) — before you had pipeline-role, which didn’t exist.

# RoleBinding.metadata.namespace for ns2 was mistakenly ns1 — fixed to ns2.

# apiGroup: "" is used correctly for ServiceAccounts in subjects.

# Used the built-in view ClusterRole for cluster-wide read access.