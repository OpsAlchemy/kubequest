# # The idea here is to misconfigure the Apiserver in different ways, then check possible log locations for errors.
# # You should be very comfortable with situations where the Apiserver is not coming back up.
# # Configure the Apiserver manifest with a new argument --this-is-very-wrong .
# # Check if the Pod comes back up and what logs this causes.
# # Fix the Apiserver again.


# controlplane:/etc/kubernetes/manifests$ kubectl get pods -A\
# > ^C
# controlplane:/etc/kubernetes/manifests$ kubectl get pods -A 
# The connection to the server 172.30.1.2:6443 was refused - did you specify the right host or port?
# controlplane:/etc/kubernetes/manifests$ cat /var/log/pods
# cat: /var/log/pods: Is a directory
# controlplane:/etc/kubernetes/manifests$ cd /var/log
# controlplane:/var/log$ ls
# README            apt                    containers    dmesg.1.gz      killercoda  syslog
# Xorg.0.log        auth.log               cups          dmesg.2.gz      landscape   sysstat
# alternatives.log  btmp                   cups-browsed  dpkg.log        lastlog     unattended-upgrades
# apport.log        calico                 dist-upgrade  fontconfig.log  lightdm     wtmp
# apport.log.1      cloud-init-output.log  dmesg         journal         pods
# apport.log.2.gz   cloud-init.log         dmesg.0       kern.log        private
# controlplane:/var/log$ cd pods
# controlplane:/var/log/pods$ ls
# kube-system_calico-kube-controllers-fdf5f5495-8jbqm_7ac5e0c1-e88f-4814-aeaa-db71d4a41248
# kube-system_canal-rtfc5_c1f261ea-9cbf-43ca-885e-7c7811b8d5f6
# kube-system_coredns-6ff97d97f9-2rxsf_2001369b-a888-4bdd-8555-c8d026262009
# kube-system_coredns-6ff97d97f9-85m5c_7eef878c-2943-4bf3-be3c-a442c8c1eedb
# kube-system_etcd-controlplane_0a20c757572c0a1fc40cf46300cfcf97
# kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4
# kube-system_kube-controller-manager-controlplane_bc2d002eef4f6ab030edec4bdf370f16
# kube-system_kube-proxy-7kdz8_e7ad3206-b5e2-43c4-8f7a-6380b39e9208
# kube-system_kube-scheduler-controlplane_3bfb9bf8f1e4a4dbe1a89a770e151a87
# local-path-storage_local-path-provisioner-5c94487ccb-gmwjg_90bd1749-4aa8-4158-bc70-7f85e1b31626
# controlplane:/var/log/pods$ cat kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/
# cat: kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/: Is a directory
# controlplane:/var/log/pods$ cd kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/
# controlplane:/var/log/pods/kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4$ ls
# kube-apiserver
# controlplane:/var/log/pods/kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4$ cd kube-apiserver/
# controlplane:/var/log/pods/kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/kube-apiserver$ ls
# 4.log
# controlplane:/var/log/pods/kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/kube-apiserver$ cat 4.log
# 2025-08-23T02:49:02.855887445Z stderr F Error: unknown flag: --this-is-very-wrong
# controlplane:/var/log/pods/kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/kube-apiserver$ cat /var/log/containers
# cat: /var/log/containers: Is a directory
# controlplane:/var/log/pods/kube-system_kube-apiserver-controlplane_49bacb5cae5c51ba8b4dc938cec127e4/kube-apiserver$ cd /var/log/containers
# controlplane:/var/log/containers$ ls
# calico-kube-controllers-fdf5f5495-8jbqm_kube-system_calico-kube-controllers-153a4c2e0831e54ee969e747ce7e63874a0c2851037cdd657c09c83fdbc2b2f9.log
# calico-kube-controllers-fdf5f5495-8jbqm_kube-system_calico-kube-controllers-71c23b9b086dc5a5a9d420a263671d5b0398e2dba14f97cec6c04fc4059ee476.log
# canal-rtfc5_kube-system_calico-node-3268c994911f6f0dee943bc20ae3144c845a935552860a26117113f766f43a6b.log
# canal-rtfc5_kube-system_calico-node-acb3df6824931ff8bec6741d13d6fe0813d0b58e80d258d0f4cd510938a8830a.log
# canal-rtfc5_kube-system_install-cni-f75d43a9da7b3b70a7344153f01d2acdcb73e068283c2beafdf75427fe2e3e42.log
# canal-rtfc5_kube-system_kube-flannel-9959fa9e11566c57654d19aa5fc4c9c64112714ba2c17eccadbb2d977a17b6bd.log
# canal-rtfc5_kube-system_kube-flannel-d086b88a2535aca10c52918b1280854ce4ae06a162218160c8a25a57333643a4.log
# canal-rtfc5_kube-system_mount-bpffs-ef49bbf92b4bea2c60abe7c19c37a972fb728735724b3afa4e25bdb9c17dff8c.log
# coredns-6ff97d97f9-2rxsf_kube-system_coredns-d95ca82081ac05e596372c70038b9b26ebfe2cc35f23fe39bc5fedb89c8c556f.log
# coredns-6ff97d97f9-2rxsf_kube-system_coredns-fc8002a7d28c01d4a476af330bbf73bc8ffbe6f0bce06b0868742f162f4dead3.log
# coredns-6ff97d97f9-85m5c_kube-system_coredns-167b0946f571b21fe66d072cb245861c0fa797851d7d57bb4befe9c7d600ebf5.log
# coredns-6ff97d97f9-85m5c_kube-system_coredns-824511e16580b582fe03ffd795200474babec06be472cc3f77e9c8a3b4cd58a1.log
# etcd-controlplane_kube-system_etcd-50481e2aa1688d9258ce8567f667b3b5c9eec3b7b0bee8e9db3e6c398cdc75fb.log
# etcd-controlplane_kube-system_etcd-ad415e1704cf13d5407a7944cd621b76e18e5e8de4b9e31e8448da1c7c72a433.log
# kube-apiserver-controlplane_kube-system_kube-apiserver-1bb8f023e594df4bfc17c1a4486e5014925880e6eee1b0a2554e99c824c05adf.log
# kube-controller-manager-controlplane_kube-system_kube-controller-manager-914c342d2412cb057b96b56bda09ecda070edeff2e324efa0b75adadd49ed376.log
# kube-controller-manager-controlplane_kube-system_kube-controller-manager-dfb2955cbb30681ab22de87cb4d7cf7686ad64d4f3a27f65069adf7236d4a6d5.log
# kube-proxy-7kdz8_kube-system_kube-proxy-4c881ddd2fd7df9becf4d4b6eee7b77b3066410a7e3b0f7e8c29a7f52780562e.log
# kube-proxy-7kdz8_kube-system_kube-proxy-aa945d6c206f8b28dc1094c17ce54bf4797c07cb5c1eb756762d32b74504f6b4.log
# kube-scheduler-controlplane_kube-system_kube-scheduler-0a888fc47a665facb8e2571142d1982e830eeef9bc43f82d460b37d90fa0a3d4.log
# kube-scheduler-controlplane_kube-system_kube-scheduler-43dc491013e5f1e5c052e16d92adbdb7ff7ffd808c1b62a4ac8b9b5a6273fc32.log
# local-path-provisioner-5c94487ccb-gmwjg_local-path-storage_local-path-provisioner-bc5709afb8c2a6ff217483862211a16d559e48ac20e6303d6a18c51ef6560ab4.log
# local-path-provisioner-5c94487ccb-gmwjg_local-path-storage_local-path-provisioner-bf0ff3d39592c7b05f05a8e2f6215569c20b5ebfa56a26627b0a1980198575b4.log
# controlplane:/var/log/containers$ cd kube-apiserver-controlplane_kube-system_kube-apiserver-1bb8f023e594df4bfc17c1a4486e5014925880e6eee1b0a2554e99c824c05adf.log
# bash: cd: kube-apiserver-controlplane_kube-system_kube-apiserver-1bb8f023e594df4bfc17c1a4486e5014925880e6eee1b0a2554e99c824c05adf.log: Not a directory
# controlplane:/var/log/containers$ cat kube-apiserver-controlplane_kube-system_kube-apiserver-1bb8f023e594df4bfc17c1a4486e5014925880e6eee1b0a2554e99c824c05adf.log
# 2025-08-23T02:50:31.847661303Z stderr F Error: unknown flag: --this-is-very-wrong
# controlplane:/var/log/containers$ crictl ps
# CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD                                       NAMESPACE
# 0a888fc47a665       cfed1ff748928       4 minutes ago       Running             kube-scheduler            2                   c811356bfbc40       kube-scheduler-controlplane               kube-system
# 914c342d2412c       ff4f56c76b82d       4 minutes ago       Running             kube-controller-manager   2                   c37c634012222       kube-controller-manager-controlplane      kube-system
# 167b0946f571b       1cf5f116067c6       4 hours ago         Running             coredns                   1                   895eef49aacc1       coredns-6ff97d97f9-85m5c                  kube-system
# d95ca82081ac0       1cf5f116067c6       4 hours ago         Running             coredns                   1                   991a9bbcb876d       coredns-6ff97d97f9-2rxsf                  kube-system
# bf0ff3d39592c       3461b62f768ea       4 hours ago         Running             local-path-provisioner    1                   b967b24996b9d       local-path-provisioner-5c94487ccb-gmwjg   local-path-storage
# 9959fa9e11566       e6ea68648f0cd       4 hours ago         Running             kube-flannel              1                   7e5ab3107fb37       canal-rtfc5                               kube-system
# 3268c994911f6       75392e3500e36       4 hours ago         Running             calico-node               1                   7e5ab3107fb37       canal-rtfc5                               kube-system
# aa945d6c206f8       661d404f36f01       4 hours ago         Running             kube-proxy                1                   eda3bc95bfbc8       kube-proxy-7kdz8                          kube-system
# 50481e2aa1688       499038711c081       4 hours ago         Running             etcd                      1                   c3513ccff356d       etcd-controlplane                         kube-system
# controlplane:/var/log/containers$ crictl ps -a
# CONTAINER           IMAGE               CREATED              STATE               NAME                      ATTEMPT             POD ID              POD                                       NAMESPACE
# 71c23b9b086dc       f9c3c1813269c       About a minute ago   Exited              calico-kube-controllers   5                   af4829eda0445       calico-kube-controllers-fdf5f5495-8jbqm   kube-system
# 1bb8f023e594d       ee794efa53d85       About a minute ago   Exited              kube-apiserver            5                   6d0b65d8ad780       kube-apiserver-controlplane               kube-system
# 0a888fc47a665       cfed1ff748928       5 minutes ago        Running             kube-scheduler            2                   c811356bfbc40       kube-scheduler-controlplane               kube-system
# 914c342d2412c       ff4f56c76b82d       5 minutes ago        Running             kube-controller-manager   2                   c37c634012222       kube-controller-manager-controlplane      kube-system
# 167b0946f571b       1cf5f116067c6       4 hours ago          Running             coredns                   1                   895eef49aacc1       coredns-6ff97d97f9-85m5c                  kube-system
# d95ca82081ac0       1cf5f116067c6       4 hours ago          Running             coredns                   1                   991a9bbcb876d       coredns-6ff97d97f9-2rxsf                  kube-system
# bf0ff3d39592c       3461b62f768ea       4 hours ago          Running             local-path-provisioner    1                   b967b24996b9d       local-path-provisioner-5c94487ccb-gmwjg   local-path-storage
# 9959fa9e11566       e6ea68648f0cd       4 hours ago          Running             kube-flannel              1                   7e5ab3107fb37       canal-rtfc5                               kube-system
# 3268c994911f6       75392e3500e36       4 hours ago          Running             calico-node               1                   7e5ab3107fb37       canal-rtfc5                               kube-system
# ef49bbf92b4be       75392e3500e36       4 hours ago          Exited              mount-bpffs               0                   7e5ab3107fb37       canal-rtfc5                               kube-system
# f75d43a9da7b3       67fd9ab484510       4 hours ago          Exited              install-cni               2                   7e5ab3107fb37       canal-rtfc5                               kube-system
# aa945d6c206f8       661d404f36f01       4 hours ago          Running             kube-proxy                1                   eda3bc95bfbc8       kube-proxy-7kdz8                          kube-system
# dfb2955cbb306       ff4f56c76b82d       4 hours ago          Exited              kube-controller-manager   1                   c37c634012222       kube-controller-manager-controlplane      kube-system
# 43dc491013e5f       cfed1ff748928       4 hours ago          Exited              kube-scheduler            1                   c811356bfbc40       kube-scheduler-controlplane               kube-system
# 50481e2aa1688       499038711c081       4 hours ago          Running             etcd                      1                   c3513ccff356d       etcd-controlplane                         kube-system
# bc5709afb8c2a       3461b62f768ea       3 days ago           Exited              local-path-provisioner    0                   e1478116c3bca       local-path-provisioner-5c94487ccb-gmwjg   local-path-storage
# ad415e1704cf1       499038711c081       3 days ago           Exited              etcd                      0                   380ec7a73663d       etcd-controlplane                         kube-system
# fc8002a7d28c0       1cf5f116067c6       3 days ago           Exited              coredns                   0                   846b6b610bb4b       coredns-6ff97d97f9-2rxsf                  kube-system
# 824511e16580b       1cf5f116067c6       3 days ago           Exited              coredns                   0                   d105d1a4935b0       coredns-6ff97d97f9-85m5c                  kube-system
# d086b88a2535a       e6ea68648f0cd       3 days ago           Exited              kube-flannel              0                   f97ce3fd667bb       canal-rtfc5                               kube-system
# acb3df6824931       75392e3500e36       3 days ago           Exited              calico-node               0                   f97ce3fd667bb       canal-rtfc5                               kube-system
# 4c881ddd2fd7d       661d404f36f01       3 days ago           Exited              kube-proxy                0                   158ad713edb53       kube-proxy-7kdz8                          kube-system
# controlplane:/var/log/containers$ crictl ps -a | grep apiserver
# 1bb8f023e594d       ee794efa53d85       About a minute ago   Exited              kube-apiserver            5                   6d0b65d8ad780       kube-apiserver-controlplane               kube-system
# controlplane:/var/log/containers$ crictl logs 6d0b65d8ad780
# E0823 02:52:41.525804  112424 log.go:32] "ContainerStatus from runtime service failed" err="rpc error: code = NotFound desc = an error occurred when try to find container \"6d0b65d8ad780\": not found" containerID="6d0b65d8ad780"
# FATA[0000] rpc error: code = NotFound desc = an error occurred when try to find container "6d0b65d8ad780": not found 
# controlplane:/var/log/containers$ crictl logs 1bb8f023e594d
# Error: unknown flag: --this-is-very-wrong
# controlplane:/var/log/containers$ cd /etc/kubernetes/manifests/
# controlplane:/etc/kubernetes/manifests$ ls
# etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml
# controlplane:/etc/kubernetes/manifests$ vi kube-apiserver.yaml 
# controlplane:/etc/kubernetes/manifests$ watch crictl ps
# controlplane:/etc/kubernetes/manifests$ kubectl get pods -A
# NAMESPACE            NAME                                      READY   STATUS             RESTARTS        AGE
# kube-system          calico-kube-controllers-fdf5f5495-8jbqm   0/1     CrashLoopBackOff   7 (2m51s ago)   3d17h
# kube-system          canal-rtfc5                               2/2     Running            2 (3h49m ago)   3d17h
# kube-system          coredns-6ff97d97f9-2rxsf                  1/1     Running            1 (3h49m ago)   3d17h
# kube-system          coredns-6ff97d97f9-85m5c                  1/1     Running            1 (3h49m ago)   3d17h
# kube-system          etcd-controlplane                         1/1     Running            1 (3h49m ago)   3d17h
# kube-system          kube-apiserver-controlplane               0/1     Running            0               3d17h
# kube-system          kube-controller-manager-controlplane      1/1     Running            2 (12m ago)     3d17h
# kube-system          kube-proxy-7kdz8                          1/1     Running            1 (3h49m ago)   3d17h
# kube-system          kube-scheduler-controlplane               0/1     Running            2 (12m ago)     3d17h
# local-path-storage   local-path-provisioner-5c94487ccb-gmwjg   1/1     Running            1 (3h49m ago)   3d17h
# controlplane:/etc/kubernetes/manifests$ cat kube-apiserver.yaml 
# apiVersion: v1
# kind: Pod
# metadata:
#   annotations:
#     kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint: 172.30.1.2:6443
#   creationTimestamp: null
#   labels:
#     component: kube-apiserver
#     tier: control-plane
#   name: kube-apiserver
#   namespace: kube-system
# spec:
#   containers:
#   - command:
#     - kube-apiserver
#     - --advertise-address=172.30.1.2
#     - --allow-privileged=true
#     - --authorization-mode=Node,RBAC
#     - --client-ca-file=/etc/kubernetes/pki/ca.crt
#     - --enable-admission-plugins=NodeRestriction
#     - --enable-bootstrap-token-auth=true
#     - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt
#     - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt
#     - --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key
#     - --etcd-servers=https://127.0.0.1:2379
#     - --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt
#     - --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key
#     - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
#     - --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt
#     - --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key
#     - --requestheader-allowed-names=front-proxy-client
#     - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt
#     - --requestheader-extra-headers-prefix=X-Remote-Extra-
#     - --requestheader-group-headers=X-Remote-Group
#     - --requestheader-username-headers=X-Remote-User
#     - --secure-port=6443
#     - --service-account-issuer=https://kubernetes.default.svc.cluster.local
#     - --service-account-key-file=/etc/kubernetes/pki/sa.pub
#     - --service-account-signing-key-file=/etc/kubernetes/pki/sa.key
#     - --service-cluster-ip-range=10.96.0.0/12
#     - --tls-cert-file=/etc/kubernetes/pki/apiserver.crt
#     - --tls-private-key-file=/etc/kubernetes/pki/apiserver.key
#     image: registry.k8s.io/kube-apiserver:v1.33.2
#     imagePullPolicy: IfNotPresent
#     livenessProbe:
#       failureThreshold: 8
#       httpGet:
#         host: 172.30.1.2
#         path: /livez
#         port: 6443
#         scheme: HTTPS
#       initialDelaySeconds: 10
#       periodSeconds: 10
#       timeoutSeconds: 15
#     name: kube-apiserver
#     readinessProbe:
#       failureThreshold: 3
#       httpGet:
#         host: 172.30.1.2
#         path: /readyz
#         port: 6443
#         scheme: HTTPS
#       periodSeconds: 1
#       timeoutSeconds: 15
#     resources:
#       requests:
#         cpu: 50m
#     startupProbe:
#       failureThreshold: 24
#       httpGet:
#         host: 172.30.1.2
#         path: /livez
#         port: 6443
#         scheme: HTTPS
#       initialDelaySeconds: 10
#       periodSeconds: 10
#       timeoutSeconds: 15
#     volumeMounts:
#     - mountPath: /etc/ssl/certs
#       name: ca-certs
#       readOnly: true
#     - mountPath: /etc/ca-certificates
#       name: etc-ca-certificates
#       readOnly: true
#     - mountPath: /etc/kubernetes/pki
#       name: k8s-certs
#       readOnly: true
#     - mountPath: /usr/local/share/ca-certificates
#       name: usr-local-share-ca-certificates
#       readOnly: true
#     - mountPath: /usr/share/ca-certificates
#       name: usr-share-ca-certificates
#       readOnly: true
#   hostNetwork: true
#   priority: 2000001000
#   priorityClassName: system-node-critical
#   securityContext:
#     seccompProfile:
#       type: RuntimeDefault
#   volumes:
#   - hostPath:
#       path: /etc/ssl/certs
#       type: DirectoryOrCreate
#     name: ca-certs
#   - hostPath:
#       path: /etc/ca-certificates
#       type: DirectoryOrCreate
#     name: etc-ca-certificates
#   - hostPath:
#       path: /etc/kubernetes/pki
#       type: DirectoryOrCreate
#     name: k8s-certs
#   - hostPath:
#       path: /usr/local/share/ca-certificates
#       type: DirectoryOrCreate
#     name: usr-local-share-ca-certificates
#   - hostPath:
#       path: /usr/share/ca-certificates
#       type: DirectoryOrCreate
#     name: usr-share-ca-certificates
# status: {}
# controlplane:/etc/kubernetes/manifests$ 




