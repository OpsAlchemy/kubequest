<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/17-authorization/cani/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Cani - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Section 5 \u2014 kubectl auth can-i (Deep, Correct, Practical)", url: "#_top", children: [
              {title: "What kubectl auth can-i Actually Does", url: "#what-kubectl-auth-can-i-actually-does" },
              {title: "5.1 Basic Usage (Current User)", url: "#51-basic-usage-current-user" },
              {title: "5.2 Acting As Another Identity (--as)", url: "#52-acting-as-another-identity-as" },
              {title: "5.3 Common Mistake \u2014 Wrong ServiceAccount Identity", url: "#53-common-mistake-wrong-serviceaccount-identity" },
              {title: "5.4 Checking Cluster-Scoped Resources", url: "#54-checking-cluster-scoped-resources" },
              {title: "5.5 Verb + Resource Accuracy (Exam Trap)", url: "#55-verb-resource-accuracy-exam-trap" },
              {title: "5.6 Subresource Checks", url: "#56-subresource-checks" },
              {title: "5.7 Listing Effective Permissions", url: "#57-listing-effective-permissions" },
              {title: "5.8 Wildcard Checks (Debug Only)", url: "#58-wildcard-checks-debug-only" },
              {title: "5.9 ResourceNames Behavior", url: "#59-resourcenames-behavior" },
              {title: "5.10 Debug Flow Using can-i (Exam Pattern)", url: "#510-debug-flow-using-can-i-exam-pattern" },
              {title: "Section 5 \u2014 Hard Rules to Remember", url: "#section-5-hard-rules-to-remember" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../examples/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../examples/" class="btn btn-xs btn-link">
        Examples
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../15-troubleshoot-controlplane/prerequisite-and-approach/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../15-troubleshoot-controlplane/prerequisite-and-approach/" class="btn btn-xs btn-link">
        How to Approach Control Plane Issues
      </a>
    </div>
    
  </div>

    

    <p>Below is <strong>SECTION 5</strong> only.
Focused on <strong><code>kubectl auth can-i</code> — complete, correct usage with full examples and explanations</strong>.
This is an <strong>exam-critical debugging tool</strong>.</p>
<hr />
<h1 id="section-5-kubectl-auth-can-i-deep-correct-practical">Section 5 — <code>kubectl auth can-i</code> (Deep, Correct, Practical)</h1>
<hr />
<h2 id="what-kubectl-auth-can-i-actually-does">What <code>kubectl auth can-i</code> Actually Does</h2>
<p><code>kubectl auth can-i</code> answers <strong>one question only</strong>:</p>
<blockquote>
<p><strong>Does RBAC allow this subject to perform this action?</strong></p>
</blockquote>
<p>It checks:</p>
<ul>
<li>Roles</li>
<li>ClusterRoles</li>
<li>RoleBindings</li>
<li>ClusterRoleBindings</li>
</ul>
<p>It does <strong>NOT</strong> check:</p>
<ul>
<li>Admission controllers</li>
<li>PodSecurity</li>
<li>Resource existence</li>
<li>Runtime errors</li>
</ul>
<p>If <code>can-i</code> says <strong>yes</strong> and action fails → RBAC is <strong>not</strong> the issue.</p>
<hr />
<h2 id="51-basic-usage-current-user">5.1 Basic Usage (Current User)</h2>
<h3 id="example-1-can-i-read-pods">Example 1 — Can I read pods?</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>Uses current kubeconfig identity</li>
<li>Checks default namespace</li>
</ul>
<hr />
<h3 id="example-2-explicit-namespace">Example 2 — Explicit namespace</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dev
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>RBAC evaluation is <strong>namespace-aware</strong></li>
<li>Missing <code>-n</code> often causes confusion</li>
</ul>
<hr />
<h2 id="52-acting-as-another-identity-as">5.2 Acting As Another Identity (<code>--as</code>)</h2>
<h3 id="example-3-acting-as-a-user">Example 3 — Acting as a User</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>delete<span class="w"> </span>deployments<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--as<span class="w"> </span>alice<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>prod
</code></pre></div>
<p>Explanation:</p>
<ul>
<li><code>alice</code> must match <strong>exact user name</strong> from auth provider</li>
<li>Namespace is mandatory for namespaced resources</li>
</ul>
<hr />
<h3 id="example-4-acting-as-a-serviceaccount-correct-format">Example 4 — Acting as a ServiceAccount (CORRECT FORMAT)</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--as<span class="w"> </span>system:serviceaccount:default:my-sa<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>default
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>ServiceAccount identity is <strong>always expanded</strong></li>
<li>Short names (<code>--as my-sa</code>) will not match</li>
</ul>
<hr />
<h2 id="53-common-mistake-wrong-serviceaccount-identity">5.3 Common Mistake — Wrong ServiceAccount Identity</h2>
<h3 id="wrong">❌ Wrong</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--as<span class="w"> </span>prometheus
</code></pre></div>
<h3 id="correct">✅ Correct</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--as<span class="w"> </span>system:serviceaccount:monitoring:prometheus<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>prod
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>RBAC matches <strong>full identity string</strong></li>
<li>Namespace is part of identity</li>
</ul>
<hr />
<h2 id="54-checking-cluster-scoped-resources">5.4 Checking Cluster-Scoped Resources</h2>
<h3 id="example-5-nodes-cluster-scoped">Example 5 — Nodes (cluster-scoped)</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w"> </span>nodes
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>No namespace flag</li>
<li>Requires ClusterRole + ClusterRoleBinding</li>
</ul>
<hr />
<h3 id="example-6-namespaces">Example 6 — Namespaces</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>namespaces
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>Namespaces are cluster-scoped</li>
<li>RoleBinding can never grant this</li>
</ul>
<hr />
<h2 id="55-verb-resource-accuracy-exam-trap">5.5 Verb + Resource Accuracy (Exam Trap)</h2>
<h3 id="example-7-wrong-resource-name">Example 7 — Wrong resource name</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>deployment
</code></pre></div>
<p>Result:</p>
<div class="highlight"><pre><span></span><code>no
</code></pre></div>
<h3 id="correct_1">Correct</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>deployments.apps
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>CLI uses <strong>fully qualified resource</strong></li>
<li>Same rule as <code>kubectl create role</code></li>
</ul>
<hr />
<h2 id="56-subresource-checks">5.6 Subresource Checks</h2>
<h3 id="example-8-logs">Example 8 — Logs</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>pods/log<span class="w"> </span>-n<span class="w"> </span>debug
</code></pre></div>
<p>Explanation:</p>
<ul>
<li><code>pods</code> permission ≠ <code>pods/log</code></li>
<li>This explains <code>kubectl logs</code> failures</li>
</ul>
<hr />
<h3 id="example-9-exec">Example 9 — Exec</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>pods/exec<span class="w"> </span>-n<span class="w"> </span>dev
</code></pre></div>
<p>Explanation:</p>
<ul>
<li><code>exec</code> uses <code>create</code> verb</li>
<li>Very common exam trap</li>
</ul>
<hr />
<h2 id="57-listing-effective-permissions">5.7 Listing Effective Permissions</h2>
<h3 id="example-10-what-can-i-do">Example 10 — What can I do?</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>--list
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>Shows <strong>all RBAC-allowed actions</strong></li>
<li>Only for current user</li>
<li>Namespaced output if <code>-n</code> is provided</li>
</ul>
<hr />
<h3 id="example-11-namespace-specific-listing">Example 11 — Namespace-specific listing</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>--list<span class="w"> </span>-n<span class="w"> </span>prod
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>Extremely useful to debug RoleBindings</li>
</ul>
<hr />
<h2 id="58-wildcard-checks-debug-only">5.8 Wildcard Checks (Debug Only)</h2>
<h3 id="example-12-full-access-check">Example 12 — Full access check</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="s1">&#39;*&#39;</span>
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>Indicates cluster-admin-like access</li>
<li>Never use as justification for least privilege</li>
</ul>
<hr />
<h2 id="59-resourcenames-behavior">5.9 ResourceNames Behavior</h2>
<h3 id="example-13-specific-object-access">Example 13 — Specific object access</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>get<span class="w"> </span>secrets/db-creds<span class="w"> </span>-n<span class="w"> </span>finance
</code></pre></div>
<p>Explanation:</p>
<ul>
<li>Tests <code>resourceNames</code></li>
<li><code>list</code> will still fail</li>
</ul>
<hr />
<h3 id="example-14-list-still-denied">Example 14 — List still denied</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w"> </span>secrets<span class="w"> </span>-n<span class="w"> </span>finance
</code></pre></div>
<p>Explanation:</p>
<ul>
<li><code>resourceNames</code> blocks list</li>
<li>Very common misunderstanding</li>
</ul>
<hr />
<h2 id="510-debug-flow-using-can-i-exam-pattern">5.10 Debug Flow Using <code>can-i</code> (Exam Pattern)</h2>
<h3 id="typical-exam-debug-steps">Typical Exam Debug Steps</h3>
<ol>
<li>Test action:</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dev
</code></pre></div>
<ol>
<li>Test identity explicitly:</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>pods<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--as<span class="w"> </span>system:serviceaccount:ci:ci-bot<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-n<span class="w"> </span>dev
</code></pre></div>
<ol>
<li>Test subresource if needed:</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>create<span class="w"> </span>pods/exec<span class="w"> </span>-n<span class="w"> </span>dev
</code></pre></div>
<p>If all return <strong>yes</strong> → RBAC is correct.</p>
<hr />
<h2 id="section-5-hard-rules-to-remember">Section 5 — Hard Rules to Remember</h2>
<ul>
<li><code>can-i</code> checks <strong>RBAC only</strong></li>
<li>Always specify <code>-n</code> for namespaced resources</li>
<li>ServiceAccount must use full identity string</li>
<li>Subresources must be checked explicitly</li>
<li>Cluster-scoped resources never use namespace</li>
<li><code>--list</code> is your RBAC truth view</li>
</ul>
<hr />
<p>Say <strong>“section 6”</strong> for <strong>system users, nodes, and control-plane components</strong>
or <strong>“final cram”</strong> for a <strong>one-page RBAC exam summary</strong>.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../examples/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../examples/" class="btn btn-xs btn-link">
        Examples
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../15-troubleshoot-controlplane/prerequisite-and-approach/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../15-troubleshoot-controlplane/prerequisite-and-approach/" class="btn btn-xs btn-link">
        How to Approach Control Plane Issues
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>