<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/03-kustomize/notes/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Kustomize Master Guide: Advanced Patterns &amp; Modern Practices - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Kustomize Master Guide: Advanced Patterns \u0026amp; Modern Practices", url: "#_top", children: [
              {title: "\ud83d\ude80 Overview \u0026amp; Philosophy", url: "#overview-philosophy" },
              {title: "\ud83d\udcc1 Advanced Project Structure", url: "#advanced-project-structure" },
              {title: "\u26a1 Modern kustomization.yaml Features", url: "#modern-kustomizationyaml-features" },
              {title: "\ud83c\udfaf Advanced Patching Techniques", url: "#advanced-patching-techniques" },
              {title: "\ud83d\udd17 Multi-Base Composition \u0026amp; Cross-Cutting", url: "#multi-base-composition-cross-cutting" },
              {title: "\ud83d\udd04 CI/CD Integration Patterns", url: "#cicd-integration-patterns" },
              {title: "\ud83d\udd10 Security \u0026amp; Compliance Patterns", url: "#security-compliance-patterns" },
              {title: "\ud83d\udea8 Production-Grade Patterns", url: "#production-grade-patterns" },
              {title: "\ud83e\uddea Testing \u0026amp; Validation", url: "#testing-validation" },
              {title: "\u2699\ufe0f Performance Optimizations", url: "#performance-optimizations" },
              {title: "\ud83d\udd27 Custom Transformers \u0026amp; Generators (Go Plugins)", url: "#custom-transformers-generators-go-plugins" },
              {title: "\ud83d\udcca Comparison with Modern Alternatives", url: "#comparison-with-modern-alternatives" },
              {title: "\ud83c\udfaf Best Practices Summary", url: "#best-practices-summary" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../questions/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../questions/" class="btn btn-xs btn-link">
        Kustomize Practice Questions (Compressed)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../answers/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../answers/" class="btn btn-xs btn-link">
        Kustomize Practice Answers (Compressed 3 Questions)
      </a>
    </div>
    
  </div>

    

    <h1 id="kustomize-master-guide-advanced-patterns-modern-practices"><strong>Kustomize Master Guide: Advanced Patterns &amp; Modern Practices</strong></h1>
<h2 id="overview-philosophy"><strong>üöÄ Overview &amp; Philosophy</strong></h2>
<p>Kustomize is a <strong>declarative configuration overlay system</strong> for Kubernetes, not a templating engine. It follows the <strong>"Everything as YAML"</strong> philosophy with <strong>patch-based inheritance</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Modern installation (standalone)</span>
brew<span class="w"> </span>install<span class="w"> </span>kustomize<span class="w">  </span><span class="c1"># macOS</span>
<span class="c1"># or</span>
curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bash

<span class="c1"># Built-in (kubectl v1.14+)</span>
kubectl<span class="w"> </span>kustomize<span class="w"> </span>&lt;dir&gt;
</code></pre></div>
<h2 id="advanced-project-structure"><strong>üìÅ Advanced Project Structure</strong></h2>
<div class="highlight"><pre><span></span><code>k8s/
‚îú‚îÄ‚îÄ base/
‚îÇ   ‚îú‚îÄ‚îÄ kustomization.yaml          # Base resources
‚îÇ   ‚îú‚îÄ‚îÄ namespace.yaml
‚îÇ   ‚îú‚îÄ‚îÄ rbac/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kustomization.yaml      # Component composition
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serviceaccount.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rolebinding.yaml
‚îÇ   ‚îú‚îÄ‚îÄ networking/
‚îÇ   ‚îú‚îÄ‚îÄ deployments/
‚îÇ   ‚îî‚îÄ‚îÄ monitoring/
‚îú‚îÄ‚îÄ components/                      # Reusable transformations
‚îÇ   ‚îú‚îÄ‚îÄ ingress-ssl/
‚îÇ   ‚îú‚îÄ‚îÄ pod-security/
‚îÇ   ‚îî‚îÄ‚îÄ resource-limits/
‚îú‚îÄ‚îÄ overlays/
‚îÇ   ‚îú‚îÄ‚îÄ region/                     # Multi-dimensional overlays
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ us-west/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ eu-central/
‚îÇ   ‚îú‚îÄ‚îÄ environment/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kustomization.yaml  # Environment config
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ namespace.yaml
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ patch-deployment.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ production/
‚îÇ   ‚îî‚îÄ‚îÄ tenant/                     # Multi-tenancy
‚îÇ       ‚îú‚îÄ‚îÄ team-a/
‚îÇ       ‚îî‚îÄ‚îÄ team-b/
‚îú‚îÄ‚îÄ clusters/                       # Cluster-specific configs
‚îÇ   ‚îú‚îÄ‚îÄ cluster-01/
‚îÇ   ‚îî‚îÄ‚îÄ cluster-02/
‚îî‚îÄ‚îÄ generators/                     # Dynamic resource generation
    ‚îú‚îÄ‚îÄ helm-charts/
    ‚îî‚îÄ‚îÄ jsonnet/
</code></pre></div>
<h2 id="modern-kustomizationyaml-features"><strong>‚ö° Modern kustomization.yaml Features</strong></h2>
<h3 id="components-kustomize-v4"><strong>Components (Kustomize v4+)</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># components/pod-security/kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Component</span>

<span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: add</span>
<span class="w">        </span><span class="no">path: /spec/securityContext</span>
<span class="w">        </span><span class="no">value:</span>
<span class="w">          </span><span class="no">runAsNonRoot: true</span>
<span class="w">          </span><span class="no">seccompProfile:</span>
<span class="w">            </span><span class="no">type: RuntimeDefault</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: add</span>
<span class="w">        </span><span class="no">path: /spec/template/spec/containers/0/securityContext</span>
<span class="w">        </span><span class="no">value:</span>
<span class="w">          </span><span class="no">allowPrivilegeEscalation: false</span>
<span class="w">          </span><span class="no">capabilities:</span>
<span class="w">            </span><span class="no">drop: [&quot;ALL&quot;]</span>
</code></pre></div>
<h3 id="replacements-kustomize-v45-advanced-variable-substitution"><strong>Replacements (Kustomize v4.5+) - Advanced Variable Substitution</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Base configmap</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">appVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2.1.0&quot;</span>
<span class="w">  </span><span class="nt">logLevel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>

<span class="c1"># Overlay using replacements</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment.yaml</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configmap.yaml</span>

<span class="nt">replacements</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Simple value copy</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
<span class="w">      </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data.appVersion</span>
<span class="w">    </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">select</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-deployment</span>
<span class="w">        </span><span class="nt">fieldPaths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.template.metadata.labels.version</span>

<span class="w">  </span><span class="c1"># Multiple field mapping</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
<span class="w">      </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data.replicas</span>
<span class="w">    </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">select</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">        </span><span class="nt">fieldPaths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.replicas</span>

<span class="w">  </span><span class="c1"># Complex transformations</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
<span class="w">      </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data.logLevel</span>
<span class="w">    </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">select</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">        </span><span class="nt">fieldPaths</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.template.spec.containers.[name=app].env.[name=LOG_LEVEL].value</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span>
<span class="w">          </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Create if doesn&#39;t exist</span>
</code></pre></div>
<h3 id="generators-dynamic-resource-creation"><strong>Generators - Dynamic Resource Creation</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># generators/secrets/kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="nt">secretGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-certs</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes.io/tls&quot;</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls.crt=./certs/server.crt</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls.key=./certs/server.key</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">sealedsecrets.bitnami.com/managed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">cert-manager.io/certificate-name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app-tls&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynamic-secret</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_PASSWORD=$(cat /dev/urandom | tr -dc &#39;a-zA-Z0-9&#39; | fold -w 32 | head -n 1)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_KEY=$(openssl rand -base64 32)</span>
<span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create</span><span class="w">  </span><span class="c1"># create, merge, or replace</span>

<span class="nt">configMapGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
<span class="w">    </span><span class="nt">envs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env.production</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env.secrets</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config.yaml</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;*.conf&quot;</span><span class="w">  </span><span class="c1"># Wildcard support</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">immutable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Kubernetes 1.19+ feature</span>

<span class="nt">generators</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w">  </span><span class="c1"># Inline generators</span>
<span class="w">    </span><span class="no">apiVersion: batch/v1</span>
<span class="w">    </span><span class="no">kind: Job</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: db-migration</span>
<span class="w">    </span><span class="no">spec:</span>
<span class="w">      </span><span class="no">template:</span>
<span class="w">        </span><span class="no">spec:</span>
<span class="w">          </span><span class="no">containers:</span>
<span class="w">          </span><span class="no">- name: migrator</span>
<span class="w">            </span><span class="no">image: alpine:latest</span>
<span class="w">          </span><span class="no">restartPolicy: Never</span>
</code></pre></div>
<h2 id="advanced-patching-techniques"><strong>üéØ Advanced Patching Techniques</strong></h2>
<h3 id="json-patch-rfc-6902-most-powerful"><strong>JSON Patch (RFC 6902) - Most Powerful</strong></h3>
<div class="highlight"><pre><span></span><code><span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.*&quot;</span><span class="w">  </span><span class="c1"># Regex support</span>
<span class="w">      </span><span class="nt">labelSelector</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;app=frontend&quot;</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">[</span>
<span class="w">        </span><span class="no">{</span>
<span class="w">          </span><span class="no">&quot;op&quot;: &quot;add&quot;,</span>
<span class="w">          </span><span class="no">&quot;path&quot;: &quot;/spec/template/spec/tolerations&quot;,</span>
<span class="w">          </span><span class="no">&quot;value&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">              </span><span class="no">&quot;key&quot;: &quot;gpu&quot;,</span>
<span class="w">              </span><span class="no">&quot;operator&quot;: &quot;Equal&quot;,</span>
<span class="w">              </span><span class="no">&quot;value&quot;: &quot;nvidia&quot;,</span>
<span class="w">              </span><span class="no">&quot;effect&quot;: &quot;NoSchedule&quot;</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">          </span><span class="no">]</span>
<span class="w">        </span><span class="no">},</span>
<span class="w">        </span><span class="no">{</span>
<span class="w">          </span><span class="no">&quot;op&quot;: &quot;replace&quot;,</span>
<span class="w">          </span><span class="no">&quot;path&quot;: &quot;/spec/template/spec/containers/0/resources/limits/memory&quot;,</span>
<span class="w">          </span><span class="no">&quot;value&quot;: &quot;2Gi&quot;</span>
<span class="w">        </span><span class="no">},</span>
<span class="w">        </span><span class="no">{</span>
<span class="w">          </span><span class="no">&quot;op&quot;: &quot;copy&quot;,</span>
<span class="w">          </span><span class="no">&quot;from&quot;: &quot;/spec/replicas&quot;,</span>
<span class="w">          </span><span class="no">&quot;path&quot;: &quot;/spec/template/metadata/annotations/initialReplicas&quot;</span>
<span class="w">        </span><span class="no">},</span>
<span class="w">        </span><span class="no">{</span>
<span class="w">          </span><span class="no">&quot;op&quot;: &quot;test&quot;,  # Conditional - only apply if condition matches</span>
<span class="w">          </span><span class="no">&quot;path&quot;: &quot;/metadata/namespace&quot;,</span>
<span class="w">          </span><span class="no">&quot;value&quot;: &quot;production&quot;</span>
<span class="w">        </span><span class="no">}</span>
<span class="w">      </span><span class="no">]</span>

<span class="w">  </span><span class="c1"># Inline YAML patch</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">apiVersion: apps/v1</span>
<span class="w">      </span><span class="no">kind: Deployment</span>
<span class="w">      </span><span class="no">metadata:</span>
<span class="w">        </span><span class="no">name: app</span>
<span class="w">      </span><span class="no">spec:</span>
<span class="w">        </span><span class="no">template:</span>
<span class="w">          </span><span class="no">spec:</span>
<span class="w">            </span><span class="no">containers:</span>
<span class="w">            </span><span class="no">- name: main</span>
<span class="w">              </span><span class="no">envFrom:</span>
<span class="w">              </span><span class="no">- configMapRef:</span>
<span class="w">                  </span><span class="no">name: dynamic-config-$(CONFIG_HASH)</span>
<span class="w">    </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
</code></pre></div>
<h3 id="strategic-merge-patch-kubernetes-specific"><strong>Strategic Merge Patch - Kubernetes-Specific</strong></h3>
<div class="highlight"><pre><span></span><code><span class="nt">patchesStrategicMerge</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Add sidecar container (K8s knows how to merge arrays)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">apiVersion: apps/v1</span>
<span class="w">    </span><span class="no">kind: Deployment</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: app</span>
<span class="w">    </span><span class="no">spec:</span>
<span class="w">      </span><span class="no">template:</span>
<span class="w">        </span><span class="no">spec:</span>
<span class="w">          </span><span class="no">containers:</span>
<span class="w">          </span><span class="no">- name: istio-proxy</span>
<span class="w">            </span><span class="no">image: istio/proxyv2:1.16</span>
<span class="w">            </span><span class="no">resources:</span>
<span class="w">              </span><span class="no">requests:</span>
<span class="w">                </span><span class="no">cpu: 100m</span>
<span class="w">                </span><span class="no">memory: 128Mi</span>

<span class="w">  </span><span class="c1"># Add volume (merged by name)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">apiVersion: apps/v1</span>
<span class="w">    </span><span class="no">kind: Deployment</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: app</span>
<span class="w">    </span><span class="no">spec:</span>
<span class="w">      </span><span class="no">template:</span>
<span class="w">        </span><span class="no">spec:</span>
<span class="w">          </span><span class="no">volumes:</span>
<span class="w">          </span><span class="no">- name: nginx-config</span>
<span class="w">            </span><span class="no">configMap:</span>
<span class="w">              </span><span class="no">name: nginx-config</span>
</code></pre></div>
<h2 id="multi-base-composition-cross-cutting"><strong>üîó Multi-Base Composition &amp; Cross-Cutting</strong></h2>
<h3 id="cross-cutting-concerns-as-components"><strong>Cross-Cutting Concerns as Components</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># components/istio-sidecar-injection/kustomization.yaml (Component)</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Component</span>

<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">istio-system</span>

<span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: add</span>
<span class="w">        </span><span class="no">path: /metadata/labels/istio-injection</span>
<span class="w">        </span><span class="no">value: enabled</span>

<span class="c1"># components/linkerd-proxy/kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://raw.githubusercontent.com/linkerd/linkerd2/main/manifests/linkerd-crds.yaml</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://raw.githubusercontent.com/linkerd/linkerd2/main/manifests/linkerd-control-plane.yaml</span>

<span class="nt">transformers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w">  </span><span class="c1"># Inline transformer</span>
<span class="w">    </span><span class="no">apiVersion: builtin</span>
<span class="w">    </span><span class="no">kind: LabelTransformer</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: linkerd-injection</span>
<span class="w">    </span><span class="no">labels:</span>
<span class="w">      </span><span class="no">linkerd.io/inject: enabled</span>
<span class="w">    </span><span class="no">fieldSpecs:</span>
<span class="w">    </span><span class="no">- path: metadata/labels</span>
<span class="w">      </span><span class="no">create: true</span>
</code></pre></div>
<h3 id="dynamic-resource-inclusion"><strong>Dynamic Resource Inclusion</strong></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="c1"># Include remote bases</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.com/kubernetes-sigs/cluster-api//config/default?ref=v1.4.0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://raw.githubusercontent.com/prometheus-operator/kube-prometheus/main/manifests/setup/prometheus-operator-0servicemonitorCustomResourceDefinition.yaml</span>

<span class="c1"># Include local generated manifests</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../manifests-generated/</span><span class="w">  </span><span class="c1"># Helm output</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../jsonnet-output/</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./dynamic/</span><span class="w">  </span><span class="c1"># Generated by scripts</span>

<span class="c1"># Conditional inclusion using build args</span>
<span class="nt">vars</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FEATURE_FLAG</span>
<span class="w">    </span><span class="nt">objref</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">feature-flags</span>
<span class="w">    </span><span class="nt">fieldref</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fieldpath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data.enableMonitoring</span>

<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../monitoring/</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$(FEATURE_FLAG) == &quot;true&quot;</span>
</code></pre></div>
<h2 id="cicd-integration-patterns"><strong>üîÑ CI/CD Integration Patterns</strong></h2>
<h3 id="github-actions-workflow"><strong>GitHub Actions Workflow</strong></h3>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomize CI/CD</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">pull_request</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kustomize-validation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Kustomize</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imranismail/setup-kustomize@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kustomize-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;v5.0.0&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Validate All Overlays</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">for overlay in overlays/*/; do</span>
<span class="w">            </span><span class="no">echo &quot;Validating $overlay&quot;</span>
<span class="w">            </span><span class="no">kustomize build $overlay --load-restrictor=LoadRestrictionsNone | \</span>
<span class="w">              </span><span class="no">kubectl apply --dry-run=server --validate=true -f -</span>
<span class="w">          </span><span class="no">done</span>

<span class="w">  </span><span class="nt">kustomize-diff</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Kustomize Diff</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">git diff --name-only HEAD^ HEAD | grep -E &#39;(kustomization\.yaml|\.yaml$|\.yml$)&#39; | \</span>
<span class="w">            </span><span class="no">while read file; do</span>
<span class="w">              </span><span class="no">dir=$(dirname &quot;$file&quot;)</span>
<span class="w">              </span><span class="no">if [ -f &quot;$dir/kustomization.yaml&quot; ]; then</span>
<span class="w">                </span><span class="no">echo &quot;Changes detected in $dir&quot;</span>
<span class="w">                </span><span class="no">kustomize build &quot;$dir&quot; --load-restrictor=LoadRestrictionsNone &gt; /tmp/new.yaml</span>
<span class="w">                </span><span class="no">git checkout HEAD^ -- &quot;$dir&quot;</span>
<span class="w">                </span><span class="no">kustomize build &quot;$dir&quot; --load-restrictor=LoadRestrictionsNone &gt; /tmp/old.yaml</span>
<span class="w">                </span><span class="no">diff -u /tmp/old.yaml /tmp/new.yaml || true</span>
<span class="w">              </span><span class="no">fi</span>
<span class="w">            </span><span class="no">done</span>
</code></pre></div>
<h3 id="argocd-integration"><strong>ArgoCD Integration</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># argocd-application.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argoproj.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Application</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">source</span><span class="p">:</span>
<span class="w">    </span><span class="nt">repoURL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/org/repo.git</span>
<span class="w">    </span><span class="nt">targetRevision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s/overlays/production</span>
<span class="w">    </span><span class="nt">kustomize</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># ArgoCD-specific kustomize options</span>
<span class="w">      </span><span class="nt">namePrefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-</span>
<span class="w">      </span><span class="nt">nameSuffix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-v1</span>
<span class="w">      </span><span class="nt">images</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.21.0</span>
<span class="w">      </span><span class="nt">commonAnnotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">deployed-by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd</span>
<span class="w">      </span><span class="nt">commonLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">      </span><span class="c1"># Force common labels/annotations on all resources</span>
<span class="w">      </span><span class="nt">forceCommonLabels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">forceCommonAnnotations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="c1"># Replicas override</span>
<span class="w">      </span><span class="nt">replicas</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-deployment</span>
<span class="w">          </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.default.svc</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>

<span class="w">  </span><span class="nt">syncPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">automated</span><span class="p">:</span>
<span class="w">      </span><span class="nt">prune</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">selfHeal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">syncOptions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CreateNamespace=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PruneLast=true</span>
</code></pre></div>
<h2 id="security-compliance-patterns"><strong>üîê Security &amp; Compliance Patterns</strong></h2>
<h3 id="pod-security-standards-k8s-123"><strong>Pod Security Standards (K8s 1.23+)</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># components/psa-baseline/kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Component</span>

<span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: add</span>
<span class="w">        </span><span class="no">path: /metadata/labels</span>
<span class="w">        </span><span class="no">value:</span>
<span class="w">          </span><span class="no">pod-security.kubernetes.io/enforce: baseline</span>
<span class="w">          </span><span class="no">pod-security.kubernetes.io/enforce-version: latest</span>
<span class="w">          </span><span class="no">pod-security.kubernetes.io/audit: restricted</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: add</span>
<span class="w">        </span><span class="no">path: /spec/securityContext</span>
<span class="w">        </span><span class="no">value:</span>
<span class="w">          </span><span class="no">seccompProfile:</span>
<span class="w">            </span><span class="no">type: RuntimeDefault</span>
<span class="w">          </span><span class="no">runAsNonRoot: true</span>
</code></pre></div>
<h3 id="secrets-management-with-external-secrets"><strong>Secrets Management with External Secrets</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># overlays/production/secrets/kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="nt">generators</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w">  </span><span class="c1"># ExternalSecret (external-secrets.io)</span>
<span class="w">    </span><span class="no">apiVersion: external-secrets.io/v1beta1</span>
<span class="w">    </span><span class="no">kind: ExternalSecret</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: database-credentials</span>
<span class="w">    </span><span class="no">spec:</span>
<span class="w">      </span><span class="no">refreshInterval: 1h</span>
<span class="w">      </span><span class="no">secretStoreRef:</span>
<span class="w">        </span><span class="no">name: vault-backend</span>
<span class="w">        </span><span class="no">kind: SecretStore</span>
<span class="w">      </span><span class="no">target:</span>
<span class="w">        </span><span class="no">name: database-secret</span>
<span class="w">        </span><span class="no">creationPolicy: Owner</span>
<span class="w">      </span><span class="no">data:</span>
<span class="w">        </span><span class="no">- secretKey: password</span>
<span class="w">          </span><span class="no">remoteRef:</span>
<span class="w">            </span><span class="no">key: /secrets/production/db</span>
<span class="w">            </span><span class="no">property: password</span>
<span class="w">        </span><span class="no">- secretKey: username</span>
<span class="w">          </span><span class="no">remoteRef:</span>
<span class="w">            </span><span class="no">key: /secrets/production/db</span>
<span class="w">            </span><span class="no">property: username</span>

<span class="nt">configMapGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sealed-secret-params</span>
<span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace=production</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scope=strict</span>
</code></pre></div>
<h2 id="production-grade-patterns"><strong>üö® Production-Grade Patterns</strong></h2>
<h3 id="multi-cluster-management-with-kustomize"><strong>Multi-Cluster Management with Kustomize</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># clusters/aws-us-west-2/production/kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="c1"># Import environment overlay</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../../../overlays/production</span>

<span class="c1"># Cluster-specific patches</span>
<span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: replace</span>
<span class="w">        </span><span class="no">path: /metadata/annotations/nginx.ingress.kubernetes.io~1load-balancer-id</span>
<span class="w">        </span><span class="no">value: alb-1234567890</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: replace</span>
<span class="w">        </span><span class="no">path: /spec/storageClassName</span>
<span class="w">        </span><span class="no">value: gp3</span>

<span class="c1"># Cluster-specific generators</span>
<span class="nt">configMapGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-info</span>
<span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CLUSTER_NAME=aws-us-west-2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REGION=us-west-2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PROVIDER=aws</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC_ID=vpc-123456</span>
</code></pre></div>
<h3 id="feature-flag-management"><strong>Feature Flag Management</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># kustomization.yaml with feature flags</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="c1"># Feature flag ConfigMap</span>
<span class="nt">configMapGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">feature-flags</span>
<span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enableNewUI=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enableBetaFeatures=false</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">maintenanceMode=false</span>

<span class="c1"># Conditional resources based on feature flags</span>
<span class="nt">transformers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: add</span>
<span class="w">        </span><span class="no">path: /spec/template/spec/containers/0/env</span>
<span class="w">        </span><span class="no">value:</span>
<span class="w">          </span><span class="no">- name: FEATURE_NEW_UI</span>
<span class="w">            </span><span class="no">valueFrom:</span>
<span class="w">              </span><span class="no">configMapKeyRef:</span>
<span class="w">                </span><span class="no">name: feature-flags</span>
<span class="w">                </span><span class="no">key: enableNewUI</span>
<span class="w">          </span><span class="no">- name: BETA_FEATURES</span>
<span class="w">            </span><span class="no">valueFrom:</span>
<span class="w">              </span><span class="no">configMapKeyRef:</span>
<span class="w">                </span><span class="no">name: feature-flags</span>
<span class="w">                </span><span class="no">key: enableBetaFeatures</span>

<span class="c1"># Remove resources if feature is disabled</span>
<span class="nt">patches</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">beta-service</span>
<span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">- op: remove</span>
<span class="w">        </span><span class="no">path: /spec</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">allowMissingTarget</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<h2 id="testing-validation"><strong>üß™ Testing &amp; Validation</strong></h2>
<h3 id="kustomize-test-framework"><strong>Kustomize Test Framework</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment.yaml</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service.yaml</span>

<span class="c1"># tests/test.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KustomizationTest</span>

<span class="nt">tests</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment-has-correct-replicas</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../deployment.yaml</span>
<span class="w">    </span><span class="nt">asserts</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">equals</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.replicas</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service-selector-matches-deployment</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../deployment.yaml</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../service.yaml</span>
<span class="w">    </span><span class="nt">asserts</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">and</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">equals</span><span class="p">:</span>
<span class="w">            </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.selector.matchLabels.app</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">exists</span><span class="p">:</span>
<span class="w">            </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata.labels.app</span>
</code></pre></div>
<h3 id="conftest-integration-open-policy-agent"><strong>Conftest Integration (Open Policy Agent)</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># conftest-policy.rego</span>
package<span class="w"> </span>main

deny<span class="o">[</span>msg<span class="o">]</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span>input.kind<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;Deployment&quot;</span>
<span class="w">  </span>not<span class="w"> </span>input.spec.template.spec.securityContext.runAsNonRoot
<span class="w">  </span>msg<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment must set runAsNonRoot&quot;</span>
<span class="o">}</span>

<span class="c1"># Test with</span>
kustomize<span class="w"> </span>build<span class="w"> </span>overlays/production<span class="w"> </span><span class="p">|</span><span class="w"> </span>conftest<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-
</code></pre></div>
<h2 id="performance-optimizations"><strong>‚öôÔ∏è Performance Optimizations</strong></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># .kustomizerc (global config)</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KustomizationConfig</span>

<span class="nt">buildMetadata</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">originAnnotations</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">transformerAnnotations</span><span class="p p-Indicator">]</span>
<span class="nt">loadRestrictor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadRestrictionsNone</span>
<span class="nt">enableExec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">enableStar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># Use caching for remote resources</span>
<span class="nt">reorder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">legacy</span>

<span class="c1"># In production builds</span>
<span class="l l-Scalar l-Scalar-Plain">kustomize build \</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">--enable-alpha-plugins \</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">--load-restrictor=LoadRestrictionsNone \</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">--reorder=legacy \</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">--enable-exec \</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">overlays/production</span>
</code></pre></div>
<h2 id="custom-transformers-generators-go-plugins"><strong>üîß Custom Transformers &amp; Generators (Go Plugins)</strong></h2>
<div class="highlight"><pre><span></span><code><span class="c1">// main.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;sigs.k8s.io/kustomize/api/types&quot;</span>
<span class="w">    </span><span class="s">&quot;sigs.k8s.io/kustomize/kyaml/fn/framework&quot;</span>
<span class="w">    </span><span class="s">&quot;sigs.k8s.io/kustomize/kyaml/yaml&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AnnotationTransformer</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Annotations</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="w"> </span><span class="s">`yaml:&quot;annotations,omitempty&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">at</span><span class="w"> </span><span class="o">*</span><span class="nx">AnnotationTransformer</span><span class="p">)</span><span class="w"> </span><span class="nx">Filter</span><span class="p">(</span><span class="nx">objects</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">RNode</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="o">*</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">RNode</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">objects</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">meta</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">GetMeta</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">meta</span><span class="p">.</span><span class="nx">Annotations</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">meta</span><span class="p">.</span><span class="nx">Annotations</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">at</span><span class="p">.</span><span class="nx">Annotations</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">meta</span><span class="p">.</span><span class="nx">Annotations</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">v</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">SetAnnotations</span><span class="p">(</span><span class="nx">meta</span><span class="p">.</span><span class="nx">Annotations</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">objects</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resource</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">framework</span><span class="p">.</span><span class="nx">ResourceList</span><span class="p">{</span>
<span class="w">        </span><span class="nx">FunctionConfig</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">AnnotationTransformer</span><span class="p">{},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">framework</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">Filter</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">AnnotationTransformer</span><span class="p">{})</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Execute</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Use custom transformer</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>

<span class="nt">transformers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AnnotationTransformer</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">managed-by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize</span>
<span class="w">      </span><span class="nt">git-sha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$(git rev-parse HEAD)</span>
</code></pre></div>
<h2 id="comparison-with-modern-alternatives"><strong>üìä Comparison with Modern Alternatives</strong></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Kustomize</th>
<th>Helm</th>
<th>Carvel ytt</th>
<th>CUE</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Paradigm</strong></td>
<td>Overlay/Patch</td>
<td>Templating</td>
<td>Templating</td>
<td>Configuration Language</td>
</tr>
<tr>
<td><strong>Learning Curve</strong></td>
<td>Low</td>
<td>Medium</td>
<td>High</td>
<td>Very High</td>
</tr>
<tr>
<td><strong>GitOps Ready</strong></td>
<td>‚úÖ Excellent</td>
<td>‚ö†Ô∏è Needs Tillerless</td>
<td>‚úÖ Good</td>
<td>‚úÖ Good</td>
</tr>
<tr>
<td><strong>Multi-Environment</strong></td>
<td>‚úÖ Native</td>
<td>‚ö†Ô∏è Values files</td>
<td>‚úÖ Good</td>
<td>‚úÖ Excellent</td>
</tr>
<tr>
<td><strong>Type Safety</strong></td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ö†Ô∏è Limited</td>
<td>‚úÖ Excellent</td>
</tr>
<tr>
<td><strong>Secret Management</strong></td>
<td>‚ö†Ô∏è Basic</td>
<td>‚ö†Ô∏è Basic</td>
<td>‚úÖ Good</td>
<td>‚úÖ Good</td>
</tr>
<tr>
<td><strong>Community Adoption</strong></td>
<td>‚úÖ High</td>
<td>‚úÖ Very High</td>
<td>‚ö†Ô∏è Moderate</td>
<td>‚ö†Ô∏è Moderate</td>
</tr>
</tbody>
</table>
<h2 id="best-practices-summary"><strong>üéØ Best Practices Summary</strong></h2>
<ol>
<li><strong>Use components</strong> for cross-cutting concerns (v4+)</li>
<li><strong>Leverage replacements</strong> over vars (deprecated)</li>
<li><strong>Structure overlays</strong> by concern: environment √ó region √ó tenant</li>
<li><strong>Always validate</strong> with <code>kustomize build --load-restrictor=LoadRestrictionsNone</code></li>
<li><strong>Use generators</strong> for dynamic content</li>
<li><strong>Implement testing</strong> with kustomize test framework</li>
<li><strong>Cache remote resources</strong> in CI/CD</li>
<li><strong>Seal secrets</strong> before committing</li>
<li><strong>Use JSON patches</strong> for complex transformations</li>
<li><strong>Monitor kustomize releases</strong> - rapid evolution</li>
</ol>
<p>This master guide covers advanced modern patterns for enterprise-grade Kubernetes management with Kustomize. The key is embracing its <strong>declarative, patch-based philosophy</strong> while leveraging new features like <strong>components, replacements, and generators</strong> for maximum power and flexibility.</p>
<p>When you use:</p>
<p>yaml
secretGenerator:
  - name: app-secret
    behavior: merge
    envs:
      - prod-secret.txt
The behavior field controls how Kustomize handles the existing secret in your manifests, NOT the source file. Here's what happens:</p>
<ol>
<li>If the secret DOES NOT exist in base manifests:
With behavior: merge ‚Üí Will create the secret</li>
</ol>
<p>With behavior: create ‚Üí Will create the secret</p>
<p>With behavior: replace ‚Üí Will fail (no secret to replace)</p>
<ol>
<li>If the secret DOES exist in base manifests:
With behavior: merge ‚Üí Merge values from generator with base secret</li>
</ol>
<p>With behavior: create ‚Üí Error (can't create, already exists)</p>
<p>With behavior: replace ‚Üí Replace base secret completely</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../questions/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../questions/" class="btn btn-xs btn-link">
        Kustomize Practice Questions (Compressed)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../answers/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../answers/" class="btn btn-xs btn-link">
        Kustomize Practice Answers (Compressed 3 Questions)
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>