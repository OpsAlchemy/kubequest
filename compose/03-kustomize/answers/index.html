<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/03-kustomize/answers/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Kustomize Practice Answers (Compressed 3 Questions) - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Kustomize Practice Answers (Compressed 3 Questions)", url: "#_top", children: [
              {title: "Answer 1 \u2013 Multi-Environment Base + Overlays with Patches", url: "#answer-1-multi-environment-base-overlays-with-patches" },
              {title: "Answer 2 \u2013 ConfigMap/Secret Generators + Image Patching", url: "#answer-2-configmapsecret-generators-image-patching" },
              {title: "Answer 3 \u2013 Advanced: Multi-Base + JSON Patches", url: "#answer-3-advanced-multi-base-json-patches" },
              {title: "Key Concepts Covered:", url: "#key-concepts-covered" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../notes/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../notes/" class="btn btn-xs btn-link">
        Kustomize Master Guide: Advanced Patterns &amp; Modern Practices
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../02%20helm/questions/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../02%20helm/questions/" class="btn btn-xs btn-link">
        Helm Practice Questions
      </a>
    </div>
    
  </div>

    

    <h1 id="kustomize-practice-answers-compressed-3-questions">Kustomize Practice Answers (Compressed 3 Questions)</h1>
<hr />
<h2 id="answer-1-multi-environment-base-overlays-with-patches">Answer 1 – Multi-Environment Base + Overlays with Patches</h2>
<h3 id="base-setup">Base Setup</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create directory structure</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>kustomize-demo/base<span class="w"> </span>kustomize-demo/overlays/<span class="o">{</span>dev,prod<span class="o">}</span>/patches
<span class="nb">cd</span><span class="w"> </span>kustomize-demo/base

<span class="c1"># base/deployment.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>deployment.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: node-api</span>
<span class="s">spec:</span>
<span class="s">  replicas: 1</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: node-api</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        app: node-api</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: api</span>
<span class="s">        image: node:18-alpine</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 3000</span>
<span class="s">        envFrom:</span>
<span class="s">        - configMapRef:</span>
<span class="s">            name: app-config</span>
<span class="s">YAML</span>

<span class="c1"># base/service.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>service.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: node-api-svc</span>
<span class="s">spec:</span>
<span class="s">  type: ClusterIP</span>
<span class="s">  ports:</span>
<span class="s">  - port: 80</span>
<span class="s">    targetPort: 3000</span>
<span class="s">  selector:</span>
<span class="s">    app: node-api</span>
<span class="s">YAML</span>

<span class="c1"># base/configmap.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>configmap.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ConfigMap</span>
<span class="s">metadata:</span>
<span class="s">  name: app-config</span>
<span class="s">data:</span>
<span class="s">  APP_NAME: myapp</span>
<span class="s">  LOG_LEVEL: info</span>
<span class="s">  REDIS_HOST: redis-service</span>
<span class="s">YAML</span>

<span class="c1"># base/redis-deployment.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>redis-deployment.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: redis</span>
<span class="s">spec:</span>
<span class="s">  replicas: 1</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: redis</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        app: redis</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: redis</span>
<span class="s">        image: redis:7-alpine</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 6379</span>
<span class="s">YAML</span>

<span class="c1"># base/redis-service.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>redis-service.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: redis-service</span>
<span class="s">spec:</span>
<span class="s">  type: ClusterIP</span>
<span class="s">  ports:</span>
<span class="s">  - port: 6379</span>
<span class="s">    targetPort: 6379</span>
<span class="s">  selector:</span>
<span class="s">    app: redis</span>
<span class="s">YAML</span>

<span class="c1"># base/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- deployment.yaml</span>
<span class="s">- service.yaml</span>
<span class="s">- configmap.yaml</span>
<span class="s">- redis-deployment.yaml</span>
<span class="s">- redis-service.yaml</span>
<span class="s">YAML</span>

<span class="c1"># Verify base</span>
kustomize<span class="w"> </span>build<span class="w"> </span>.
</code></pre></div>
<h3 id="dev-overlay">Dev Overlay</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../overlays/dev

<span class="c1"># overlays/dev/patches/deployment-patch.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>patches/deployment-patch.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: node-api</span>
<span class="s">spec:</span>
<span class="s">  replicas: 2</span>
<span class="s">YAML</span>

<span class="c1"># overlays/dev/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- ../../base</span>

<span class="s">namespace: dev</span>
<span class="s">namePrefix: dev-</span>

<span class="s">labels:</span>
<span class="s">- includeSelectors: true</span>
<span class="s">  pairs:</span>
<span class="s">    env: dev</span>

<span class="s">patches:</span>
<span class="s">- path: patches/deployment-patch.yaml</span>
<span class="s">  target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: node-api</span>
<span class="s">YAML</span>

<span class="c1"># Test</span>
kustomize<span class="w"> </span>build<span class="w"> </span>.
</code></pre></div>
<h3 id="prod-overlay">Prod Overlay</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../prod

<span class="c1"># overlays/prod/patches/deployment-patch.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>patches/deployment-patch.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: node-api</span>
<span class="s">spec:</span>
<span class="s">  replicas: 4</span>
<span class="s">YAML</span>

<span class="c1"># overlays/prod/patches/resources-patch.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>patches/resources-patch.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: node-api</span>
<span class="s">spec:</span>
<span class="s">  template:</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: api</span>
<span class="s">        resources:</span>
<span class="s">          requests:</span>
<span class="s">            cpu: 100m</span>
<span class="s">            memory: 128Mi</span>
<span class="s">          limits:</span>
<span class="s">            cpu: 500m</span>
<span class="s">            memory: 512Mi</span>
<span class="s">YAML</span>

<span class="c1"># overlays/prod/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- ../../base</span>

<span class="s">namespace: prod</span>
<span class="s">namePrefix: prod-</span>

<span class="s">labels:</span>
<span class="s">- includeSelectors: true</span>
<span class="s">  pairs:</span>
<span class="s">    env: prod</span>

<span class="s">patches:</span>
<span class="s">- path: patches/deployment-patch.yaml</span>
<span class="s">  target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: node-api</span>
<span class="s">- path: patches/resources-patch.yaml</span>
<span class="s">  target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: node-api</span>
<span class="s">YAML</span>

<span class="c1"># Test</span>
kustomize<span class="w"> </span>build<span class="w"> </span>.
</code></pre></div>
<hr />
<h2 id="answer-2-configmapsecret-generators-image-patching">Answer 2 – ConfigMap/Secret Generators + Image Patching</h2>
<p><strong>Build on your Q1 solution directory.</strong></p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>overlays/dev

<span class="c1"># Create .env files</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>.env.config<span class="w"> </span><span class="s">&lt;&lt; &#39;ENV&#39;</span>
<span class="s">APP_NAME=myapp-dev</span>
<span class="s">LOG_LEVEL=debug</span>
<span class="s">REDIS_HOST=redis-service</span>
<span class="s">ENV</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>.env.secrets<span class="w"> </span><span class="s">&lt;&lt; &#39;ENV&#39;</span>
<span class="s">DB_PASSWORD=devpass123</span>
<span class="s">DB_USER=dev</span>
<span class="s">ENV</span>

<span class="c1"># Update overlays/dev/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- ../../base</span>

<span class="s">namespace: dev</span>
<span class="s">namePrefix: dev-</span>

<span class="s">labels:</span>
<span class="s">- includeSelectors: true</span>
<span class="s">  pairs:</span>
<span class="s">    env: dev</span>

<span class="s">patches:</span>
<span class="s">- path: patches/deployment-patch.yaml</span>
<span class="s">  target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: node-api</span>

<span class="s">configMapGenerator:</span>
<span class="s">- name: app-config</span>
<span class="s">  files:</span>
<span class="s">  - .env.config</span>
<span class="s">  behavior: merge</span>

<span class="s">secretGenerator:</span>
<span class="s">- name: db-credentials</span>
<span class="s">  files:</span>
<span class="s">  - .env.secrets</span>

<span class="s">images:</span>
<span class="s">- name: node</span>
<span class="s">  newTag: 18-alpine</span>
<span class="s">YAML</span>

<span class="c1"># Test</span>
kustomize<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;^apiVersion: v1&quot;</span>
kustomize<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;image:&quot;</span>
</code></pre></div>
<h3 id="prod-overlay_1">Prod Overlay</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>../prod

<span class="c1"># Create .env files</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>.env.config<span class="w"> </span><span class="s">&lt;&lt; &#39;ENV&#39;</span>
<span class="s">APP_NAME=myapp-prod</span>
<span class="s">LOG_LEVEL=info</span>
<span class="s">REDIS_HOST=redis-service</span>
<span class="s">ENV</span>

cat<span class="w"> </span>&gt;<span class="w"> </span>.env.secrets<span class="w"> </span><span class="s">&lt;&lt; &#39;ENV&#39;</span>
<span class="s">DB_PASSWORD=prod-secure-xyz-2024</span>
<span class="s">DB_USER=prod</span>
<span class="s">ENV</span>

<span class="c1"># Update overlays/prod/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- ../../base</span>

<span class="s">namespace: prod</span>
<span class="s">namePrefix: prod-</span>

<span class="s">labels:</span>
<span class="s">- includeSelectors: true</span>
<span class="s">  pairs:</span>
<span class="s">    env: prod</span>

<span class="s">patches:</span>
<span class="s">- path: patches/deployment-patch.yaml</span>
<span class="s">  target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: node-api</span>
<span class="s">- path: patches/resources-patch.yaml</span>
<span class="s">  target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: node-api</span>

<span class="s">configMapGenerator:</span>
<span class="s">- name: app-config</span>
<span class="s">  files:</span>
<span class="s">  - .env.config</span>
<span class="s">  behavior: merge</span>

<span class="s">secretGenerator:</span>
<span class="s">- name: db-credentials</span>
<span class="s">  files:</span>
<span class="s">  - .env.secrets</span>

<span class="s">images:</span>
<span class="s">- name: node</span>
<span class="s">  newTag: 18.20.0-alpine</span>
<span class="s">YAML</span>

<span class="c1"># Test</span>
kustomize<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ConfigMap
kustomize<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>image:
</code></pre></div>
<hr />
<h2 id="answer-3-advanced-multi-base-json-patches">Answer 3 – Advanced: Multi-Base + JSON Patches</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Create fresh project</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>advanced-kustomize/bases/<span class="o">{</span>core,monitoring,security<span class="o">}</span>/
mkdir<span class="w"> </span>-p<span class="w"> </span>advanced-kustomize/overlays/<span class="o">{</span>staging,prod<span class="o">}</span>
<span class="nb">cd</span><span class="w"> </span>advanced-kustomize

<span class="c1"># bases/core/deployment.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/core/deployment.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: webapp</span>
<span class="s">spec:</span>
<span class="s">  replicas: 2</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: webapp</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        app: webapp</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: app</span>
<span class="s">        image: nginx:latest</span>
<span class="s">        ports:</span>
<span class="s">        - containerPort: 80</span>
<span class="s">YAML</span>

<span class="c1"># bases/core/service.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/core/service.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: webapp-svc</span>
<span class="s">spec:</span>
<span class="s">  type: ClusterIP</span>
<span class="s">  ports:</span>
<span class="s">  - port: 80</span>
<span class="s">    targetPort: 80</span>
<span class="s">  selector:</span>
<span class="s">    app: webapp</span>
<span class="s">YAML</span>

<span class="c1"># bases/core/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/core/kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- deployment.yaml</span>
<span class="s">- service.yaml</span>
<span class="s">YAML</span>

<span class="c1"># bases/monitoring/servicemonitor.yaml (Prometheus)</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/monitoring/servicemonitor.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: monitoring.coreos.com/v1</span>
<span class="s">kind: ServiceMonitor</span>
<span class="s">metadata:</span>
<span class="s">  name: webapp-monitor</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: webapp</span>
<span class="s">  endpoints:</span>
<span class="s">  - port: metrics</span>
<span class="s">YAML</span>

<span class="c1"># bases/monitoring/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/monitoring/kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- servicemonitor.yaml</span>
<span class="s">YAML</span>

<span class="c1"># bases/security/networkpolicy.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/security/networkpolicy.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: networking.k8s.io/v1</span>
<span class="s">kind: NetworkPolicy</span>
<span class="s">metadata:</span>
<span class="s">  name: webapp-netpol</span>
<span class="s">spec:</span>
<span class="s">  podSelector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: webapp</span>
<span class="s">  policyTypes:</span>
<span class="s">  - Ingress</span>
<span class="s">  - Egress</span>
<span class="s">  ingress:</span>
<span class="s">  - from:</span>
<span class="s">    - namespaceSelector:</span>
<span class="s">        matchLabels:</span>
<span class="s">          name: ingress-nginx</span>
<span class="s">  egress:</span>
<span class="s">  - to:</span>
<span class="s">    - namespaceSelector: {}</span>
<span class="s">YAML</span>

<span class="c1"># bases/security/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>bases/security/kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- networkpolicy.yaml</span>
<span class="s">YAML</span>

<span class="c1"># overlays/staging/patches.json</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>overlays/staging/patches.json<span class="w"> </span><span class="s">&lt;&lt; &#39;JSON&#39;</span>
<span class="s">[</span>
<span class="s">  {</span>
<span class="s">    &quot;op&quot;: &quot;add&quot;,</span>
<span class="s">    &quot;path&quot;: &quot;/metadata/annotations&quot;,</span>
<span class="s">    &quot;value&quot;: {</span>
<span class="s">      &quot;monitoring&quot;: &quot;true&quot;,</span>
<span class="s">      &quot;environment&quot;: &quot;staging&quot;</span>
<span class="s">    }</span>
<span class="s">  },</span>
<span class="s">  {</span>
<span class="s">    &quot;op&quot;: &quot;add&quot;,</span>
<span class="s">    &quot;path&quot;: &quot;/spec/template/metadata/annotations&quot;,</span>
<span class="s">    &quot;value&quot;: {</span>
<span class="s">      &quot;monitoring&quot;: &quot;enabled&quot;</span>
<span class="s">    }</span>
<span class="s">  },</span>
<span class="s">  {</span>
<span class="s">    &quot;op&quot;: &quot;add&quot;,</span>
<span class="s">    &quot;path&quot;: &quot;/spec/type&quot;,</span>
<span class="s">    &quot;value&quot;: &quot;LoadBalancer&quot;</span>
<span class="s">  }</span>
<span class="s">]</span>
<span class="s">JSON</span>

<span class="c1"># overlays/staging/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>overlays/staging/kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- ../../bases/core</span>
<span class="s">- ../../bases/monitoring</span>

<span class="s">namespace: staging</span>
<span class="s">namePrefix: staging-</span>

<span class="s">labels:</span>
<span class="s">- includeSelectors: true</span>
<span class="s">  pairs:</span>
<span class="s">    env: staging</span>

<span class="s">patchesJson6902:</span>
<span class="s">- target:</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: staging-webapp</span>
<span class="s">  patch: |-</span>
<span class="s">    [</span>
<span class="s">      {</span>
<span class="s">        &quot;op&quot;: &quot;add&quot;,</span>
<span class="s">        &quot;path&quot;: &quot;/metadata/annotations&quot;,</span>
<span class="s">        &quot;value&quot;: {</span>
<span class="s">          &quot;monitoring&quot;: &quot;true&quot;</span>
<span class="s">        }</span>
<span class="s">      }</span>
<span class="s">    ]</span>
<span class="s">YAML</span>

<span class="c1"># overlays/prod/kustomization.yaml</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>overlays/prod/kustomization.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;YAML&#39;</span>
<span class="s">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="s">kind: Kustomization</span>

<span class="s">resources:</span>
<span class="s">- ../../bases/core</span>
<span class="s">- ../../bases/monitoring</span>
<span class="s">- ../../bases/security</span>

<span class="s">namespace: prod</span>
<span class="s">namePrefix: prod-</span>

<span class="s">labels:</span>
<span class="s">- includeSelectors: true</span>
<span class="s">  pairs:</span>
<span class="s">    env: prod</span>
<span class="s">YAML</span>

<span class="c1"># Test</span>
kustomize<span class="w"> </span>build<span class="w"> </span>overlays/staging/
kustomize<span class="w"> </span>build<span class="w"> </span>overlays/prod/<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>NetworkPolicy
</code></pre></div>
<hr />
<h2 id="key-concepts-covered">Key Concepts Covered:</h2>
<ol>
<li><strong>Q1</strong>: Base → overlays, namespace isolation, namePrefix, patches, labels</li>
<li><strong>Q2</strong>: ConfigMap/Secret generators, image tag management, hash suffixes</li>
<li><strong>Q3</strong>: Multi-base composition, JSON patches (RFC 6902), cross-cutting concerns</li>
</ol>
<p>All three questions are <strong>production-ready patterns</strong> commonly used in real Kubernetes projects.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../notes/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../notes/" class="btn btn-xs btn-link">
        Kustomize Master Guide: Advanced Patterns &amp; Modern Practices
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../02%20helm/questions/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../02%20helm/questions/" class="btn btn-xs btn-link">
        Helm Practice Questions
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>