<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/05-kubeconfig/notes/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Kubeconfig &amp; Kubernetes PKI Fundamentals - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Kubeconfig \u0026amp; Kubernetes PKI Fundamentals", url: "#_top", children: [
              {title: "Quick Reference: kubectl config Commands", url: "#quick-reference-kubectl-config-commands" },
              {title: "Advanced: kubectl config Usage Patterns", url: "#advanced-kubectl-config-usage-patterns" },
              {title: "Part 1: Kubernetes PKI Basics", url: "#part-1-kubernetes-pki-basics" },
              {title: "Part 2: Understanding X.509 Certificates", url: "#part-2-understanding-x509-certificates" },
              {title: "Part 3: Inspecting Certificates with OpenSSL", url: "#part-3-inspecting-certificates-with-openssl" },
              {title: "Part 4: Kubeconfig File Format", url: "#part-4-kubeconfig-file-format" },
              {title: "Part 5: Creating Custom Users with Certificates", url: "#part-5-creating-custom-users-with-certificates" },
              {title: "Part 7: Kubernetes API CertificateSigningRequest (CSR)", url: "#part-7-kubernetes-api-certificatesigningrequest-csr" },
              {title: "Part 8: Working with Kubeconfig - Examples", url: "#part-8-working-with-kubeconfig-examples" },
          ]},
          {title: "Show the structure", url: "#show-the-structure", children: [
          ]},
          {title: "Using grep/sed only", url: "#using-grepsed-only", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../question/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../question/" class="btn btn-xs btn-link">
        Kubeconfig &amp; Kubernetes PKI - Practical Challenges
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../04-admission-webhook/notes/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../04-admission-webhook/notes/" class="btn btn-xs btn-link">
        Notes
      </a>
    </div>
    
  </div>

    

    <h1 id="kubeconfig-kubernetes-pki-fundamentals">Kubeconfig &amp; Kubernetes PKI Fundamentals</h1>
<p>Comprehensive guide to understanding Kubernetes PKI (Public Key Infrastructure), X.509 certificates, and kubeconfig file structure. Learn how to work with certificates, create custom users, and manage cluster authentication.</p>
<h2 id="quick-reference-kubectl-config-commands">Quick Reference: kubectl config Commands</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># View configuration</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w">                    </span><span class="c1"># Show entire kubeconfig</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--raw<span class="w">              </span><span class="c1"># Show with decoded credentials</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--flatten<span class="w">          </span><span class="c1"># Merge all kubeconfigs</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--minify<span class="w">           </span><span class="c1"># Show only current context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>-o<span class="w"> </span>json<span class="w">            </span><span class="c1"># Output as JSON</span>

<span class="c1"># Set cluster</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-cluster<span class="w"> </span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server<span class="o">=</span>https://172.30.1.2:6443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--certificate-authority<span class="o">=</span>/etc/kubernetes/pki/ca.crt

<span class="c1"># Set user credentials (certificate-based)</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>kubelet<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span>/etc/kubernetes/pki/kubelet.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key<span class="o">=</span>/etc/kubernetes/pki/kubelet.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-certs<span class="o">=</span><span class="nb">true</span>

<span class="c1"># Set user credentials (token-based)</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>token-user<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--token<span class="o">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

<span class="c1"># Create context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>kubelet<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="o">=</span>default

<span class="c1"># Use context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>default

<span class="c1"># Get current context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>current-context

<span class="c1"># Get all clusters, users, contexts</span>
kubectl<span class="w"> </span>config<span class="w"> </span>get-clusters
kubectl<span class="w"> </span>config<span class="w"> </span>get-users
kubectl<span class="w"> </span>config<span class="w"> </span>get-contexts

<span class="c1"># Rename context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>rename-context<span class="w"> </span>old-name<span class="w"> </span>new-name

<span class="c1"># Delete entries</span>
kubectl<span class="w"> </span>config<span class="w"> </span>delete-cluster<span class="w"> </span>cluster-name
kubectl<span class="w"> </span>config<span class="w"> </span>delete-user<span class="w"> </span>user-name
kubectl<span class="w"> </span>config<span class="w"> </span>delete-context<span class="w"> </span>context-name

<span class="c1"># Unset (remove) configuration</span>
kubectl<span class="w"> </span>config<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>current-context
kubectl<span class="w"> </span>config<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>clusters.cluster-name
kubectl<span class="w"> </span>config<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>users.user-name
kubectl<span class="w"> </span>config<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>contexts.context-name.namespace
</code></pre></div>
<hr />
<h2 id="advanced-kubectl-config-usage-patterns">Advanced: kubectl config Usage Patterns</h2>
<h3 id="pattern-1-setup-complete-cluster-access-one-command-sequence">Pattern 1: Setup Complete Cluster Access (One Command Sequence)</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Add cluster configuration</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-cluster<span class="w"> </span>prod-cluster<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server<span class="o">=</span>https://api.prod.example.com:6443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--certificate-authority<span class="o">=</span>/path/to/ca.crt

<span class="c1"># 2. Add user with certificate</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>prod-admin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span>/path/to/admin.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key<span class="o">=</span>/path/to/admin.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-certs<span class="o">=</span><span class="nb">true</span>

<span class="c1"># 3. Create context binding</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>prod-admin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>prod-cluster<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>prod-admin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="o">=</span>default

<span class="c1"># 4. Switch to use it</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>prod-admin

<span class="c1"># Verify</span>
kubectl<span class="w"> </span>cluster-info
kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
<h3 id="pattern-2-add-token-based-user">Pattern 2: Add Token-Based User</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># For service account tokens</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>service-user<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--token<span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>create<span class="w"> </span>token<span class="w"> </span>my-service-account<span class="k">)</span>

<span class="c1"># For predefined token</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>token-user<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--token<span class="o">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0...

<span class="c1"># Use in context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>token-context<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>token-user
</code></pre></div>
<h3 id="pattern-3-multiple-kubeconfigs">Pattern 3: Multiple Kubeconfigs</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Combine multiple kubeconfig files</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>~/.kube/config:~/.kube/prod-config:~/.kube/dev-config

<span class="c1"># View all merged</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view

<span class="c1"># Switch between clusters easily</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>prod-admin
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>dev-admin

<span class="c1"># Make permanent</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export KUBECONFIG=~/.kube/config:~/.kube/prod-config:~/.kube/dev-config&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc
</code></pre></div>
<h3 id="pattern-4-extract-user-credentials">Pattern 4: Extract User Credentials</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Extract certificate from kubeconfig</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>grep<span class="w"> </span><span class="s1">&#39;client-certificate-data:&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>user.crt

<span class="c1"># Extract key from kubeconfig</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>grep<span class="w"> </span><span class="s1">&#39;client-key-data:&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>user.key

<span class="c1"># Extract CA certificate</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>grep<span class="w"> </span><span class="s1">&#39;certificate-authority-data:&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>ca.crt
</code></pre></div>
<h3 id="pattern-5-context-specific-namespace">Pattern 5: Context-Specific Namespace</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create different contexts pointing to same cluster but different namespaces</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>dev-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>devuser<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="o">=</span>development

kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>prod-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>devuser<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="o">=</span>production

<span class="c1"># Switch context to change namespace automatically</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>dev-namespace<span class="w">   </span><span class="c1"># Now using development namespace</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w">                            </span><span class="c1"># Shows pods from development</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>prod-namespace<span class="w">  </span><span class="c1"># Now using production namespace</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w">                            </span><span class="c1"># Shows pods from production</span>
</code></pre></div>
<h3 id="pattern-6-temporary-context-override">Pattern 6: Temporary Context Override</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Switch context just for one command</span>
kubectl<span class="w"> </span>--context<span class="o">=</span>staging-admin<span class="w"> </span>get<span class="w"> </span>nodes

<span class="c1"># Override namespace for one command</span>
kubectl<span class="w"> </span>--namespace<span class="o">=</span>kube-system<span class="w"> </span>get<span class="w"> </span>pods

<span class="c1"># Override entire cluster connection</span>
kubectl<span class="w"> </span>--server<span class="o">=</span>https://different-api:6443<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
<h3 id="pattern-7-audit-kubeconfig">Pattern 7: Audit Kubeconfig</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Show current context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>current-context

<span class="c1"># Show all contexts with current marker</span>
kubectl<span class="w"> </span>config<span class="w"> </span>get-contexts

<span class="c1"># Show which cluster/user/namespace current context uses</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A3<span class="w"> </span><span class="s2">&quot;current-context&quot;</span>

<span class="c1"># Check if specific context exists</span>
kubectl<span class="w"> </span>config<span class="w"> </span>get-contexts<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^[*]&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span>

<span class="c1"># Get API server for current context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A2<span class="w"> </span><span class="s2">&quot;current-context&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>cluster<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span>
</code></pre></div>
<h3 id="pattern-8-cluster-switching-script">Pattern 8: Cluster Switching Script</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Interactive cluster switcher</span>

<span class="c1"># Get all contexts</span>
<span class="nv">CONTEXTS</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>config<span class="w"> </span>get-contexts<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;NR &gt; 1 {print $2}&#39;</span><span class="k">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Available contexts:&quot;</span>
<span class="k">select</span><span class="w"> </span>CONTEXT<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$CONTEXTS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONTEXT</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Switched to: </span><span class="nv">$CONTEXT</span><span class="s2">&quot;</span>
<span class="w">  </span>kubectl<span class="w"> </span>config<span class="w"> </span>current-context
<span class="w">  </span>kubectl<span class="w"> </span>cluster-info<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1
<span class="w">  </span><span class="k">break</span>
<span class="k">done</span>
</code></pre></div>
<hr />
<h2 id="part-1-kubernetes-pki-basics">Part 1: Kubernetes PKI Basics</h2>
<h3 id="what-is-pki">What is PKI?</h3>
<p><strong>PKI (Public Key Infrastructure)</strong> is a system for creating, managing, and validating digital certificates used for authentication and encryption in Kubernetes. Every component that needs to authenticate uses certificates signed by the cluster's Certificate Authority (CA).</p>
<h3 id="pki-directory-structure">PKI Directory Structure</h3>
<p>All Kubernetes certificates are stored in <code>/etc/kubernetes/pki/</code>:</p>
<div class="highlight"><pre><span></span><code>/etc/kubernetes/pki/
├── ca.crt                  # Cluster CA certificate (what signed everything)
├── ca.key                  # Cluster CA private key (secret! signs new certs)
├── apiserver.crt           # API Server certificate
├── apiserver.key           # API Server private key
├── kubelet*.crt            # Kubelet certificates
├── controller-manager.crt  # Controller manager certificate
├── scheduler.crt           # Scheduler certificate
├── front-proxy-ca.*        # Front proxy CA for API aggregation
├── etcd/                   # ETCD certificates (database)
│   ├── ca.crt
│   ├── server.crt
│   └── server.key
└── sa.key                  # Service account signing key (not X.509)
</code></pre></div>
<h3 id="why-multiple-cas">Why Multiple CAs?</h3>
<p>Kubernetes uses different CAs for security isolation:</p>
<ol>
<li><strong>Cluster CA</strong> (<code>ca.crt/ca.key</code>): Main CA, signs kubelet, controller-manager, scheduler certificates</li>
<li><strong>API Server CA</strong>: Dedicated CA for API server communication</li>
<li><strong>Front Proxy CA</strong>: For aggregated API servers</li>
<li><strong>ETCD CA</strong>: Isolated CA for ETCD database communication</li>
</ol>
<hr />
<h2 id="part-2-understanding-x509-certificates">Part 2: Understanding X.509 Certificates</h2>
<h3 id="certificate-structure">Certificate Structure</h3>
<p>Every X.509 certificate contains identity information:</p>
<div class="highlight"><pre><span></span><code>Certificate Structure
├── Version: v3 (X.509v3)
├── Serial Number: Unique ID (2897472356293683110)
├── Signature Algorithm: sha256WithRSAEncryption
├── Issuer: CN=kubernetes (who signed this cert)
├── Validity Period
│   ├── Not Before: Jan 1 2026 GMT
│   └── Not After: Dec 30 2035 GMT (10 year validity)
├── Subject: CN=kubernetes-admin (who this cert is for)
├── Public Key Info
│   ├── Algorithm: RSA
│   └── Size: 2048 bits
└── Extensions (critical for Kubernetes)
    ├── Subject Alternative Names (SAN): DNS names, IP addresses
    ├── Key Usage: digitalSignature, keyEncipherment
    └── Extended Key Usage: serverAuth, clientAuth
</code></pre></div>
<h3 id="certificate-components">Certificate Components</h3>
<h4 id="1-cn-common-name-the-identity">1. <strong>CN (Common Name)</strong> - The Identity</h4>
<p>CN identifies WHO the certificate is for:</p>
<div class="highlight"><pre><span></span><code>CN=kubernetes-admin      # User name &quot;kubernetes-admin&quot;
CN=kubelet              # System component &quot;kubelet&quot;
CN=controller-manager   # System component &quot;controller-manager&quot;
CN=kubernetes           # API server default identity
</code></pre></div>
<h4 id="2-o-organization-user-groups-for-rbac">2. <strong>O (Organization)</strong> - User Groups for RBAC</h4>
<p>Organization field maps to groups, used for Role-Based Access Control:</p>
<div class="highlight"><pre><span></span><code>O=system:masters              # Built-in admin group
O=kubeadm:cluster-admins      # Created by kubeadm (admins)
O=system:nodes                # For kubelet certificates
O=developers                  # Custom developer group
O=system:authenticated        # Standard authenticated users group
</code></pre></div>
<p><strong>Example Certificate Subject:</strong>
<div class="highlight"><pre><span></span><code>Subject: O=kubeadm:cluster-admins, CN=kubernetes-admin
         ↓                      ↓
      Groups              User Name
</code></pre></div></p>
<h4 id="3-san-subject-alternative-names-where-the-certificate-is-valid">3. <strong>SAN (Subject Alternative Names)</strong> - Where the Certificate is Valid</h4>
<p>SAN lists all valid hostnames and IPs for the certificate:</p>
<div class="highlight"><pre><span></span><code>DNS Names:
- kubernetes
- kubernetes.default
- kubernetes.default.svc
- kubernetes.default.svc.cluster.local
- localhost

IP Addresses:
- 127.0.0.1 (localhost)
- 10.96.0.1 (Kubernetes service IP)
- 10.0.0.100 (Control plane node IP)
- 10.0.0.101 (Other control plane nodes)
</code></pre></div>
<p><strong>Why important?</strong> If a DNS name or IP is NOT in SAN, the certificate is invalid for that endpoint!</p>
<hr />
<h2 id="part-3-inspecting-certificates-with-openssl">Part 3: Inspecting Certificates with OpenSSL</h2>
<h3 id="basic-certificate-inspection">Basic Certificate Inspection</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># View certificate details</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>/etc/kubernetes/pki/ca.crt<span class="w"> </span>-text<span class="w"> </span>-noout

<span class="c1"># View first 30 lines</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>/etc/kubernetes/pki/ca.crt<span class="w"> </span>-text<span class="w"> </span>-noout<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-30

<span class="c1"># Extract specific fields</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>cert.crt<span class="w"> </span>-noout<span class="w"> </span>-subject<span class="w">      </span><span class="c1"># Get CN and O</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>cert.crt<span class="w"> </span>-noout<span class="w"> </span>-issuer<span class="w">       </span><span class="c1"># Who signed it</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>cert.crt<span class="w"> </span>-noout<span class="w"> </span>-dates<span class="w">        </span><span class="c1"># Validity period</span>
</code></pre></div>
<h3 id="extract-certificate-from-kubeconfig">Extract Certificate from Kubeconfig</h3>
<p>Kubeconfig stores certificates as base64-encoded data. To decode:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Extract CA certificate from kubeconfig</span>
kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>grep<span class="w"> </span><span class="s1">&#39;certificate-authority-data:&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>ca.crt

<span class="c1"># Inspect</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>ca.crt<span class="w"> </span>-text<span class="w"> </span>-noout<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
</code></pre></div>
<h3 id="check-certificate-validity">Check Certificate Validity</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># View Not Before and Not After dates</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>cert.crt<span class="w"> </span>-noout<span class="w"> </span>-dates
<span class="c1"># Output:</span>
<span class="c1"># notBefore=Jan  1 07:08:58 2026 GMT</span>
<span class="c1"># notAfter=Dec 30 07:13:58 2035 GMT</span>

<span class="c1"># Check days until expiration</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>cert.crt<span class="w"> </span>-noout<span class="w"> </span>-enddate<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">&#39;=&#39;</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>date<span class="w"> </span>-d<span class="w"> </span><span class="o">{}</span><span class="w"> </span>+%s<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>xargs<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>expr<span class="w"> </span><span class="se">\(</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span>-<span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="w"> </span><span class="se">\)</span><span class="w"> </span>/<span class="w"> </span><span class="m">86400</span>
</code></pre></div>
<h3 id="view-san-extensions">View SAN Extensions</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># See all Subject Alternative Names</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>cert.crt<span class="w"> </span>-text<span class="w"> </span>-noout<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A5<span class="w"> </span><span class="s2">&quot;Subject Alternative Name&quot;</span>

<span class="c1"># Example output:</span>
<span class="c1">#     X509v3 Subject Alternative Name: </span>
<span class="c1">#         DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, </span>
<span class="c1">#         IP Address:10.96.0.1, IP Address:10.0.0.1</span>
</code></pre></div>
<hr />
<h2 id="part-4-kubeconfig-file-format">Part 4: Kubeconfig File Format</h2>
<h3 id="complete-kubeconfig-structure">Complete Kubeconfig Structure</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Config</span>
<span class="nt">preferences</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="c1"># SECTION 1: Clusters - How to connect to clusters</span>
<span class="nt">clusters</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cluster</span><span class="p">:</span>
<span class="w">    </span><span class="nt">certificate-authority-data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LS0tLS1CRUdJTi...</span><span class="w"> </span><span class="c1"># Base64 CA cert</span>
<span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://172.30.1.2:6443</span><span class="w">               </span><span class="c1"># API server URL</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes</span><span class="w">                                 </span><span class="c1"># Cluster name (identifier)</span>

<span class="c1"># SECTION 2: Users - Authentication credentials</span>
<span class="nt">users</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-admin</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Method A: Certificate-based auth (most common)</span>
<span class="w">    </span><span class="nt">client-certificate-data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LS0tLS1CRUdJTi...</span><span class="w">    </span><span class="c1"># Base64 client cert</span>
<span class="w">    </span><span class="nt">client-key-data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LS0tLS1CRUdJTi...</span><span class="w">            </span><span class="c1"># Base64 client key</span>

<span class="c1"># SECTION 3: Contexts - Bind (cluster + user + namespace)</span>
<span class="nt">contexts</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">context</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes</span><span class="w">           </span><span class="c1"># Which cluster (from clusters[])</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-admin</span><span class="w">        </span><span class="c1"># Which user (from users[])</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w">            </span><span class="c1"># Default namespace for this context</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-admin@kubernetes</span><span class="w">  </span><span class="c1"># Context name (identifier)</span>

<span class="c1"># SECTION 4: Current context - Default when you run kubectl</span>
<span class="nt">current-context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-admin@kubernetes</span>
</code></pre></div>
<h3 id="section-details">Section Details</h3>
<h4 id="clusters-section"><strong>Clusters Section</strong></h4>
<p>Defines how to reach a Kubernetes cluster:</p>
<div class="highlight"><pre><span></span><code><span class="nt">clusters</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cluster</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># CA cert to verify API server certificate</span>
<span class="w">    </span><span class="nt">certificate-authority-data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">base64 encoded</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="c1"># OR use file path:</span>
<span class="w">    </span><span class="c1"># certificate-authority: /etc/kubernetes/pki/ca.crt</span>

<span class="w">    </span><span class="c1"># API server URL</span>
<span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com:6443</span>

<span class="w">    </span><span class="c1"># DANGEROUS: Skip cert verification (never in production)</span>
<span class="w">    </span><span class="c1"># insecure-skip-tls-verify: true</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster</span>
</code></pre></div>
<h4 id="users-section"><strong>Users Section</strong></h4>
<p>Defines HOW to authenticate:</p>
<div class="highlight"><pre><span></span><code><span class="nt">users</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Method 1: Certificate + Key (TLS client auth)</span>
<span class="w">    </span><span class="nt">client-certificate-data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">base64</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">client-key-data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">base64</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="c1"># Method 2: Token (for service accounts)</span>
<span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span>

<span class="w">    </span><span class="c1"># Method 3: Username/Password (deprecated, rarely used)</span>
<span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pass123</span>
</code></pre></div>
<h4 id="contexts-section"><strong>Contexts Section</strong></h4>
<p>Binds together cluster + user + namespace:</p>
<div class="highlight"><pre><span></span><code><span class="nt">contexts</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">context</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production-cluster</span><span class="w">   </span><span class="c1"># Reference from clusters[]</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="w">                   </span><span class="c1"># Reference from users[]</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span><span class="w">        </span><span class="c1"># Default namespace for commands</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-admin</span><span class="w">               </span><span class="c1"># Context identifier</span>
</code></pre></div>
<hr />
<h2 id="part-5-creating-custom-users-with-certificates">Part 5: Creating Custom Users with Certificates</h2>
<h3 id="step-1-generate-private-key">Step 1: Generate Private Key</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a 2048-bit RSA private key for the user</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>devuser.key<span class="w"> </span><span class="m">2048</span>

<span class="c1"># Result: A private key file that should be kept secret</span>
</code></pre></div>
<h3 id="step-2-create-certificate-signing-request-csr">Step 2: Create Certificate Signing Request (CSR)</h3>
<p>A CSR is a request to the CA to sign a certificate:</p>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-key<span class="w"> </span>devuser.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span>devuser.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=devuser/O=developers/O=kubeadm:cluster-admins&quot;</span>

<span class="c1"># /CN=devuser              → Username (Common Name)</span>
<span class="c1"># /O=developers            → Group 1</span>
<span class="c1"># /O=kubeadm:cluster-admins → Group 2 (RBAC admin group)</span>
</code></pre></div>
<h3 id="step-3-sign-csr-with-cluster-ca">Step 3: Sign CSR with Cluster CA</h3>
<p>The cluster admin signs the CSR, creating a valid certificate:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Sign CSR with cluster CA (valid for 365 days)</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span>devuser.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CA<span class="w"> </span>/etc/kubernetes/pki/ca.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAkey<span class="w"> </span>/etc/kubernetes/pki/ca.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAcreateserial<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span>devuser.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-days<span class="w"> </span><span class="m">365</span>

<span class="c1"># After this, devuser.crt is a valid Kubernetes certificate</span>
</code></pre></div>
<h3 id="step-4-add-to-kubeconfig">Step 4: Add to Kubeconfig</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Add cluster (if not already there)</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-cluster<span class="w"> </span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server<span class="o">=</span>https://api.example.com:6443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--certificate-authority<span class="o">=</span>/etc/kubernetes/pki/ca.crt

<span class="c1"># 2. Add user with certificate</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>devuser<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span>devuser.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key<span class="o">=</span>devuser.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-certs<span class="o">=</span><span class="nb">true</span><span class="w">    </span><span class="c1"># Embed cert/key data in kubeconfig file</span>

<span class="c1"># 3. Create context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>devuser-context<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>devuser

<span class="c1"># 4. Switch to use this context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>devuser-context

<span class="c1"># 5. Verify connection</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
<h3 id="complete-automation-script">Complete Automation Script</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nv">USERNAME</span><span class="o">=</span><span class="s2">&quot;devuser&quot;</span>
<span class="nv">GROUP</span><span class="o">=</span><span class="s2">&quot;developers&quot;</span>
<span class="nv">DAYS_VALID</span><span class="o">=</span><span class="m">365</span>
<span class="nv">CLUSTER_IP</span><span class="o">=</span><span class="s2">&quot;api.example.com:6443&quot;</span>
<span class="nv">CA_CERT</span><span class="o">=</span><span class="s2">&quot;/etc/kubernetes/pki/ca.crt&quot;</span>
<span class="nv">CA_KEY</span><span class="o">=</span><span class="s2">&quot;/etc/kubernetes/pki/ca.key&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[1/5] Generating private key...&quot;</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.key<span class="w"> </span><span class="m">2048</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[2/5] Creating certificate signing request...&quot;</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-key<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">/O=</span><span class="si">${</span><span class="nv">GROUP</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[3/5] Signing CSR with cluster CA...&quot;</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CA<span class="w"> </span><span class="si">${</span><span class="nv">CA_CERT</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAkey<span class="w"> </span><span class="si">${</span><span class="nv">CA_KEY</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAcreateserial<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-days<span class="w"> </span><span class="si">${</span><span class="nv">DAYS_VALID</span><span class="si">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[4/5] Adding to kubeconfig...&quot;</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-cluster<span class="w"> </span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server<span class="o">=</span>https://<span class="si">${</span><span class="nv">CLUSTER_IP</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--certificate-authority<span class="o">=</span><span class="si">${</span><span class="nv">CA_CERT</span><span class="si">}</span>

kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key<span class="o">=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-certs<span class="o">=</span><span class="nb">true</span>

kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>-context<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[5/5] Verifying...&quot;</span>
kubectl<span class="w"> </span>config<span class="w"> </span>get-contexts<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✅ User &#39;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&#39; created successfully!&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;To use: kubectl config use-context </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-context&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;To apply RBAC: kubectl create rolebinding dev-role --clusterrole=view --user=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<hr />
<h2 id="part-7-kubernetes-api-certificatesigningrequest-csr">Part 7: Kubernetes API CertificateSigningRequest (CSR)</h2>
<h3 id="creating-csr-through-kubernetes-api-real-world-method">Creating CSR Through Kubernetes API (Real-World Method)</h3>
<p>In production clusters, instead of manually signing certificates, you create a <strong>CertificateSigningRequest</strong> object and let the cluster's control plane sign it.</p>
<h3 id="practical-generate-csr-and-submit-to-kubernetes">Practical: Generate CSR and Submit to Kubernetes</h3>
<h4 id="step-1-generate-private-key-and-csr-client-side">Step 1: Generate Private Key and CSR (Client-Side)</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate private key</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>newuser.key<span class="w"> </span><span class="m">2048</span>

<span class="c1"># Create CSR (note: generate CSR with subject, no signing yet)</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-key<span class="w"> </span>newuser.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span>newuser.csr<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=newuser/O=developers&quot;</span>

<span class="c1"># Verify CSR was created</span>
openssl<span class="w"> </span>req<span class="w"> </span>-in<span class="w"> </span>newuser.csr<span class="w"> </span>-text<span class="w"> </span>-noout
</code></pre></div>
<h4 id="step-2-create-kubernetes-csr-object">Step 2: Create Kubernetes CSR Object</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Base64 encode the CSR</span>
<span class="nv">CSR_CONTENT</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>newuser.csr<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="k">)</span>

<span class="c1"># Create CSR object</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: certificates.k8s.io/v1</span>
<span class="s">kind: CertificateSigningRequest</span>
<span class="s">metadata:</span>
<span class="s">  name: newuser-csr</span>
<span class="s">spec:</span>
<span class="s">  request: $CSR_CONTENT</span>
<span class="s">  signerName: kubernetes.io/kube-apiserver-client</span>
<span class="s">  expirationSeconds: 31536000  # 1 year</span>
<span class="s">  usages:</span>
<span class="s">  - client auth</span>
<span class="s">EOF</span>

<span class="c1"># Verify CSR was created</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr
kubectl<span class="w"> </span>describe<span class="w"> </span>csr<span class="w"> </span>newuser-csr
</code></pre></div>
<h4 id="step-3-approve-the-csr">Step 3: Approve the CSR</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Admin approves the request</span>
kubectl<span class="w"> </span>certificate<span class="w"> </span>approve<span class="w"> </span>newuser-csr

<span class="c1"># Verify it&#39;s approved</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span>newuser-csr
<span class="c1"># Status should show: Approved, Issued</span>

<span class="c1"># View the approved certificate (base64 encoded)</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span>newuser-csr<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.certificate}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>newuser.crt

<span class="c1"># Verify the certificate</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>newuser.crt<span class="w"> </span>-text<span class="w"> </span>-noout<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
</code></pre></div>
<h4 id="step-4-add-user-to-kubeconfig">Step 4: Add User to Kubeconfig</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Set cluster (if not already present)</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-cluster<span class="w"> </span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server<span class="o">=</span>https://api.example.com:6443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--certificate-authority<span class="o">=</span>/path/to/ca.crt

<span class="c1"># Add user with the issued certificate</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>newuser<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span>newuser.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key<span class="o">=</span>newuser.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-certs<span class="o">=</span><span class="nb">true</span>

<span class="c1"># Create context</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>newuser-context<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span>newuser

<span class="c1"># Test access</span>
kubectl<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>newuser-context
kubectl<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div>
<h3 id="complete-automation-script_1">Complete Automation Script</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nv">USERNAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nv">GROUP</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">developers</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">kubernetes</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">API_SERVER</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">4</span><span class="k">:-</span><span class="nv">https</span><span class="p">://api.example.com:</span><span class="nv">6443</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">CA_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">5</span><span class="k">:-</span><span class="p">/etc/kubernetes/pki/ca.crt</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$USERNAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> &lt;username&gt; [group] [cluster-name] [api-server] [ca-path]&quot;</span>
<span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;📋 Creating user certificate via Kubernetes CSR API...&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="c1"># Step 1: Generate private key</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[1/5] Generating private key...&quot;</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.key&quot;</span><span class="w"> </span><span class="m">2048</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.key&quot;</span>

<span class="c1"># Step 2: Create CSR file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[2/5] Creating certificate signing request...&quot;</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-key<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-out<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.csr&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">/O=</span><span class="si">${</span><span class="nv">GROUP</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="c1"># Step 3: Submit CSR to Kubernetes</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[3/5] Submitting CSR to Kubernetes API...&quot;</span>
<span class="nv">CSR_CONTENT</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.csr&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="k">)</span>

kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: certificates.k8s.io/v1</span>
<span class="s">kind: CertificateSigningRequest</span>
<span class="s">metadata:</span>
<span class="s">  name: ${USERNAME}-csr</span>
<span class="s">spec:</span>
<span class="s">  request: $CSR_CONTENT</span>
<span class="s">  signerName: kubernetes.io/kube-apiserver-client</span>
<span class="s">  expirationSeconds: 31536000</span>
<span class="s">  usages:</span>
<span class="s">  - client auth</span>
<span class="s">EOF</span>

<span class="c1"># Step 4: Wait for approval (manual or automated)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[4/5] CSR created. Waiting for approval...&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;      Admin needs to run: kubectl certificate approve </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-csr&quot;</span>

<span class="c1"># Optional: auto-approve for testing</span>
<span class="c1"># kubectl certificate approve ${USERNAME}-csr</span>

<span class="c1"># Wait for approval (with timeout)</span>
<span class="nv">TIMEOUT</span><span class="o">=</span><span class="m">300</span>
<span class="nv">ELAPSED</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$ELAPSED</span><span class="w"> </span>-lt<span class="w"> </span><span class="nv">$TIMEOUT</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-csr&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.conditions[?(@.type==&quot;Approved&quot;)].type}&#39;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$STATUS</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;Approved&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;      ✅ CSR Approved!&quot;</span>
<span class="w">    </span><span class="k">break</span>
<span class="w">  </span><span class="k">fi</span>
<span class="w">  </span>sleep<span class="w"> </span><span class="m">5</span>
<span class="w">  </span><span class="nv">ELAPSED</span><span class="o">=</span><span class="k">$((</span><span class="nv">ELAPSED</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="k">))</span>
<span class="k">done</span>

<span class="c1"># Step 5: Extract certificate and configure kubeconfig</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[5/5] Extracting certificate and configuring kubeconfig...&quot;</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-csr&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.certificate}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.crt&quot;</span>

<span class="c1"># Configure kubeconfig</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-cluster<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">API_SERVER</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--certificate-authority<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span><span class="s2">&quot;</span>

kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.crt&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-certs<span class="o">=</span><span class="nb">true</span>

kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-context&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--user<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✅ User &#39;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&#39; created successfully!&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;📌 Files created:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;   - </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.key      (private key - KEEP SECURE)&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;   - </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.csr      (certificate signing request)&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;   - </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">.crt      (signed certificate)&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;📌 To use this user:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;   kubectl config use-context </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-context&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;   kubectl get pods&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;📌 To grant permissions:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;   kubectl create rolebinding </span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">-view --clusterrole=view --user=</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<h3 id="view-and-manage-csrs">View and Manage CSRs</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># List all CSRs</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr

<span class="c1"># Show detailed CSR info</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>csr<span class="w"> </span>&lt;csr-name&gt;

<span class="c1"># Show CSR in YAML</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span>&lt;csr-name&gt;<span class="w"> </span>-o<span class="w"> </span>yaml

<span class="c1"># View the original CSR content</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span>&lt;csr-name&gt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.request}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-text<span class="w"> </span>-noout

<span class="c1"># Approve CSR</span>
kubectl<span class="w"> </span>certificate<span class="w"> </span>approve<span class="w"> </span>&lt;csr-name&gt;

<span class="c1"># Deny CSR</span>
kubectl<span class="w"> </span>certificate<span class="w"> </span>deny<span class="w"> </span>&lt;csr-name&gt;

<span class="c1"># Delete CSR</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>csr<span class="w"> </span>&lt;csr-name&gt;

<span class="c1"># Watch for pending CSRs</span>
kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span>--watch
</code></pre></div>
<h3 id="available-signer-names">Available Signer Names</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Different signerName values for different certificate types:</span>

<span class="c1"># 1. Client certificate for connecting to API server</span>
signerName:<span class="w"> </span>kubernetes.io/kube-apiserver-client

<span class="c1"># 2. Kubelet serving certificate (for kubelet HTTPS endpoint)</span>
signerName:<span class="w"> </span>kubernetes.io/kubelet-serving

<span class="c1"># 3. Legacy (kubeadm) client certificate</span>
signerName:<span class="w"> </span>kubernetes.io/kube-apiserver-client-kubelet

<span class="c1"># Check available signers in your cluster:</span>
kubectl<span class="w"> </span>get<span class="w"> </span>certificatesigningrequests.certificates.k8s.io<span class="w"> </span>-o<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>jq<span class="w"> </span><span class="s1">&#39;.items[].spec.signerName&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
</code></pre></div>
<h3 id="csr-best-practices-for-kind-clusters">CSR Best Practices for Kind Clusters</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. For kind, approve CSRs immediately or auto-approve them</span>
kubectl<span class="w"> </span>certificate<span class="w"> </span>approve<span class="w"> </span>&lt;csr-name&gt;

<span class="c1"># 2. Create a helper function for approval in testing</span>
auto-approve-csrs<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span>--no-headers<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>csr<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>csr<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$csr</span><span class="s2">&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.status.conditions}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>Approved<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span><span class="k">continue</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Approving: </span><span class="nv">$csr</span><span class="s2">&quot;</span>
<span class="w">    </span>kubectl<span class="w"> </span>certificate<span class="w"> </span>approve<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$csr</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># 3. Watch for pending CSRs</span>
watch<span class="w"> </span><span class="s1">&#39;kubectl get csr&#39;</span>
</code></pre></div>
<hr />
<h2 id="part-8-working-with-kubeconfig-examples">Part 8: Working with Kubeconfig - Examples</h2>
<h3 id="example-1-create-read-only-viewer-account">Example 1: Create Read-Only Viewer Account</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate keys</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>viewer.key<span class="w"> </span><span class="m">2048</span>
openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>viewer.key<span class="w"> </span>-out<span class="w"> </span>viewer.csr<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=viewer/O=viewers&quot;</span>
openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span>viewer.csr<span class="w"> </span>-CA<span class="w"> </span>/etc/kubernetes/pki/ca.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-CAkey<span class="w"> </span>/etc/kubernetes/pki/ca.key<span class="w"> </span>-out<span class="w"> </span>viewer.crt<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span>

<span class="c1"># Add to kubeconfig</span>
kubectl<span class="w"> </span>config<span class="w"> </span>set-credentials<span class="w"> </span>viewer<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-certificate<span class="o">=</span>viewer.crt<span class="w"> </span>--client-key<span class="o">=</span>viewer.key
kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span>viewer-context<span class="w"> </span>--cluster<span class="o">=</span>kubernetes<span class="w"> </span>--user<span class="o">=</span>viewer

<span class="c1"># Create RBAC role binding</span>
kubectl<span class="w"> </span>create<span class="w"> </span>rolebinding<span class="w"> </span>viewer-role<span class="w"> </span>--clusterrole<span class="o">=</span>view<span class="w"> </span>--user<span class="o">=</span>viewer
</code></pre></div>
<h3 id="example-2-certificate-expiration-check">Example 2: Certificate Expiration Check</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check when certs expire</span>
<span class="k">for</span><span class="w"> </span>cert<span class="w"> </span><span class="k">in</span><span class="w"> </span>/etc/kubernetes/pki/*.crt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cert</span><span class="s2">:&quot;</span>
<span class="w">  </span>openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cert</span><span class="s2">&quot;</span><span class="w"> </span>-noout<span class="w"> </span>-dates
<span class="k">done</span>

<span class="c1"># List certs expiring within 30 days</span>
<span class="c1"># (Useful for monitoring and renewal planning)</span>
</code></pre></div>
<h3 id="example-3-verify-certificate-trust-chain">Example 3: Verify Certificate Trust Chain</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check if cert was signed by CA</span>
openssl<span class="w"> </span>verify<span class="w"> </span>-CAfile<span class="w"> </span>/etc/kubernetes/pki/ca.crt<span class="w"> </span>cert.crt

<span class="c1"># Output: cert.crt: OK (if valid)</span>
</code></pre></div>
<hr />
<p><strong>Last Updated:</strong> January 9, 2026</p>
<p>~/.kube                                                                                                                      14:23:22
❯ kind get cluster
Gets one of [clusters, nodes, kubeconfig]</p>
<p>Usage:
  kind get [flags]
  kind get [command]</p>
<p>Available Commands:
  clusters    Lists existing kind clusters by their name
  kubeconfig  Prints cluster kubeconfig
  nodes       Lists existing kind nodes by their name</p>
<p>Flags:
  -h, --help   help for get</p>
<p>Global Flags:
  -q, --quiet             silence all stderr output
  -v, --verbosity int32   info log verbosity, higher value produces more output</p>
<p>Use "kind get [command] --help" for more information about a command.
ERROR: Subcommand is required</p>
<p>~/.kube                                                                                                                      14:24:45
❯ kind get clusters
gatewayapi</p>
<p>~/.kube                                                                                                                      14:24:53
❯ # Get kubeconfig for gatewayapi cluster
kind get kubeconfig --name=gatewayapi &gt; /tmp/gatewayapi-kubeconfig.yaml</p>
<h1 id="show-the-structure">Show the structure</h1>
<p>cat /tmp/gatewayapi-kubeconfig.yaml
zsh: command not found: #
zsh: command not found: #
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJS0RYandhOW1KNll3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TmpBeE1ERXdOekE0TlRoYUZ3MHpOVEV5TXpBd056RXpOVGhhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUM1OHpsZnJGRUJRZHZuRzJ6MzBvQ09zODJnTldnUlNsWW5ZNGgwUkVtSE5DOVVYWmFNUm1hVHFCQ1kKT2pDbW9nMVhaYlFQcTE5MHFGTkV1ZDk2MDRjS3FhTFhHbGhuR20wZEQ1dWFtN3NsQngrQURmMzErbEhXYTNsSgpGU3A1WFlIMGxpb3dWMHpQVmN5RlpDZjk0UTIxejVMS1lvRmdXWHdTMG5oZUZ5WWZPdjFXWUV3cVExZVFlS0RGCjljbFNiQ0VpbEtUbDgzZng1MXZ1YThLcGExTmt3TG1tdzFBSHZkZXRBUnZBUDk2Zm5zTm94SFY0YVM3YVNTM1kKQkJUeC9SWExPaFVJRXFjbFZSSzNyeEF4T2NUYnVqaCtZRzh3Nmwrc3VBY296QmtNZmNzcGY4UjdxMm4wTkdkcAp4eGYvZG9WeUQxK200N3dKVzIyTDcxalN6OXNUQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJTRXByTko1dmVOQU1kb1BWUlJ4cjJvUUpqUytqQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQmM5RnpOSEhTaAoyZnhJZ0l0azZEUVZRc3BpN0ZZcURKd3pKdFczZmx6ZHBnckF0STM4VTdmc0NhcnpFaFpQVmY3ODR2OTdFWHBDCmZabHRGVXlXL2xvWVlDZ1hnSGo1Sjh6MjNQSGxVVklJOUU0c1BYM1dKWlBjWmtsSWpyNFdDOFY1dzNpSms2aHoKZS9xdDhpb291QkFGNVlHM24ycTlSSUFuN0h3N3M0UCs5ZXJMOGlKbC80T0VOQWpNemRYMzJvZmJUenNzQlcyVwppelU4YWpVVnE0RkVRZW9zT3JmcWQvNURwcEJqb3lpZlJ1SXNLaDJNdG1vcFBtV3VLcTVLemI3M3BNcTJSeE5OClVWRDdXZWFzdTAxWVQrdEZTMlRqTFZyNGZxL1dYRjhDM0JUUHltZ3lUQWVxcXk4SzhVQlVFTnVBMG1FS1VONEcKcnVqbFZ1dEM1M0VXCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://127.0.0.1:39619
  name: kind-gatewayapi
contexts:
- context:
    cluster: kind-gatewayapi
    user: kind-gatewayapi
  name: kind-gatewayapi
current-context: kind-gatewayapi
kind: Config
users:
- name: kind-gatewayapi
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURLVENDQWhHZ0F3SUJBZ0lJTGh0ajRISmR5Nkl3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TmpBeE1ERXdOekE0TlRoYUZ3MHlOekF4TURFd056RXpOVGhhTUR3eApIekFkQmdOVkJBb1RGbXQxWW1WaFpHMDZZMngxYzNSbGNpMWhaRzFwYm5NeEdUQVhCZ05WQkFNVEVHdDFZbVZ5CmJtVjBaWE10WVdSdGFXNHdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDcWtwcEMKbndWQnNmMjFId2dGQ1Rod0dQR2RpcUtSVk42RVF3Z0Z3WnkzWjlNb0llRWZNa1MvYjlQOGxEY0d2Vk0vR3d3Rwp5RG4rcFJMK3ZYT2JObVNnblMveHNRK3NVamZnTERLb2V3ZHFBYXJCUG0vaHIxTXpPSXErdUdvMWRBeHZpcHNvCjNPQjc0Y0VsQmIxd2pxb3U1akwxRzNjNW9pbnRUSmFjcjJPcjZ3Z2JSaUsxaEF0ZjlPL2tFbndNRkQvdnV2NmMKSXZwVVB0aUtwUUJGZnhLRWdQYjZYOVZhc2J5d1Jab3JsS2pvSWlpVTNZM3ZBQ1FqSlExYVlEUm1JYW12bVNURQoyKzl4RDUweGY5MDNRSnp5UG45Umx0RzhPYnlHRTkvVW5IL1g2VER3UGRydFpwMjlXWHAxZDIrd3VyMld4a01PCnREZDZUbGNuV01kMStKL3JBZ01CQUFHalZqQlVNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUsKQmdnckJnRUZCUWNEQWpBTUJnTlZIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRklTbXMwbm05NDBBeDJnOQpWRkhHdmFoQW1OTDZNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUJlUXk2N3YvMVdFUVB5bXV6L2V4NHlNdHgwCjY3S3BWQzkxUVZ1aEFjNUpZMWwwSnp3bWxjRzJrUk1lK2VFM3Erd1pEMTRmYVhKcjdrbGFjQkcxMXRsZUZKRXoKelZCVVArU3Jpbk9yN05wS3VlMGdmZ2FzTTJ4UkFRVWkyOXQvem5FTjZ3a1BzRzkvbUFBSGZZWTAzVjlxSmovMwp2N3NFcElrR3lxNzMzek5qRC81bHEvTFgvUWppeHc4MzE1b0h1WHMzekhmM3pONGkrZFhRQnAxTlk0TGVCQzFYCnVUa3lhbXJRR3ZQRTBsT2llTUlLQ3pkQ1k0cXlpb04yL2Jqd21KZStXYTBpNEorQ3VKQ0MyWjVKYVJpVUM1QUQKdW94Z1lYSXFSazlkekZ2SkU2WnRvWG9VMDVlS0oyNHFBaEd4UEViV2ptMDZJVEtwc3J3MCs0aUVLY09mCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBcXBLYVFwOEZRYkg5dFI4SUJRazRjQmp4bllxaWtWVGVoRU1JQmNHY3QyZlRLQ0hoCkh6SkV2Mi9UL0pRM0JyMVRQeHNNQnNnNS9xVVMvcjF6bXpaa29KMHY4YkVQckZJMzRDd3lxSHNIYWdHcXdUNXYKNGE5VE16aUt2cmhxTlhRTWI0cWJLTnpnZStIQkpRVzljSTZxTHVZeTlSdDNPYUlwN1V5V25LOWpxK3NJRzBZaQp0WVFMWC9UdjVCSjhEQlEvNzdyK25DTDZWRDdZaXFVQVJYOFNoSUQyK2wvVldyRzhzRVdhSzVTbzZDSW9sTjJOCjd3QWtJeVVOV21BMFppR3ByNWtreE52dmNRK2RNWC9kTjBDYzhqNS9VWmJSdkRtOGhoUGYxSngvMStrdzhEM2EKN1dhZHZWbDZkWGR2c0xxOWxzWkREclEzZWs1WEoxakhkZmlmNndJREFRQUJBb0lCQUJJcUpPY0ZycFoxbG4rVQpkajJzWXQxcExVaC9nWVY1ajIxd0FxbUk3MHF4Y2Z3Rm5rYm5ZRjZFcHdOd1kwQnRVVndETjRUU0MzOEhPWjUxCmlCdFdMN2JTVm5ubUhHQlhySFNoTUU4MGlZWEJUTEVNbUV5UDU3WitNSG1wV096U3JCcGF4K0E4K1dPbjdISW8KQ2ltemxRTUQ1OEdtSGFHK2JRN3Zjalh0dXU4TlNXWFJRKzhtMHVYN2k1dGRUa3BXUkNKdEVYZzY5bmtLazF4LwpscHVHNS9RT2J3cDdrSVBYS0tuZTdYL1hRTnB6TCtSaHh3UVFxVllDUzhUMzZMVkVnMVZIbGV6OEpSQlVGNENvClRDUUM4SWgvVWY0TTBTWHd2Z1RJRXAyQlNWVThESWQzUHFhdk1RU2E2UmxZcnFmUHNFcXgwZ0tLSFhGM2ZjTDcKSXZadVFNRUNnWUVBM0cvQ21qZlJBY0lCVGJwYklYcXo2MEpjVEpZdDVDaEF3cEtYVjN5T3NmNGxDNG15MG1hcApNT2t5MWxkVXRMWnBaWTN2ejVqSE5rOUYyY3BiRjhRbHNyb3dPUzFjZ05XM1JVVExBaWZHRGpmak9uOTFiNHk2CjZ3T1hZSFlyRWszVXVrcm1tcTlRNlI1ek10bTNlNlNlRmlQSmovTzQzVUx1R2Z3MXNyanVmS3NDZ1lFQXhoZHEKZ0d5Z2wyellOSTc3ZWVmOVJRNTB2UGUwRFBKUGZWLzlXMldZWG1rMVQwNWVscWhEWXowRnhEWGo4aG9pZG5kTQpzZW42UUdueUdaMFQ3S0Uwc1pLWjlmaEZWWlhrYnM5dncxS3BsSlpCaG9uek1nVkVqeEw4ZGlwVVpTQmpuZHRjCmZmS3YvcncxdnpJdzZ0RDJ6Vk4vc21iQTFkT3hWTlFaQTZZZjZjRUNnWUVBZ0tBUi9HenZYMGcxL0lYdUlSWDUKSUNDanZPaXd0SDRzYzV5WUJLdWdsQW5JMGZleVNZVXYybU5vajV0N3lNcmJxeTlzTEVWb2tLOG5BaE5Lbmc2TgpOTUhoMjZzMVc5UFkwZWwzVDdXbm9xcEh3OTJWeDlabFJ6YmNRS1FUTStZSVovL0dtYUlNNDBvcVRCU3dOTXgwCmxsU2hpNGJhYXZsZjkvZXIyYktCTG1zQ2dZRUFsSWJzS1B6SjhLQUJBRytRNlJma0ZBcEJ4NHBtNnlvb0pkWjYKVGpRLzZkSXkwWkx1WTBJb3ZOajlZT0FUV096MW1DUGRVcTBnSVhvT3Q5dktHNnZIcWJsRlRXTnBBVUlSZEhCKwoyVkk2cXBsNjZoaTNTM01kczdWRnJJZ1NuWHlLbE1yc2I5Y3UxTzVqMGtjYzNJUHYrWVk1QWhmL1VKU1lxd1VZCitGNXdJVUVDZ1lCdE9FNGhzQXJteDgrbFRHQUJKMHRSdjZkYzE5WFJlUFFYY2NUV3gyQWt1alM5b1dmSHduUmIKWHVZQkI3Yi9TV05jcVJiNTZjMTZRZWYrZzFPb1RObGpaeHZmblg2WUZoUnNOeXNYeUtxUnRZdHZUcXhUM2VjbQpYdTlKWXVpUmx1enBJSUc5S1QrVS95VU1qcjFVa0x3Nmw5dU9mcGtSVko1elF2VVFSeXdvcXc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=</p>
<p>~/.kube                                                                                                                      14:25:21
❯ sed -n '/certificate-authority-data:/,/^[[:space:]]*server:/p' /tmp/gatewayapi-kubeconfig.yaml | \
  grep 'certificate-authority-data:' | \
  cut -d':' -f2- | \
  tr -d ' ' | \
  base64 -d &gt; /tmp/decoded-ca.crt</p>
<p>~/.kube                                                                                                                      14:28:18
❯ cat /tmp/decoded-ca.crt
-----BEGIN CERTIFICATE-----
MIIDBTCCAe2gAwIBAgIIKDXjwa9mJ6YwDQYJKoZIhvcNAQELBQAwFTETMBEGA1UE
AxMKa3ViZXJuZXRlczAeFw0yNjAxMDEwNzA4NThaFw0zNTEyMzAwNzEzNThaMBUx
EzARBgNVBAMTCmt1YmVybmV0ZXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
AoIBAQC58zlfrFEBQdvnG2z30oCOs82gNWgRSlYnY4h0REmHNC9UXZaMRmaTqBCY
OjCmog1XZbQPq190qFNEud9604cKqaLXGlhnGm0dD5uam7slBx+ADf31+lHWa3lJ
FSp5XYH0liowV0zPVcyFZCf94Q21z5LKYoFgWXwS0nheFyYfOv1WYEwqQ1eQeKDF
9clSbCEilKTl83fx51vua8Kpa1NkwLmmw1AHvdetARvAP96fnsNoxHV4aS7aSS3Y
BBTx/RXLOhUIEqclVRK3rxAxOcTbujh+YG8w6l+suAcozBkMfcspf8R7q2n0NGdp
xxf/doVyD1+m47wJW22L71jSz9sTAgMBAAGjWTBXMA4GA1UdDwEB/wQEAwICpDAP
BgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBSEprNJ5veNAMdoPVRRxr2oQJjS+jAV
BgNVHREEDjAMggprdWJlcm5ldGVzMA0GCSqGSIb3DQEBCwUAA4IBAQBc9FzNHHSh
2fxIgItk6DQVQspi7FYqDJwzJtW3flzdpgrAtI38U7fsCarzEhZPVf784v97EXpC
fZltFUyW/loYYCgXgHj5J8z23PHlUVII9E4sPX3WJZPcZklIjr4WC8V5w3iJk6hz
e/qt8ioouBAF5YG3n2q9RIAn7Hw7s4P+9erL8iJl/4OENAjMzdX32ofbTzssBW2W
izU8ajUVq4FEQeosOrfqd/5DppBjoyifRuIsKh2MtmopPmWuKq5Kzb73pMq2RxNN
UVD7Weasu01YT+tFS2TjLVr4fq/WXF8C3BTPymgyTAeqqy8K8UBUENuA0mEKUN4G
rujlVutC53EW
-----END CERTIFICATE-----</p>
<p>~/.kube                                                                                                                      14:28:22
❯ openssl x509 -in /tmp/decoded-ca.crt -text -noout | head -30
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2897472356293683110 (0x2835e3c1af6627a6)
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = kubernetes
        Validity
            Not Before: Jan  1 07:08:58 2026 GMT
            Not After : Dec 30 07:13:58 2035 GMT
        Subject: CN = kubernetes
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:b9:f3:39:5f<img alt="🇦🇨" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e6-1f1e8.png" title=":ac:" />51:01:41:db:e7:1b:6c:f7:d2:
                    80:8e:b3<img alt="💿" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f4bf.png" title=":cd:" />a0:35:68:11:4a:56:27:63:88:74:44:
                    49:87:34:2f:54:5d:96:8c:46:66:93:a8:10:98:3a:
                    30:a6:a2:0d:57:65:b4:0f:ab:5f:74:a8:53:44:b9:
                    df:7a:d3:87:0a:a9:a2:d7:1a:58:67:1a:6d:1d:0f:
                    9b:9a:9b<img alt="🇧🇧" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e7-1f1e7.png" title=":bb:" />25:07:1f:80:0d:fd:f5:fa:51:d6:6b:
                    79:49:15:2a:79:5d:81:f4:96:2a:30:57:4c<img alt="🇨🇫" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e8-1f1eb.png" title=":cf:" />55:
                    cc:85:64:27:fd:e1:0d:b5:cf:92:ca:62:81:60:59:
                    7c:12:d2:78:5e:17:26:1f:3a:fd:56:60:4c:2a:43:
                    57:90:78:a0:c5:f5:c9:52:6c:21:22:94:a4:e5:f3:
                    77:f1:e7:5b:ee:6b:c2:a9:6b:53:64:c0:b9:a6:c3:
                    50:07:bd:d7:ad:01:1b:c0:3f<img alt="🇩🇪" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e9-1f1ea.png" title=":de:" />9f:9e:c3:68:c4:
                    75:78:69:2e:da:49:2d:d8:04:14:f1:fd:15:cb:3a:
                    15:08:12:a7:25:55:12:b7:af:10:31:39:c4:db:ba:
                    38:7e:60:6f:30<img alt="🇪🇦" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1ea-1f1e6.png" title=":ea:" />5f<img alt="🇦🇨" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e6-1f1e8.png" title=":ac:" />b8:07:28<img alt="🇨🇨" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e8-1f1e8.png" title=":cc:" />19:0c:7d:
                    cb:29:7f:c4:7b<img alt="🆎" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f18e.png" title=":ab:" />69:f4:34:67:69:c7:17:ff:76:</p>
<p>~/.kube                                                                                                                      14:28:36
❯ awk '/client-certificate-data:/{flag=1} flag &amp;&amp; /^[[:space:]]<em>client-key-data:/{flag=0} flag' /tmp/gatewayapi-kubeconfig.yaml | \
  grep 'client-certificate-data:' | \
  cut -d':' -f2- | \
  sed 's/^[[:space:]]</em>//' | \
  base64 -d &gt; /tmp/decoded-client.crt</p>
<p>~/.kube                                                                                                                      14:28:57
❯ openssl x509 -in /tmp/decoded-client.crt -text -noout | head -30
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 3322358965758446498 (0x2e1b63e0725dcba2)
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = kubernetes
        Validity
            Not Before: Jan  1 07:08:58 2026 GMT
            Not After : Jan  1 07:13:58 2027 GMT
        Subject: O = kubeadm:cluster-admins, CN = kubernetes-admin
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:aa:92:9a:42:9f:05:41:b1:fd:b5:1f:08:05:09:
                    38:70:18:f1:9d:8a:a2:91:54<img alt="🇩🇪" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e9-1f1ea.png" title=":de:" />84:43:08:05:c1:
                    9c:b7:67:d3:28:21:e1:1f:32:44:bf:6f:d3:fc:94:
                    37:06:bd:53:3f:1b:0c:06:c8:39:fe:a5:12:fe:bd:
                    73:9b:36:64:a0:9d:2f:f1:b1:0f:ac:52:37:e0:2c:
                    32:a8:7b:07:6a:01:aa:c1:3e:6f:e1<img alt="🇦🇫" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e6-1f1eb.png" title=":af:" />53:33:38:
                    8a<img alt="🇧🇪" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e7-1f1ea.png" title=":be:" />b8:6a:35:74:0c:6f:8a:9b:28:dc:e0:7b:e1:
                    c1:25:05<img alt="🇧🇩" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e7-1f1e9.png" title=":bd:" />70:8e:aa:2e:e6:32:f5:1b:77:39:a2:
                    29:ed:4c:96:9c<img alt="🇦🇫" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e6-1f1eb.png" title=":af:" />63<img alt="🆎" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f18e.png" title=":ab:" />eb:08:1b:46:22:b5:84:
                    0b:5f:f4:ef:e4:12:7c:0c:14:3f:ef<img alt="🇧🇦" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e7-1f1e6.png" title=":ba:" />fe:9c:22:
                    fa:54:3e:d8:8a:a5:00:45:7f:12:84:80:f6:fa:5f:
                    d5:5a:b1:bc:b0:45:9a:2b:94:a8:e8:22:28:94:dd:
                    8d:ef:00:24:23:25:0d:5a:60:34:66:21:a9<img alt="🇦🇫" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e6-1f1eb.png" title=":af:" />99:
                    24:c4:db:ef:71:0f:9d:31:7f:dd:37:40:9c:f2:3e:
                    7f:51:96:d1:bc:39:bc:86:13:df:d4:9c:7f:d7:e9:
                    30:f0:3d:da:ed:66:9d<img alt="🇧🇩" class="emojione" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f1e7-1f1e9.png" title=":bd:" />59:7a:75:77:6f:b0:ba:</p>
<p>~/.kube                                                                                                                      14:29:02
❯ awk '/client-key-data:/{flag=1} flag &amp;&amp; /^[[:space:]]<em>token:/{flag=0} flag' /tmp/gatewayapi-kubeconfig.yaml | \
  grep 'client-key-data:' | \
  cut -d':' -f2- | \
  sed 's/^[[:space:]]</em>//' | \
  base64 -d &gt; /tmp/decoded-client.key</p>
<p>~/.kube                                                                                                                      14:29:18
❯ file /tmp/decoded-client.key
/tmp/decoded-client.key: PEM RSA private key</p>
<p>~/.kube                                                                                                                      14:29:22
❯ # Using yq (if installed)
cat /tmp/gatewayapi-kubeconfig.yaml | yq '.clusters[0].cluster.certificate-authority-data' | base64 -d &gt; /tmp/ca.crt
cat /tmp/gatewayapi-kubeconfig.yaml | yq '.users[0].user.client-certificate-data' | base64 -d &gt; /tmp/client.crt
cat /tmp/gatewayapi-kubeconfig.yaml | yq '.users[0].user.client-key-data' | base64 -d &gt; /tmp/client.key</p>
<h1 id="using-grepsed-only">Using grep/sed only</h1>
<p>cat /tmp/gatewayapi-kubeconfig.yaml | grep -A1 -B1 'certificate-authority-data:' | tail -1 | base64 -d &gt; /tmp/ca2.crt
zsh: unknown file attribute: i
jq: error: authority/0 is not defined at <top-level>, line 1:
.clusters[0].cluster.certificate-authority-data
jq: error: data/0 is not defined at <top-level>, line 1:
.clusters[0].cluster.certificate-authority-data
jq: 2 compile errors
jq: error: certificate/0 is not defined at <top-level>, line 1:
.users[0].user.client-certificate-data
jq: error: data/0 is not defined at <top-level>, line 1:
.users[0].user.client-certificate-data
jq: 2 compile errors
jq: error: key/0 is not defined at <top-level>, line 1:
.users[0].user.client-key-data
jq: error: data/0 is not defined at <top-level>, line 1:
.users[0].user.client-key-data
jq: 2 compile errors
zsh: command not found: #
base64: invalid input</p>
<p>~/.kube                                                                                                                      14:29:36
❯</p>
<p>play with openssl
- ca key
- csr
- sign the csr</p>
<p>undderstnad the contnet inside</p>
<p>what is cn
what is groups 
how certificate or csr at basica level undersnada</p>
<p>-&gt; how kubeconfig </p>
<p>-&gt; kubectl config command everytrhign everything!
-&gt; then how kubeconfig looks like differnet way to derive and create
-&gt; create a user -&gt; key, get create a csr request to the kluster 
-&gt; addmin approve it athen create stuff and stuff thign please</p>
<p>pki inspect -( do somethign with some pratcial qustion )</p>
<p>play with openssl
- ca key
- csr
- sign the csr</p>
<p>undderstnad the contnet inside</p>
<p>what is cn
what is groups 
how certificate or csr at basica level undersnada</p>
<p>-&gt; how kubeconfig </p>
<p>-&gt; kubectl config command everytrhign everything!
-&gt; then how kubeconfig looks like differnet way to derive and create
-&gt; create a user -&gt; key, get create a csr request to the kluster 
-&gt; addmin approve it athen create stuff and stuff thign please</p>
<p>pki inspect -( do somethign with some pratcial qustion )</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../question/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../question/" class="btn btn-xs btn-link">
        Kubeconfig &amp; Kubernetes PKI - Practical Challenges
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../04-admission-webhook/notes/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../04-admission-webhook/notes/" class="btn btn-xs btn-link">
        Notes
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>