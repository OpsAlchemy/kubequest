<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/01-autoscaling/hpa/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Horizontal Pod Autoscaler (HPA) - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Horizontal Pod Autoscaler (HPA)", url: "#_top", children: [
              {title: "\ud83d\udcca Metrics Server Installation \u0026amp; Configuration", url: "#metrics-server-installation-configuration" },
              {title: "\u2699\ufe0f Horizontal Pod Autoscaler (HPA) - Complete Guide", url: "#horizontal-pod-autoscaler-hpa-complete-guide" },
              {title: "\ud83c\udf9b\ufe0f HPA Behavior Configuration - Complete Details", url: "#hpa-behavior-configuration-complete-details" },
              {title: "\ud83e\uddea Load Testing with stress Command", url: "#load-testing-with-stress-command" },
              {title: "\ud83d\udd0d HPA Status Interpretation", url: "#hpa-status-interpretation" },
              {title: "\ud83d\udea8 Troubleshooting Common Issues", url: "#troubleshooting-common-issues" },
              {title: "\ud83d\udccb Quick Reference Commands", url: "#quick-reference-commands" },
              {title: "\ud83d\udca1 Best Practices Summary", url: "#best-practices-summary" },
              {title: "\u26a0\ufe0f Common Pitfalls to Avoid", url: "#common-pitfalls-to-avoid" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../keywords/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../keywords/" class="btn btn-xs btn-link">
        Search Keywords+
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../.." class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../.." class="btn btn-xs btn-link">
        CKA
      </a>
    </div>
    
  </div>

    

    <h1 id="horizontal-pod-autoscaler-hpa">Horizontal Pod Autoscaler (HPA)</h1>
<h2 id="metrics-server-installation-configuration">ğŸ“Š <strong>Metrics Server Installation &amp; Configuration</strong></h2>
<h3 id="purpose"><strong>Purpose</strong></h3>
<p>The Metrics Server collects resource utilization data (CPU/Memory) from Kubernetes nodes and pods, enabling the <code>kubectl top</code> command and providing metrics to the Horizontal Pod Autoscaler (HPA).</p>
<h3 id="core-issue-in-labs"><strong>Core Issue in Labs</strong></h3>
<p>Lab environments like KillerCoda often have self-signed or untrusted TLS certificates between components. Without bypassing TLS verification, the Metrics Server cannot scrape metrics from kubelets.</p>
<h3 id="recommended-installation-method-helm"><strong>Recommended Installation Method (Helm)</strong></h3>
<h4 id="standard-installation"><strong>Standard Installation</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Add Helm repository</span>
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>metrics-server<span class="w"> </span>https://kubernetes-sigs.github.io/metrics-server/
helm<span class="w"> </span>repo<span class="w"> </span>update

<span class="c1"># Install with lab-friendly configuration</span>
helm<span class="w"> </span>install<span class="w"> </span>metrics-server<span class="w"> </span>metrics-server/metrics-server<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;args={--cert-dir=/tmp,--secure-port=4443,--kubelet-insecure-tls,--kubelet-preferred-address-types=InternalIP}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="nv">containerPort</span><span class="o">=</span><span class="m">4443</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;livenessProbe.httpGet.path=/livez&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;livenessProbe.httpGet.port=4443&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;livenessProbe.httpGet.scheme=HTTPS&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;readinessProbe.httpGet.path=/readyz&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;readinessProbe.httpGet.port=4443&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span><span class="s1">&#39;readinessProbe.httpGet.scheme=HTTPS&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>service.port<span class="o">=</span><span class="m">4443</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>service.targetPort<span class="o">=</span><span class="m">4443</span>
</code></pre></div>
<h4 id="key-configuration-parameters-explained"><strong>Key Configuration Parameters Explained</strong></h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Purpose</th>
<th>Why It's Needed</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--kubelet-insecure-tls</code></td>
<td>Disables TLS verification</td>
<td>Lab environments have self-signed certs</td>
</tr>
<tr>
<td><code>--kubelet-preferred-address-types=InternalIP</code></td>
<td>Uses internal IPs</td>
<td>Ensures correct network connectivity</td>
</tr>
<tr>
<td><code>containerPort: 4443</code></td>
<td>Explicit port definition</td>
<td>Avoids conflicts with default ports</td>
</tr>
<tr>
<td>Port 4443 in probes</td>
<td>Consistent port usage</td>
<td>Health checks match actual listening port</td>
</tr>
<tr>
<td>HTTPS scheme</td>
<td>Secure connections</td>
<td>Required for metrics server security</td>
</tr>
</tbody>
</table>
<h3 id="verification-steps"><strong>Verification Steps</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Wait 20-30 seconds for initialization</span>
sleep<span class="w"> </span><span class="m">20</span>

<span class="c1"># Check pod status</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>metrics-server

<span class="c1"># Test metrics collection</span>
kubectl<span class="w"> </span>top<span class="w"> </span>nodes
kubectl<span class="w"> </span>top<span class="w"> </span>pods

<span class="c1"># Verify API service</span>
kubectl<span class="w"> </span>get<span class="w"> </span>apiservice<span class="w"> </span>v1beta1.metrics.k8s.io
<span class="c1"># Should show: AVAILABLE=True</span>
</code></pre></div>
<h3 id="troubleshooting-metrics-server"><strong>Troubleshooting Metrics Server</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check logs for connection issues</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>deployment/metrics-server

<span class="c1"># If &#39;Failed to scrape node&#39;, verify network policies</span>
kubectl<span class="w"> </span>get<span class="w"> </span>networkpolicies<span class="w"> </span>-A

<span class="c1"># Test direct metrics API access</span>
kubectl<span class="w"> </span>get<span class="w"> </span>--raw<span class="w"> </span><span class="s2">&quot;/apis/metrics.k8s.io/v1beta1/nodes&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
</code></pre></div>
<h2 id="horizontal-pod-autoscaler-hpa-complete-guide">âš™ï¸ <strong>Horizontal Pod Autoscaler (HPA) - Complete Guide</strong></h2>
<h3 id="what-hpa-does"><strong>What HPA Does</strong></h3>
<p>HPA automatically adjusts the number of pod replicas in a deployment based on observed metrics, maintaining your defined target utilization.</p>
<p><strong>Core Formula</strong>: <code>desiredReplicas = ceil(currentReplicas Ã— (currentMetricValue / desiredMetricValue))</code></p>
<h3 id="hpa-architecture-diagram"><strong>HPA Architecture Diagram</strong></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HPA Controller                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Get Metrics â”‚â”€â”€â”€â”€â–¶â”‚  Calculate   â”‚â”€â”€â”€â”€â–¶â”‚  Update      â”‚         â”‚
â”‚  â”‚  from API    â”‚     â”‚  Desired     â”‚     â”‚  Deployment  â”‚         â”‚
â”‚  â”‚              â”‚     â”‚  Replicas    â”‚     â”‚  Replicas    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Metrics API   â”‚         â”‚   Deployment    â”‚
â”‚   (Metrics-     â”‚         â”‚   Controller    â”‚
â”‚    Server)      â”‚         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Kubelet      â”‚
â”‚   (Nodes/Pods)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<h3 id="basic-hpa-structure"><strong>Basic HPA Structure</strong></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">autoscaling/v2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-hpa</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scaleTargetRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-app</span>

<span class="w">  </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">        </span><span class="c1"># Minimum pods for availability</span>
<span class="w">  </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">       </span><span class="c1"># Maximum pods for cost control</span>

<span class="w">  </span><span class="nt">metrics</span><span class="p">:</span><span class="w">              </span><span class="c1"># What to monitor</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Resource</span>
<span class="w">    </span><span class="nt">resource</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpu</span>
<span class="w">      </span><span class="nt">target</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Utilization</span>
<span class="w">        </span><span class="nt">averageUtilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">70</span><span class="w">  </span><span class="c1"># Target 70% CPU usage</span>

<span class="w">  </span><span class="nt">behavior</span><span class="p">:</span><span class="w">             </span><span class="c1"># How to scale (optional but recommended)</span>
<span class="w">    </span><span class="nt">scaleUp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">policies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">      </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="w">      </span><span class="nt">policies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</code></pre></div>
<h3 id="prerequisite-resource-requests"><strong>Prerequisite: Resource Requests</strong></h3>
<p><strong>Critical</strong>: Pods must have resource requests for HPA to calculate utilization percentages.
<div class="highlight"><pre><span></span><code><span class="c1"># In your deployment template</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span><span class="w">    </span><span class="c1"># HPA uses: (actual usage / 256Mi) Ã— 100%</span>
<span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;250m&quot;</span><span class="w">        </span><span class="c1"># Requested = 0.25 CPU cores</span>
<span class="w">  </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512Mi&quot;</span>
<span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>
</code></pre></div></p>
<p><strong>Common Mistake</strong>: Using wrong units
- âŒ CPU: <code>"256Mi"</code> (Mi is for memory!)
- âœ… CPU: <code>"250m"</code> (millicores) or <code>"0.25"</code>
- âœ… Memory: <code>"256Mi"</code> (mebibytes) or <code>"512Mi"</code></p>
<h2 id="hpa-behavior-configuration-complete-details">ğŸ›ï¸ <strong>HPA Behavior Configuration - Complete Details</strong></h2>
<h3 id="purpose-of-behavior-settings"><strong>Purpose of Behavior Settings</strong></h3>
<p>Control the <strong>timing</strong>, <strong>speed</strong>, and <strong>magnitude</strong> of scaling operations to prevent rapid oscillations ("flapping") and ensure stable application performance.</p>
<h3 id="core-components-explained"><strong>Core Components Explained</strong></h3>
<h4 id="1-stabilizationwindowseconds"><strong>1. <code>stabilizationWindowSeconds</code></strong></h4>
<p>A waiting period after a metric change before taking scaling action.</p>
<div class="highlight"><pre><span></span><code><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">  </span><span class="c1"># Wait 5 minutes of low usage before scaling down</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Recommended Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scale Up (responsive)</td>
<td>0-30 seconds</td>
</tr>
<tr>
<td>Scale Down (conservative)</td>
<td>300-600 seconds</td>
</tr>
<tr>
<td>Stateful applications</td>
<td>600+ seconds</td>
</tr>
</tbody>
</table>
<h4 id="2-policies-scaling-rules"><strong>2. <code>policies</code> - Scaling Rules</strong></h4>
<p>Define how many pods can be added/removed in a time window.</p>
<div class="highlight"><pre><span></span><code><span class="nt">policies</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pods</span><span class="w">        </span><span class="c1"># Fixed number of pods</span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">          </span><span class="c1"># Add/remove 2 pods max</span>
<span class="w">  </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span><span class="w"> </span><span class="c1"># Every 60 seconds</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span><span class="w">     </span><span class="c1"># Percentage of current pods</span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class="w">         </span><span class="c1"># Add/remove 50% of current pods</span>
<span class="w">  </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"> </span><span class="c1"># Every 30 seconds</span>
</code></pre></div>
<p><strong>Policy Types Comparison</strong>:
| Type | Best For | Example | Result (10 pods â†’ ?) |
|------|----------|---------|----------------------|
| <code>Pods</code> | Predictable scaling | <code>value: 3</code> | Add/remove exactly 3 pods |
| <code>Percent</code> | Proportional scaling | <code>value: 50</code> | Add/remove 5 pods (50% of 10) |</p>
<h4 id="3-selectpolicy-choosing-between-policies"><strong>3. <code>selectPolicy</code> - Choosing Between Policies</strong></h4>
<p>When multiple policies exist, which one to apply?</p>
<div class="highlight"><pre><span></span><code><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Max</span><span class="w">  </span><span class="c1"># Use the policy allowing the BIGGEST change</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Policy</th>
<th>Behavior</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Max</code></td>
<td>Uses policy allowing largest change</td>
<td>Fast scaling response</td>
</tr>
<tr>
<td><code>Min</code></td>
<td>Uses policy allowing smallest change</td>
<td>Conservative, safe scaling</td>
</tr>
<tr>
<td><code>Disabled</code></td>
<td>No scaling in this direction</td>
<td>Disable scale-up/down</td>
</tr>
</tbody>
</table>
<p><strong>Example with <code>Max</code></strong>:
<div class="highlight"><pre><span></span><code><span class="nt">policies</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pods</span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">          </span><span class="c1"># Can change 2 pods</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w">        </span><span class="c1"># Can change 100% of pods (all of them!)</span>

<span class="c1"># With selectPolicy: Max â†’ Uses Percent: 100 (bigger change)</span>
<span class="c1"># With selectPolicy: Min â†’ Uses Pods: 2 (smaller change)</span>
</code></pre></div></p>
<h3 id="complete-behavior-configuration-examples"><strong>Complete Behavior Configuration Examples</strong></h3>
<h4 id="1-web-application-pattern-responsive"><strong>1. Web Application Pattern (Responsive)</strong></h4>
<div class="highlight"><pre><span></span><code><span class="nt">behavior</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scaleUp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">      </span><span class="c1"># React immediately to traffic spikes</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pods</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">    </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Max</span><span class="w">                  </span><span class="c1"># Scale aggressively during spikes</span>

<span class="w">  </span><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">    </span><span class="c1"># Wait 5 minutes before scaling down</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">    </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Max</span>
</code></pre></div>
<h4 id="2-batch-processing-pattern-conservative"><strong>2. Batch Processing Pattern (Conservative)</strong></h4>
<div class="highlight"><pre><span></span><code><span class="nt">behavior</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scaleUp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span><span class="w">     </span><span class="c1"># Wait 1 minute to confirm need</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pods</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">    </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Max</span>

<span class="w">  </span><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span><span class="w">    </span><span class="c1"># Wait 10 minutes (long jobs)</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pods</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">180</span>
<span class="w">    </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Min</span><span class="w">                  </span><span class="c1"># Scale down very slowly</span>
</code></pre></div>
<h4 id="3-real-timestreaming-pattern-aggressive"><strong>3. Real-time/Streaming Pattern (Aggressive)</strong></h4>
<div class="highlight"><pre><span></span><code><span class="nt">behavior</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scaleUp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span><span class="w">      </span><span class="c1"># Can double pod count</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Max</span>

<span class="w">  </span><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w">      </span><span class="c1"># Can remove all extra pods</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">    </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Max</span>
</code></pre></div>
<h2 id="load-testing-with-stress-command">ğŸ§ª <strong>Load Testing with <code>stress</code> Command</strong></h2>
<h3 id="purpose-of-load-testing"><strong>Purpose of Load Testing</strong></h3>
<ul>
<li>Verify HPA triggers at correct thresholds</li>
<li>Test scaling behavior under controlled conditions</li>
<li>Identify optimal resource requests and limits</li>
</ul>
<h3 id="using-the-polinuxstress-image"><strong>Using the <code>polinux/stress</code> Image</strong></h3>
<h4 id="basic-test-pod"><strong>Basic Test Pod</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a pod for testing</span>
kubectl<span class="w"> </span>run<span class="w"> </span>stress-test<span class="w"> </span>--image<span class="o">=</span>polinux/stress<span class="w"> </span>--command<span class="w"> </span>--<span class="w"> </span>sleep<span class="w"> </span><span class="m">3600</span>

<span class="c1"># Run stress commands inside the pod</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>stress-test<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>100M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">60</span>
</code></pre></div>
<h4 id="memory-stress-testing"><strong>Memory Stress Testing</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Memory Stress Only</span>
<span class="c1"># Syntax: --vm N (workers) --vm-bytes X (memory per worker) --timeout T (seconds)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">2</span><span class="w"> </span>--vm-bytes<span class="w"> </span>150M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">120</span>

<span class="c1"># 2. Heavy Memory Load</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">4</span><span class="w"> </span>--vm-bytes<span class="w"> </span>500M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">180</span>

<span class="c1"># 3. Continuous Memory Stress (background)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>100M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>
<h4 id="cpu-stress-testing"><strong>CPU Stress Testing</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. CPU Stress Only</span>
<span class="c1"># Syntax: --cpu N (workers) --timeout T (seconds)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">90</span>

<span class="c1"># 2. Heavy CPU Load (all cores)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">8</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">120</span>

<span class="c1"># 3. Mixed CPU Load (varying intensity)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="se">\</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">60</span>
</code></pre></div>
<h4 id="combined-stress-testing"><strong>Combined Stress Testing</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. Memory + CPU Combined Stress</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>200M<span class="w"> </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">180</span>

<span class="c1"># 2. Heavy Combined Load</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">2</span><span class="w"> </span>--vm-bytes<span class="w"> </span>300M<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">240</span>

<span class="c1"># 3. Sequential Stress Testing</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">60</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">2</span><span class="w"> </span>--vm-bytes<span class="w"> </span>100M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">60</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>&lt;pod&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>150M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">90</span>
</code></pre></div>
<h4 id="testing-hpa-with-memory-metrics"><strong>Testing HPA with Memory Metrics</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Given: HPA target is 70% memory utilization</span>
<span class="c1"># Given: Pod requests 128Mi memory</span>
<span class="c1"># Calculation: Need ~90Mi usage to trigger scaling (128Mi Ã— 70% = 89.6Mi)</span>

<span class="c1"># Trigger scaling</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deployment/your-app<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>100M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">300</span>

<span class="c1"># Monitor scaling</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s1">&#39;kubectl get hpa,pods &amp;&amp; echo &quot;---&quot; &amp;&amp; kubectl top pods&#39;</span>
</code></pre></div>
<h4 id="testing-hpa-with-cpu-metrics"><strong>Testing HPA with CPU Metrics</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Given: HPA target is 50% CPU utilization  </span>
<span class="c1"># Given: Pod requests 500m CPU (0.5 cores)</span>
<span class="c1"># Calculation: Need ~250m usage to trigger scaling (500m Ã— 50% = 250m)</span>

<span class="c1"># Trigger CPU scaling</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deployment/your-app<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">2</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">300</span>

<span class="c1"># Monitor CPU-based scaling</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="s1">&#39;kubectl get hpa &amp;&amp; echo &quot;CPU Usage:&quot; &amp;&amp; kubectl top pods | grep your-app&#39;</span>
</code></pre></div>
<h4 id="multi-metric-hpa-testing"><strong>Multi-Metric HPA Testing</strong></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Create HPA watching both CPU and Memory</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: autoscaling/v2</span>
<span class="s">kind: HorizontalPodAutoscaler</span>
<span class="s">metadata:</span>
<span class="s">  name: multi-hpa</span>
<span class="s">spec:</span>
<span class="s">  scaleTargetRef:</span>
<span class="s">    apiVersion: apps/v1</span>
<span class="s">    kind: Deployment</span>
<span class="s">    name: your-app</span>
<span class="s">  minReplicas: 1</span>
<span class="s">  maxReplicas: 10</span>
<span class="s">  metrics:</span>
<span class="s">  - type: Resource</span>
<span class="s">    resource:</span>
<span class="s">      name: cpu</span>
<span class="s">      target:</span>
<span class="s">        type: Utilization</span>
<span class="s">        averageUtilization: 60</span>
<span class="s">  - type: Resource</span>
<span class="s">    resource:</span>
<span class="s">      name: memory</span>
<span class="s">      target:</span>
<span class="s">        type: Utilization</span>
<span class="s">        averageUtilization: 70</span>
<span class="s">EOF</span>

<span class="c1"># Test both resources</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deployment/your-app<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--vm<span class="w"> </span><span class="m">2</span><span class="w"> </span>--vm-bytes<span class="w"> </span>200M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">300</span>
</code></pre></div>
<h2 id="hpa-status-interpretation">ğŸ” <strong>HPA Status Interpretation</strong></h2>
<h3 id="checking-hpa-status"><strong>Checking HPA Status</strong></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>hpa
<span class="c1"># Output shows: REFERENCE, TARGETS, MINPODS, MAXPODS, REPLICAS</span>

kubectl<span class="w"> </span>describe<span class="w"> </span>hpa<span class="w"> </span>your-hpa
<span class="c1"># Shows conditions, events, and detailed metrics</span>
</code></pre></div>
<h3 id="key-hpa-conditions"><strong>Key HPA Conditions</strong></h3>
<table>
<thead>
<tr>
<th>Condition</th>
<th>Status</th>
<th>Meaning</th>
<th>Action Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AbleToScale</code></td>
<td>True/False</td>
<td>Can HPA modify replicas?</td>
<td>Check permissions if False</td>
</tr>
<tr>
<td><code>ScalingActive</code></td>
<td>True/False</td>
<td>Getting metrics successfully?</td>
<td>Fix metrics server if False</td>
</tr>
<tr>
<td><code>ScalingLimited</code></td>
<td>True/False</td>
<td>Hit min/max replica limits?</td>
<td>Adjust min/max if True</td>
</tr>
</tbody>
</table>
<h3 id="common-hpa-events"><strong>Common HPA Events</strong></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>hpa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A5<span class="w"> </span><span class="s2">&quot;Events:&quot;</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Event</th>
<th>Meaning</th>
<th>Typical Cause</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SuccessfulRescale</code></td>
<td>HPA changed replica count</td>
<td>Normal operation</td>
</tr>
<tr>
<td><code>FailedGetResourceMetric</code></td>
<td>Can't fetch metrics</td>
<td>Metrics server down</td>
</tr>
<tr>
<td><code>FailedComputeMetricsReplicas</code></td>
<td>Can't calculate desired replicas</td>
<td>Invalid metric configuration</td>
</tr>
</tbody>
</table>
<h2 id="troubleshooting-common-issues">ğŸš¨ <strong>Troubleshooting Common Issues</strong></h2>
<h3 id="issue-1-hpa-shows-unknown-targets"><strong>Issue 1: HPA shows <code>&lt;unknown&gt;</code> targets</strong></h3>
<p><strong>Cause</strong>: Metrics Server not working
<strong>Solution</strong>:
<div class="highlight"><pre><span></span><code><span class="c1"># Check metrics-server pod</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>metrics-server

<span class="c1"># Check logs</span>
kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>deployment/metrics-server

<span class="c1"># Reinstall if needed (with correct flags)</span>
helm<span class="w"> </span>upgrade<span class="w"> </span>metrics-server<span class="w"> </span>--reuse-values<span class="w"> </span>--set<span class="w"> </span><span class="s1">&#39;args={--kubelet-insecure-tls}&#39;</span>
</code></pre></div></p>
<h3 id="issue-2-hpa-not-scaling-when-expected"><strong>Issue 2: HPA not scaling when expected</strong></h3>
<p><strong>Checklist</strong>:
1. Verify pod has resource requests (<code>kubectl get pod -o yaml | grep requests</code>)
2. Check current vs target metrics (<code>kubectl describe hpa</code>)
3. Verify HPA is not limited (<code>ScalingLimited</code> condition)
4. Ensure metrics are above target threshold</p>
<h3 id="issue-3-rapid-scaling-oscillations-flapping"><strong>Issue 3: Rapid scaling oscillations ("flapping")</strong></h3>
<p><strong>Solution</strong>: Adjust behavior settings
<div class="highlight"><pre><span></span><code><span class="nt">behavior</span><span class="p">:</span>
<span class="w">  </span><span class="nt">scaleDown</span><span class="p">:</span>
<span class="w">    </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span><span class="w">  </span><span class="c1"># Increase from 300 to 600</span>
<span class="w">    </span><span class="nt">policies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Percent</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w">  </span><span class="c1"># Reduce from 50% to 20%</span>
<span class="w">      </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120</span>
</code></pre></div></p>
<h2 id="quick-reference-commands">ğŸ“‹ <strong>Quick Reference Commands</strong></h2>
<h3 id="hpa-management"><strong>HPA Management</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create HPA with kubectl</span>
kubectl<span class="w"> </span>autoscale<span class="w"> </span>deployment/my-app<span class="w"> </span>--cpu-percent<span class="o">=</span><span class="m">50</span><span class="w"> </span>--min<span class="o">=</span><span class="m">1</span><span class="w"> </span>--max<span class="o">=</span><span class="m">5</span>

<span class="c1"># Get HPA information</span>
kubectl<span class="w"> </span>get<span class="w"> </span>hpa
kubectl<span class="w"> </span>describe<span class="w"> </span>hpa<span class="w"> </span>&lt;name&gt;
kubectl<span class="w"> </span>get<span class="w"> </span>hpa<span class="w"> </span>&lt;name&gt;<span class="w"> </span>-o<span class="w"> </span>yaml

<span class="c1"># Edit HPA</span>
kubectl<span class="w"> </span>edit<span class="w"> </span>hpa<span class="w"> </span>&lt;name&gt;

<span class="c1"># Delete HPA</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>hpa<span class="w"> </span>&lt;name&gt;
</code></pre></div>
<h3 id="monitoring-testing"><strong>Monitoring &amp; Testing</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Watch scaling in real-time</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s1">&#39;kubectl get hpa,deploy,pods &amp;&amp; echo &quot;---&quot; &amp;&amp; kubectl top pods 2&gt;/dev/null || echo &quot;Metrics loading...&quot;&#39;</span>

<span class="c1"># Generate memory load for testing</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deployment/&lt;name&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>150M<span class="w"> </span>--timeout<span class="w"> </span><span class="m">120</span>

<span class="c1"># Generate CPU load for testing</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deployment/&lt;name&gt;<span class="w"> </span>--<span class="w"> </span>stress<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--timeout<span class="w"> </span><span class="m">120</span>

<span class="c1"># Check resource usage</span>
kubectl<span class="w"> </span>top<span class="w"> </span>pods
kubectl<span class="w"> </span>top<span class="w"> </span>pods<span class="w"> </span>--containers<span class="w">  </span><span class="c1"># Show container-level usage</span>
</code></pre></div>
<h3 id="debugging"><strong>Debugging</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check HPA events</span>
kubectl<span class="w"> </span>get<span class="w"> </span>events<span class="w"> </span>--field-selector<span class="w"> </span>involvedObject.kind<span class="o">=</span>HorizontalPodAutoscaler<span class="w"> </span>--sort-by<span class="o">=</span>.metadata.creationTimestamp

<span class="c1"># Verify API access</span>
kubectl<span class="w"> </span>get<span class="w"> </span>--raw<span class="w"> </span><span class="s2">&quot;/apis/metrics.k8s.io/v1beta1/nodes&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.items[0].usage&#39;</span>

<span class="c1"># Check pod details</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A10<span class="w"> </span><span class="s2">&quot;Resources:&quot;</span>
</code></pre></div>
<h2 id="best-practices-summary">ğŸ’¡ <strong>Best Practices Summary</strong></h2>
<ol>
<li><strong>Always set resource requests</strong> in deployments (required for HPA calculations)</li>
<li><strong>Start with conservative behavior</strong> and adjust based on observations</li>
<li><strong>Test both CPU and memory scaling</strong> before production deployment</li>
<li><strong>Monitor HPA events</strong> for failed scaling attempts</li>
<li><strong>Use appropriate min/max values</strong> based on application needs and cluster capacity</li>
<li><strong>Regularly review metrics</strong> to ensure targets are appropriate</li>
<li><strong>Consider combining with VPA</strong> (Vertical Pod Autoscaler) for right-sizing requests</li>
</ol>
<h2 id="common-pitfalls-to-avoid">âš ï¸ <strong>Common Pitfalls to Avoid</strong></h2>
<ul>
<li>âŒ Forgetting to install/configure Metrics Server</li>
<li>âŒ Not setting resource requests in pods</li>
<li>âŒ Setting <code>minReplicas</code> to 0 for stateful applications</li>
<li>âŒ Too aggressive scale-down causing application instability</li>
<li>âŒ Incorrect metric units (using <code>Mi</code> for CPU, <code>m</code> for memory)</li>
<li>âŒ Not monitoring HPA events for failures</li>
<li>âŒ Testing only one resource type (CPU or Memory) when both matter</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../keywords/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../keywords/" class="btn btn-xs btn-link">
        Search Keywords+
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../.." class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../.." class="btn btn-xs btn-link">
        CKA
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>