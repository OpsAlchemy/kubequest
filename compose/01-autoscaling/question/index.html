<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/01-autoscaling/question/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Autoscaling Practice - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Autoscaling Practice", url: "#_top", children: [
              {title: "QUESTIONS", url: "#questions" },
              {title: "\ud83d\udd25 Question 1 \u2014 Memory-based HPA with Custom Behavior", url: "#question-1-memory-based-hpa-with-custom-behavior" },
              {title: "\ud83d\udd25 Question 2 \u2014 CPU + Memory HPA with Complex Custom Behavior", url: "#question-2-cpu-memory-hpa-with-complex-custom-behavior" },
              {title: "\ud83d\ude80 Question 3 \u2014 VPA in Off Mode", url: "#question-3-vpa-in-off-mode" },
              {title: "\ud83d\ude80 Question 4 \u2014 VPA in Initial Mode", url: "#question-4-vpa-in-initial-mode" },
              {title: "\ud83d\ude80 Question 5 \u2014 VPA in Auto Mode (Fully Configured)", url: "#question-5-vpa-in-auto-mode-fully-configured" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../solution/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../solution/" class="btn btn-xs btn-link">
        Solution
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../keywords/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../keywords/" class="btn btn-xs btn-link">
        Search Keywords+
      </a>
    </div>
    
  </div>

    

    <h1 id="autoscaling-practice">Autoscaling Practice</h1>
<hr />
<h2 id="questions">QUESTIONS</h2>
<hr />
<h2 id="question-1-memory-based-hpa-with-custom-behavior">ðŸ”¥ Question 1 â€” Memory-based HPA with Custom Behavior</h2>
<h3 id="objective">Objective</h3>
<p>Configure a Horizontal Pod Autoscaler that scales <strong>only on memory utilization</strong> and uses <strong>custom scaling behavior</strong>.</p>
<h3 id="requirements">Requirements</h3>
<ul>
<li>Deployment name: <code>mem-hpa</code></li>
<li>Image: <code>polinux/stress</code></li>
<li>Command:
  <div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;3600&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div></li>
<li>Resource requests:
  <div class="highlight"><pre><span></span><code><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Mi</span>
</code></pre></div></li>
</ul>
<p><strong>HPA configuration:</strong></p>
<ul>
<li>Metric: memory utilization</li>
<li>Target: <strong>80%</strong></li>
<li>Min replicas: <strong>1</strong></li>
<li>Max replicas: <strong>5</strong> </li>
</ul>
<p><strong>Behavior:</strong></p>
<ul>
<li>Scale up: <strong>+2 pods per 30 seconds</strong></li>
<li>Scale down: <strong>âˆ’1 pod per 60 seconds</strong></li>
<li>Scale-down stabilization window: <strong>300 seconds</strong></li>
</ul>
<h3 id="load-generation">Load Generation</h3>
<div class="highlight"><pre><span></span><code><span class="nv">POD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>mem-hpa<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span>shuf<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running stress in: </span><span class="nv">$POD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$POD</span><span class="s2">&quot;</span><span class="w"> </span>--<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;nohup stress --vm 1 --vm-bytes 200Mi --timeout 600 &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span>
</code></pre></div>
<h3 id="observation">Observation</h3>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">kubectl top po;</span>
<span class="s1">echo &quot;-----&quot;;</span>
<span class="s1">kubectl get po -l app=mem-hpa</span>
<span class="s1">&#39;</span>
</code></pre></div>
<hr />
<h2 id="question-2-cpu-memory-hpa-with-complex-custom-behavior">ðŸ”¥ Question 2 â€” CPU + Memory HPA with Complex Custom Behavior</h2>
<h3 id="objective_1">Objective</h3>
<p>Configure a <strong>multi-metric HPA</strong> that scales on <strong>CPU OR memory</strong>, using <strong>asymmetric, production-style behavior rules</strong>.</p>
<h3 id="requirements_1">Requirements</h3>
<ul>
<li>Deployment name: <code>multi-hpa</code></li>
<li>Image: <code>polinux/stress</code></li>
<li>Command:
  <div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;3600&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div></li>
<li>Resource requests:
  <div class="highlight"><pre><span></span><code><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40m</span>
<span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60Mi</span>
</code></pre></div></li>
</ul>
<p><strong>HPA configuration:</strong></p>
<ul>
<li>CPU target: <strong>65%</strong></li>
<li>Memory target: <strong>75%</strong></li>
<li>Min replicas: <strong>2</strong></li>
<li>Max replicas: <strong>8</strong></li>
</ul>
<p><strong>Behavior:</strong></p>
<ul>
<li>
<p>Scale up:</p>
<ul>
<li><strong>Max of 4 pods OR 50% per 30 seconds</strong></li>
<li>Select policy: <strong>Max</strong></li>
</ul>
</li>
<li>
<p>Scale down:</p>
<ul>
<li><strong>âˆ’1 pod per 90 seconds</strong></li>
<li>Stabilization window: <strong>300 seconds</strong></li>
</ul>
</li>
</ul>
<h3 id="load-generation_1">Load Generation</h3>
<div class="highlight"><pre><span></span><code><span class="nv">POD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>multi-hpa<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span>shuf<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running stress in: </span><span class="nv">$POD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$POD</span><span class="s2">&quot;</span><span class="w"> </span>--<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;nohup stress --cpu 2 --vm 1 --vm-bytes 180Mi --timeout 600 &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span>
</code></pre></div>
<h3 id="observation_1">Observation</h3>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">kubectl describe hpa multi-hpa | grep -A15 &quot;Metrics:&quot;;</span>
<span class="s1">echo &quot;-----&quot;;</span>
<span class="s1">kubectl get po -l app=multi-hpa</span>
<span class="s1">&#39;</span>
</code></pre></div>
<hr />
<h2 id="question-3-vpa-in-off-mode">ðŸš€ Question 3 â€” VPA in Off Mode</h2>
<h3 id="objective_2">Objective</h3>
<p>Validate that <strong>VPA Off mode</strong> only observes usage and never mutates pods.</p>
<h3 id="requirements_2">Requirements</h3>
<ul>
<li>Deployment name: <code>vpa-off</code></li>
<li>Image: <code>polinux/stress</code></li>
<li>Command:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;3600&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
* Initial requests:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20m</span>
<span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30Mi</span>
</code></pre></div>
* VPA configuration:</p>
<ul>
<li>Update mode: <code>Off</code></li>
<li>Min allowed: <code>30m / 40Mi</code></li>
<li>Max allowed: <code>200m / 200Mi</code></li>
</ul>
<h3 id="load-generation_2">Load Generation</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deploy/vpa-off<span class="w"> </span>--<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;stress --cpu 2 --vm 1 --vm-bytes 100Mi --timeout 600&#39;</span>
</code></pre></div>
<h3 id="observation_2">Observation</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>vpa<span class="w"> </span>vpa-off
</code></pre></div>
<hr />
<h2 id="question-4-vpa-in-initial-mode">ðŸš€ Question 4 â€” VPA in Initial Mode</h2>
<h3 id="objective_3">Objective</h3>
<p>Understand how <strong>VPA Initial mode injects requests only at pod creation time</strong>.</p>
<h3 id="requirements_3">Requirements</h3>
<ul>
<li>Deployment name: <code>vpa-initial</code></li>
<li>Image: <code>polinux/stress</code></li>
<li>Command:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;3600&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
* Initial requests:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Mi</span>
</code></pre></div>
* VPA configuration:</p>
<ul>
<li>Update mode: <code>Initial</code></li>
<li>Min allowed: <code>20m / 30Mi</code></li>
<li>Max allowed: <code>100m / 100Mi</code></li>
</ul>
<h3 id="load-generation_3">Load Generation</h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>deploy/vpa-initial<span class="w"> </span>--<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;stress --cpu 1 --vm 1 --vm-bytes 60Mi --timeout 600&#39;</span>
</code></pre></div>
<h3 id="observation_3">Observation</h3>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">kubectl describe vpa vpa-initial | grep -A8 -B6 &quot;Recommendation&quot;</span>
<span class="s1">&#39;</span>
</code></pre></div>
<hr />
<h2 id="question-5-vpa-in-auto-mode-fully-configured">ðŸš€ Question 5 â€” VPA in Auto Mode (Fully Configured)</h2>
<h3 id="objective_4">Objective</h3>
<p>Observe <strong>automatic pod eviction and recreation</strong> when VPA actively enforces sizing.</p>
<h3 id="requirements_4">Requirements</h3>
<ul>
<li>Deployment name: <code>vpa-auto</code></li>
<li>Image: <code>polinux/stress</code></li>
<li>Command:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;3600&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
* Initial requests:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15m</span>
<span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25Mi</span>
</code></pre></div>
* VPA configuration:</p>
<ul>
<li>Update mode: <code>Auto</code></li>
<li>Min allowed: <code>20m / 30Mi</code></li>
<li>Max allowed: <code>150m / 200Mi</code></li>
<li>Controlled resources: CPU and memory</li>
</ul>
<h3 id="load-generation_4">Load Generation</h3>
<div class="highlight"><pre><span></span><code><span class="nv">POD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>vpa-auto<span class="w"> </span>-o<span class="w"> </span>name<span class="w"> </span><span class="p">|</span><span class="w"> </span>shuf<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running stress in: </span><span class="nv">$POD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$POD</span><span class="s2">&quot;</span><span class="w"> </span>--<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;nohup stress --cpu 3 --vm 1 --vm-bytes 150Mi --timeout 300 &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span>
</code></pre></div>
<h3 id="observation_4">Observation</h3>
<div class="highlight"><pre><span></span><code>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">kubectl get po -l app=vpa-auto</span>
<span class="s1">&#39;</span>
</code></pre></div>
<hr />

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../solution/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../solution/" class="btn btn-xs btn-link">
        Solution
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../keywords/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../keywords/" class="btn btn-xs btn-link">
        Search Keywords+
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>