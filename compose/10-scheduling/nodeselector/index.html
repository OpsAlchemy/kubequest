<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Vikash Kumar">
    <link rel="canonical" href="https://opsalchemy.github.io/kubequest/compose/10-scheduling/nodeselector/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>NodeSelector - CKA Exam Mastery</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../stylesheets/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "NodeSelector", url: "#_top", children: [
              {title: "What is nodeSelector?", url: "#what-is-nodeselector" },
              {title: "How It Works", url: "#how-it-works" },
              {title: "Key Differences: nodeSelector vs nodeName", url: "#key-differences-nodeselector-vs-nodename" },
              {title: "Step-by-Step Usage", url: "#step-by-step-usage" },
              {title: "Common Use Cases", url: "#common-use-cases" },
              {title: "Limitations", url: "#limitations" },
              {title: "Best Practices", url: "#best-practices" },
              {title: "Troubleshooting", url: "#troubleshooting" },
              {title: "Practice Question 2", url: "#practice-question-2" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../javascripts/extra.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../podAffinity-nodeAffinity-deployments/notes/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../podAffinity-nodeAffinity-deployments/notes/" class="btn btn-xs btn-link">
        Kubernetes Scheduling: Pod &amp; Node Affinity - Theory &amp; Practice
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../nodename/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../nodename/" class="btn btn-xs btn-link">
        NodeName
      </a>
    </div>
    
  </div>

    

    <h1 id="nodeselector"><strong>NodeSelector</strong></h1>
<hr />
<h2 id="what-is-nodeselector"><strong>What is nodeSelector?</strong></h2>
<p><code>nodeSelector</code> is a field in a Pod spec that selects nodes based on their <strong>labels</strong>. Unlike <code>nodeName</code> which bypasses the scheduler, <code>nodeSelector</code> works <strong>with</strong> the scheduler to match pods to nodes with specific labels.</p>
<h2 id="how-it-works"><strong>How It Works</strong></h2>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">          </span><span class="c1"># ‚Üê This is the key field</span>
<span class="w">    </span><span class="nt">disktype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssd</span><span class="w">        </span><span class="c1"># Node must have label disktype=ssd</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east</span><span class="w">      </span><span class="c1"># Node must have label region=us-east</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</code></pre></div>
<p>The scheduler will only place this pod on nodes that have <strong>ALL</strong> the labels specified in <code>nodeSelector</code>.</p>
<h2 id="key-differences-nodeselector-vs-nodename"><strong>Key Differences: nodeSelector vs nodeName</strong></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th><code>nodeName</code></th>
<th><code>nodeSelector</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scheduler</strong></td>
<td>Bypasses scheduler</td>
<td>Works with scheduler</td>
</tr>
<tr>
<td><strong>Flexibility</strong></td>
<td>Hardcoded node name</td>
<td>Uses labels (more flexible)</td>
</tr>
<tr>
<td><strong>Failover</strong></td>
<td>No failover</td>
<td>Can reschedule to other matching nodes</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>No resource checking</td>
<td>Normal scheduler validation</td>
</tr>
<tr>
<td><strong>Production Use</strong></td>
<td>Rarely used</td>
<td>Commonly used</td>
</tr>
</tbody>
</table>
<h2 id="step-by-step-usage"><strong>Step-by-Step Usage</strong></h2>
<h3 id="1-label-your-nodes">1. <strong>Label Your Nodes</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Add labels to nodes</span>
kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>node-01<span class="w"> </span><span class="nv">disktype</span><span class="o">=</span>ssd
kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>node-01<span class="w"> </span><span class="nv">region</span><span class="o">=</span>us-east

kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>node-02<span class="w"> </span><span class="nv">disktype</span><span class="o">=</span>hdd
kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>node-02<span class="w"> </span><span class="nv">region</span><span class="o">=</span>us-west

<span class="c1"># Verify labels</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--show-labels
</code></pre></div>
<h3 id="2-create-pod-with-nodeselector">2. <strong>Create Pod with nodeSelector</strong></h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-app</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">disktype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssd</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</code></pre></div>
<h3 id="3-verify-scheduling">3. <strong>Verify Scheduling</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Check which node the pod landed on</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>web-app<span class="w"> </span>-o<span class="w"> </span>wide

<span class="c1"># Describe the pod to see scheduling details</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>web-app
</code></pre></div>
<h2 id="common-use-cases"><strong>Common Use Cases</strong></h2>
<ol>
<li>
<p><strong>Hardware Requirements</strong>
<div class="highlight"><pre><span></span><code><span class="nt">nodeSelector</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">  </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;high&quot;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Environment/Region</strong>
<div class="highlight"><pre><span></span><code><span class="nt">nodeSelector</span><span class="p">:</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">  </span><span class="nt">zone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zone-a</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Team/Project Isolation</strong>
<div class="highlight"><pre><span></span><code><span class="nt">nodeSelector</span><span class="p">:</span>
<span class="w">  </span><span class="nt">team</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-science</span>
<span class="w">  </span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ml-training</span>
</code></pre></div></p>
</li>
</ol>
<h2 id="limitations"><strong>Limitations</strong></h2>
<ol>
<li><strong>AND Logic Only</strong>: All labels must match (cannot do OR logic)</li>
<li><strong>No Preferences</strong>: Cannot say "prefer SSD, but HDD is okay" </li>
<li><strong>No Complex Rules</strong>: Cannot specify "not equal to" or "exists" operators</li>
</ol>
<h2 id="best-practices"><strong>Best Practices</strong></h2>
<ol>
<li><strong>Use Meaningful Labels</strong>: <code>disktype:ssd</code> instead of <code>type:1</code></li>
<li><strong>Document Labels</strong>: Keep a list of node labels your team uses</li>
<li><strong>Combine with Resources</strong>: Use with resource requests/limits</li>
<li><strong>Test Label Matching</strong>: Verify labels exist before deploying</li>
</ol>
<h2 id="troubleshooting"><strong>Troubleshooting</strong></h2>
<p><strong>Pod Stays Pending?</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Check if any nodes have the required labels</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-l<span class="w"> </span><span class="nv">disktype</span><span class="o">=</span>ssd,region<span class="o">=</span>us-east

<span class="c1"># Check pod events</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span><span class="o">[</span>pod-name<span class="o">]</span>

<span class="c1"># Check node capacity</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span><span class="o">[</span>node-name<span class="o">]</span>
</code></pre></div></p>
<p><strong>Remove Labels:</strong>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>label<span class="w"> </span>node<span class="w"> </span>node-01<span class="w"> </span>disktype-
</code></pre></div></p>
<hr />
<h2 id="practice-question-2"><strong>Practice Question 2</strong></h2>
<p>You have a Kubernetes cluster with the following nodes and labels:</p>
<div class="highlight"><pre><span></span><code>Node: worker-1
  Labels: environment=production, storage=ssd, zone=us-east-1a

Node: worker-2  
  Labels: environment=staging, storage=hdd, zone=us-east-1b

Node: worker-3
  Labels: environment=production, storage=ssd, zone=us-east-1b
</code></pre></div>
<p>Create a Pod YAML for a database application that:
1. <strong>Pod name</strong>: <code>production-db</code>
2. <strong>Image</strong>: <code>postgres:14</code>
3. <strong>Label the pod</strong>: <code>app: database</code>
4. <strong>Environment variable</strong>: <code>POSTGRES_PASSWORD: secret123</code>
5. <strong>Must run</strong> only on nodes with:
   - <code>environment=production</code>
   - <code>storage=ssd</code>
6. <strong>Container port</strong>: <code>5432</code></p>
<p><strong>Write your YAML solution below:</strong></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../podAffinity-nodeAffinity-deployments/notes/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../podAffinity-nodeAffinity-deployments/notes/" class="btn btn-xs btn-link">
        Kubernetes Scheduling: Pod &amp; Node Affinity - Theory &amp; Practice
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../nodename/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../nodename/" class="btn btn-xs btn-link">
        NodeName
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>